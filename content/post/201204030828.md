
---
title: "「魔法少女まどか☆マギカ」の台詞をJavaScriptでMapReduceしてGoogle Chart APIでグラフ出力したよ！"
date: 2012-04-03T08:28:04+00:00
category : [Hadoop]
canonicalurl: http://yut.hatenablog.com/entry/20120403/1333409284
---

## [Hadoop] : 「魔法少女まどか☆マギカ」の台詞をJavaScriptでMapReduceしてGoogle Chart APIでグラフ出力したよ！

<p><div class="amazlet-box"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873115035/yutakikuchi-22/"><img src="http://ecx.images-amazon.com/images/I/51p88eroNdL._SL160_.jpg" class="hatena-asin-detail-image" alt="Hadoop 第2版" title="Hadoop 第2版"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873115035/yutakikuchi-22/">Hadoop 第2版</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> Tom White,玉川竜司,兼田聖士</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%E9%A5%A4%A5%EA%A1%BC%A5%B8%A5%E3%A5%D1%A5%F3">オライリージャパン</a></li><li><span class="hatena-asin-detail-label">発売日:</span> 2011/07/23</li><li><span class="hatena-asin-detail-label">メディア:</span> 大型本</li><li><span class="hatena-asin-detail-label">購入</span>: 9人 <span class="hatena-asin-detail-label">クリック</span>: 182回</li><li><a href="http://d.hatena.ne.jp/asin/4873115035/yutakikuchi-22" target="_blank">この商品を含むブログ (24件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<div class="section">
<h4>概要</h4>

<blockquote>
    
<ul>
<li><a href="http://d.hatena.ne.jp/yutakikuchi/20111231/1325310004">「魔法少女まどか☆マギカ」の台詞をNLTK(Natural Language Toolkit)で解析する - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20111231/1325310004"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20111231/1325310004" alt="はてなブックマーク - 「魔法少女まどか☆マギカ」の台詞をNLTK(Natural Language Toolkit)で解析する - Yuta.Kikuchiの日記" border="0" /></a></li>
<li><a href="http://d.hatena.ne.jp/yutakikuchi/20110904/1315105395">SpiderMonkeyでのコマンドラインJavascript - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20110904/1315105395"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20110904/1315105395" alt="はてなブックマーク - SpiderMonkeyでのコマンドラインJavascript - Yuta.Kikuchiの日記" border="0" /></a></li>
<li><a href="http://d.hatena.ne.jp/yutakikuchi/20111205/1323041424">CentOSでHadoopを使ってみる - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20111205/1323041424"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20111205/1323041424" alt="はてなブックマーク - CentOSでHadoopを使ってみる - Yuta.Kikuchiの日記" border="0" /></a></li>
</ul><p>以前に「<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CB%E2%CB%A1%BE%AF%BD%F7%A4%DE%A4%C9%A4%AB%A1%F9%A5%DE%A5%AE%A5%AB">魔法少女まどか☆マギカ</a>」の台詞をNLTK(Natural Language Toolkit)で解析することに挑戦しましたが、解析結果の集計グラフが奇麗に表示されませんでした。今回はそれを改善すべく手法を変えて挑戦します。グラフ化はNLTKではなく<span class="deco" style="color:#FF0000;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/Google">Google</a> Chart <a class="keyword" href="http://d.hatena.ne.jp/keyword/API">API</a></span>を利用します。<a href="http://code.google.com/intl/ja-JP/apis/chart/">Google Chart Tools - Google Code</a> <a href="http://b.hatena.ne.jp/entry/code.google.com/intl/ja-JP/apis/chart/"><img src="http://b.hatena.ne.jp/entry/image/http://code.google.com/intl/ja-JP/apis/chart/" alt="はてなブックマーク - Google Chart Tools - Google Code" border="0" /></a> また<span class="deco" style="color:#FF0000;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>を用い</span>、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Google">Google</a> Chart <a class="keyword" href="http://d.hatena.ne.jp/keyword/API">API</a>とのデータ連携をしやすいようにします。以下に大まかな処理の流れを記述します。</p>

<ol>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/SpiderMonkey">SpiderMonkey</a>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a>に設定</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/%CB%E2%CB%A1%BE%AF%BD%F7%A4%DE%A4%C9%A4%AB%A1%F9%A5%DE%A5%AE%A5%AB">魔法少女まどか☆マギカ</a>の台詞を<a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EC%A5%A4%A5%D4%A5%F3%A5%B0">スクレイピング</a></li>
<li>NLTKによる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%AC%A4%AB%A4%C1%BD%F1%A4%AD">分かち書き</a></li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>による<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a></li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a></li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Google">Google</a> Chart <a class="keyword" href="http://d.hatena.ne.jp/keyword/API">API</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>結果をグラフ化</li>
</ol>
</blockquote>

</div>
<div class="section">
<h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/SpiderMonkey">SpiderMonkey</a>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a>に設定</h4>

<blockquote>
    
<div class="section">
<h5>参考</h5>
<p><span class="deco" style="color:#FF0000;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>で行うために</span><a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/SpiderMonkey">SpiderMonkey</a>を設定します。本家サイトのinstall手順を参考にしました。<a href="https://developer.mozilla.org/en/Building_only_SpiderMonkey">https://developer.mozilla.org/en/Building_only_SpiderMonkey</a></p>

</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>取得/解凍</h5>
<pre class="code" data-lang="" data-unlink>$ wget http://ftp.mozilla.org/pub/mozilla.org/js/js-1.8.0-rc1.tar.gz
$ tar -xzf js-1.8.0-rc1.tar.gz</pre>
</div>
<div class="section">
<h5>build/install</h5>
<pre class="code" data-lang="" data-unlink>$ cd js/src/
$ make BUILD_OPT=1 -f Makefile.ref
$ sudo make BUILD_OPT=1 JS_DIST=/usr/local -f Makefile.ref export</pre>
</div>
</blockquote>

</div>
<div class="section">
<h4>「<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CB%E2%CB%A1%BE%AF%BD%F7%A4%DE%A4%C9%A4%AB%A1%F9%A5%DE%A5%AE%A5%AB">魔法少女まどか☆マギカ</a>」の台詞を<a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EC%A5%A4%A5%D4%A5%F3%A5%B0">スクレイピング</a></h4>

<blockquote>
    
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EC%A5%A4%A5%D4%A5%F3%A5%B0">スクレイピング</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>コード</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a>コードで<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CB%E2%CB%A1%BE%AF%BD%F7%A4%DE%A4%C9%A4%AB%A1%F9%A5%DE%A5%AE%A5%AB">魔法少女まどか☆マギカ</a>台詞を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EC%A5%A4%A5%D4%A5%F3%A5%B0">スクレイピング</a>します。以前より台詞掲載ページが増えていたのでURLを追加しました。</p>
<pre class="hljs python" data-lang="python" data-unlink><span class="synComment">#!/usr/bin/env python</span>
<span class="synComment"># -*- coding: utf-8 -*-</span>

<span class="synPreProc">import</span> sys,re,urllib,urllib2
urls = ( <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/170.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/175.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/179.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/180.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/200.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/247.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/244.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/249.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/250.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/252.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/241.html'</span>,
     <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/pages/254.html'</span>
     )   
f = <span class="synIdentifier">open</span>( <span class="synConstant">'./madmagi.txt'</span>, <span class="synConstant">'w'</span> )
opener = urllib2.build_opener()
ua = <span class="synConstant">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/534.51.22 (KHTML, like Gecko) Version/5.1.1 Safari/    534.51.22'</span>
referer = <span class="synConstant">'http://www22.atwiki.jp/madoka-magica/'</span>
opener.addheaders = [( <span class="synConstant">'User-Agent'</span>, ua ),( <span class="synConstant">'Referer'</span>, referer )]
<span class="synStatement">for</span> url <span class="synStatement">in</span> urls:
content = opener.<span class="synIdentifier">open</span>( url ).read()
<span class="synStatement">if</span> re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<div class="contents".*?>((.|\n)*?)</div>'</span>, re.M ).search( content ) <span class="synStatement">is</span> <span class="synStatement">not</span> <span class="synIdentifier">None</span>:
    data = re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<div class="contents".*?>((.|\n)*?)</div>'</span>, re.M ).search( content ).group()
    <span class="synStatement">if</span> re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'「(.*?)」'</span>, re.M ).search( data ) <span class="synStatement">is</span> <span class="synStatement">not</span> <span class="synIdentifier">None</span>: 
        lines = re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'「(.*?)」'</span>, re.M ).findall( data )
        <span class="synStatement">for</span> line <span class="synStatement">in</span> lines:
            f.write( line + <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">"</span> )
f.close()
</pre>
</div>
<div class="section">
<h5>抽出データ</h5>
<p>以下は抽出したデータの一部です。全部で1259行あります。</p>
<pre class="code" data-lang="" data-unlink>んっん…あっ…！
あっ…！
ひどい…
仕方ないよ。彼女一人では荷が重すぎた
でも、彼女も覚悟の上だろう
そんな…あんまりだよ、こんなのってないよ
諦めたらそれまでだ
でも、君なら運命を変えられる
避けようのない滅びも、嘆きも、全て君が覆せばいい
そのための力が、君には備わっているんだから
本当なの？
私なんかでも、本当に何かできるの？こんな結末を変えられるの？
もちろんさ。だから僕と契約して、魔法少女になってよ！
私は巴マミ
あなたたちと同じ、見滝原中の３年生
そして
キュゥべえと契約した、魔法少女よ</pre>
</div>
</blockquote>

</div>
<div class="section">
<h4>NLTKによる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%AC%A4%AB%A4%C1%BD%F1%A4%AD">分かち書き</a></h4>

<blockquote>
    <p>NLTKによる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%AC%A4%AB%A4%C1%BD%F1%A4%AD">分かち書き</a>を行います。<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%AC%A4%AB%A4%C1%BD%F1%A4%AD">分かち書き</a>とは語の区切りに空白を入れて分かりやすくする表記です。<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C0%B5%B5%AC%C9%BD%B8%BD">正規表現</a>による単語ベースでの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%AC%A4%AB%A4%C1%BD%F1%A4%AD">分かち書き</a>と<a class="keyword" href="http://d.hatena.ne.jp/keyword/MeCab">MeCab</a>を用いた<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B7%C1%C2%D6%C1%C7">形態素</a>ベースでの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%AC%A4%AB%A4%C1%BD%F1%A4%AD">分かち書き</a>の両方をやります。</p>

<div class="section">
<h5>単語区切り</h5>
<p>台詞の単語をスペースで区切ります。</p>
<pre class="hljs python" data-lang="python" data-unlink><span class="synComment">#!/usr/bin/env python</span>
<span class="synComment"># -*- coding: utf-8 -*-</span>
<span class="synPreProc">import</span> sys
<span class="synIdentifier">reload</span>(sys)
sys.setdefaultencoding(<span class="synConstant">'utf-8'</span>)

<span class="synPreProc">import</span> nltk
<span class="synPreProc">from</span> nltk.corpus.reader <span class="synPreProc">import</span> *
<span class="synPreProc">from</span> nltk.corpus.reader.util <span class="synPreProc">import</span> *
<span class="synPreProc">from</span> nltk.text <span class="synPreProc">import</span> Text

jp_sent_tokenizer = nltk.RegexpTokenizer(<span class="synConstant">u'[^　「」！？。]*[！？。]'</span>)
jp_chartype_tokenizer = nltk.RegexpTokenizer(<span class="synConstant">u'([ぁ-んー]+|[ァ-ンー]+|[</span><span class="synSpecial">\u4e00</span><span class="synConstant">-</span><span class="synSpecial">\u9FFF</span><span class="synConstant">]+|[^ぁ-んァ-ンー</span><span class="synSpecial">\u4e00</span><span class="synConstant">-</span><span class="synSpecial">\u9FFF</span><span class="synConstant">]+)'</span>)
data = PlaintextCorpusReader( <span class="synConstant">'./'</span>, <span class="synConstant">r'madmagi.txt'</span>,
                          encoding=<span class="synConstant">'utf-8'</span>,
                          para_block_reader=read_line_block,
                          sent_tokenizer=jp_sent_tokenizer,
                          word_tokenizer=jp_chartype_tokenizer )

<span class="synComment">#ファイル保存</span>
f = <span class="synIdentifier">open</span>( <span class="synConstant">'./word.txt'</span>, <span class="synConstant">'w'</span> )
<span class="synStatement">for</span> i <span class="synStatement">in</span> data.words():
f.write( i + <span class="synConstant">" "</span> )
f.close
</pre><p>抽出された状態は以下のようになります。最初にスクレイプした状態からスペース区切りになっている事が分かると思います。これを<span class="deco" style="color:#FF0000;">word.txt</span>として保存します。</p>
<pre class="code" data-lang="" data-unlink> んっん … あっ …！
 あっ …！
 ひどい …
 仕方 ないよ 。 彼女一人 では 荷 が 重 すぎた 
 でも 、 彼女 も 覚悟 の 上 だろう 
 そんな … あんまりだよ 、 こんなのってないよ 
 諦 めたらそれまでだ 
 でも 、 君 なら 運命 を 変 えられる 
 避 けようのない 滅 びも 、 嘆 きも 、 全 て 君 が 覆 せばいい 
 そのための 力 が 、 君 には 備 わっているんだから 
 本当 なの ？
 私 なんかでも 、 本当 に 何 かできるの ？ こんな 結末 を 変 えられるの ？
 もちろんさ 。 だから 僕 と 契約 して 、 魔法少女 になってよ ！
 私 は 巴 マミ 
 あなたたちと 同 じ 、 見滝原中 の ３ 年生 
 そして 
 キュゥ べえと 契約 した 、 魔法少女 よ</pre>
</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/MeCab">MeCab</a>による<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B7%C1%C2%D6%C1%C7%B2%F2%C0%CF">形態素解析</a></h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MeCab">MeCab</a>を利用して<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B7%C1%C2%D6%C1%C7%B2%F2%C0%CF">形態素解析</a>を行い、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B7%C1%C2%D6%C1%C7">形態素</a>毎にスペース区切りでデータを保存するようにします。抽出するサンプルコードは次のようになります。</p>
<pre class="hljs python" data-lang="python" data-unlink><span class="synComment">#!/usr/bin/env python</span>
<span class="synComment"># -*- coding: utf-8 -*-</span>
<span class="synPreProc">import</span> sys
<span class="synIdentifier">reload</span>(sys)
sys.setdefaultencoding(<span class="synConstant">'utf-8'</span>)

<span class="synPreProc">import</span> MeCab
mecab = MeCab.Tagger(<span class="synConstant">'-Ochasen'</span>)

data = <span class="synIdentifier">open</span>( <span class="synConstant">'./madmagi.txt'</span> ).read()

f = <span class="synIdentifier">open</span>( <span class="synConstant">'./ma.txt'</span>, <span class="synConstant">'w'</span> )

node = mecab.parseToNode( data )
phrases = node.<span class="synIdentifier">next</span>
<span class="synStatement">while</span> phrases:
<span class="synStatement">try</span>:
    k = node.surface
    f.write( k + <span class="synConstant">" "</span> )
    node = node.<span class="synIdentifier">next</span>
<span class="synStatement">except</span> <span class="synType">AttributeError</span>:
   <span class="synStatement">break</span> 
f.close()
</pre><p>抽出した結果は以下のようになります。これを<span class="deco" style="color:#FF0000;">ma.txt</span>として保存します。</p>
<pre class="code" data-lang="" data-unlink> ん っ ん … あっ … ！ あっ … ！ ひどい … 仕方 ない よ 。 彼女 一 人 で は 荷 が 重 すぎ た でも 、 彼女 も 覚悟 の 上 だろ う そんな … あんまり だ よ 、 こんな の って ない よ 諦め たら それ まで だ で も 、 君 なら 運命 を 変え られる 避け よう の ない 滅び も 、 嘆き も 、 全て 君 が 覆せ ば いい その ため の 力 が 、 君 に は 備わっ て いる ん だ から 本当 な の ？ 私 なんか でも 、 本当に 何 か できる の ？ こんな 結末 を 変え られる の ？ もちろん さ 。 だから 僕 と 契約 し て 、 魔法 少女 に なっ て よ ！ 私 は 巴 マミ あなた たち と 同じ 、 見滝 原中 の ３ 年生 そして キュゥ べ えと 契約 し た 、 魔法 少女 よ</pre>
</div>
</blockquote>

</div>
<div class="section">
<h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>による<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a></h4>

<blockquote>
    
<div class="section">
<h5>MapRuduceクラスの定義</h5>
<p>NLTKによって<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%AC%A4%AB%A4%C1%BD%F1%A4%AD">分かち書き</a>された単語を<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>します。<br />
簡単な<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>クラスを以下のように定義します。map<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>は単語を整形、reduceは畳み込みを行っています。</p>
<pre class="hljs javascript" data-lang="javascript" data-unlink>
<span class="synIdentifier">var</span> MapReduce = <span class="synIdentifier">function</span>() <span class="synIdentifier">{}</span>;

MapReduce.prototype = <span class="synIdentifier">{</span>
   map : <span class="synIdentifier">function</span>( data ) <span class="synIdentifier">{</span>
    <span class="synIdentifier">var</span> lines = <span class="synIdentifier">[]</span>;
    re = <span class="synStatement">new</span> <span class="synType">RegExp</span>( <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">"</span> );
    <span class="synStatement">if</span>( re.test( data ) ) <span class="synIdentifier">{</span>
        lines = data.split( <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">"</span> );
    <span class="synIdentifier">}</span> <span class="synStatement">else</span> <span class="synIdentifier">{</span>
        lines<span class="synIdentifier">[</span>0<span class="synIdentifier">]</span> = data;
    <span class="synIdentifier">}</span>
    <span class="synStatement">for</span>( <span class="synIdentifier">var</span> j=0; j<lines.length; j++ ) <span class="synIdentifier">{</span>
        <span class="synIdentifier">var</span> words = lines<span class="synIdentifier">[</span>j<span class="synIdentifier">]</span>.split( <span class="synConstant">" "</span> );
        <span class="synStatement">for</span>( <span class="synIdentifier">var</span> i=0; i<words.length; i++ ) <span class="synIdentifier">{</span>
            print( words<span class="synIdentifier">[</span>i<span class="synIdentifier">]</span> + <span class="synConstant">" ,"</span> + 1 );
        <span class="synIdentifier">}</span>
    <span class="synIdentifier">}</span>
   <span class="synIdentifier">}</span>,

   reduce : <span class="synIdentifier">function</span>( lines ) <span class="synIdentifier">{</span>
    <span class="synIdentifier">var</span> nodes = <span class="synIdentifier">{}</span>;
    <span class="synStatement">for</span>( i=0; i<lines.length; i++ ) <span class="synIdentifier">{</span>
        <span class="synIdentifier">var</span> words = lines<span class="synIdentifier">[</span>i<span class="synIdentifier">]</span>.split( <span class="synConstant">" ,"</span> );
        <span class="synIdentifier">var</span> k = words<span class="synIdentifier">[</span>0<span class="synIdentifier">]</span>;
        <span class="synStatement">if</span>( !nodes<span class="synIdentifier">[</span>k<span class="synIdentifier">]</span> ) <span class="synIdentifier">{</span>
            nodes<span class="synIdentifier">[</span>k<span class="synIdentifier">]</span> = 1;
        <span class="synIdentifier">}</span>
        nodes<span class="synIdentifier">[</span>k<span class="synIdentifier">]</span> = nodes<span class="synIdentifier">[</span>k<span class="synIdentifier">]</span> + 1;        
    <span class="synIdentifier">}</span>
    <span class="synStatement">for</span>( <span class="synIdentifier">var</span> k <span class="synStatement">in</span> nodes ) <span class="synIdentifier">{</span>
        print( k + <span class="synConstant">' : '</span> + nodes<span class="synIdentifier">[</span>k<span class="synIdentifier">]</span> );
    <span class="synIdentifier">}</span>
<span class="synIdentifier">}</span>,
<span class="synIdentifier">}</span>;
</pre>
</div>
<div class="section">
<h5>mapper.js</h5>
<p>上の<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>クラスを呼び出すmapper.jsを次のように定義します。load関数を使って上で定義した外部ファイル(<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>.js)を読み込みます。また<a class="keyword" href="http://d.hatena.ne.jp/keyword/SpiderMonkey">SpiderMonkey</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/readline">readline</a>を使って標準入力を読み取ります。</p>
<pre class="hljs javascript" data-lang="javascript" data-unlink>
#!/usr/local/bin/js
load( <span class="synConstant">"MapReduce.js"</span> );
<span class="synIdentifier">var</span> MR = <span class="synStatement">new</span> MapReduce();
<span class="synStatement">while</span>( ( line = readline() ) !== <span class="synStatement">null</span> ) <span class="synIdentifier">{</span>
MR.map( line );
<span class="synIdentifier">}</span>
</pre><p>NLTKで抽出したword.txtに対してmapperをかけると以下のような結果を得る事ができます。</p>
<pre class="code" data-lang="" data-unlink>$ cat data/word.txt | js mapper.js
んっん ,1
… ,1
あっ ,1
…！ ,1
 ,1
あっ ,1
…！ ,1
 ,1
ひどい ,1
… ,1
 ,1
仕方 ,1
ないよ ,1
。 ,1
彼女一人 ,1
では ,1
荷 ,1
が ,1
重 ,1
すぎた ,1</pre>
</div>
<div class="section">
<h5>reducer.js</h5>
<p>上の<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>クラスを呼び出すreducer.jsを次のように定義します。</p>
<pre class="hljs javascript" data-lang="javascript" data-unlink>
#!/usr/local/bin/js
load( <span class="synConstant">"MapReduce.js"</span> );
<span class="synIdentifier">var</span> MR = <span class="synStatement">new</span> MapReduce();
lines = <span class="synIdentifier">[]</span>;
i = 0;
<span class="synStatement">while</span>( ( line = readline() ) !== <span class="synStatement">null</span> ) <span class="synIdentifier">{</span>
lines<span class="synIdentifier">[</span>i<span class="synIdentifier">]</span> = line;
i++;
<span class="synIdentifier">}</span>
MR.reduce( lines );
</pre><p>mapperで得た結果に対してreducerをかけると以下のようになります。</p>
<pre class="code" data-lang="" data-unlink>$ cat data/word.txt | js mapper.js | js reducer.js
んっん : 2
… : 237
あっ : 19
…！ : 10
 : 2080
ひどい : 4
仕方 : 11
ないよ : 8
。 : 457
彼女一人 : 3
では : 9
荷 : 3
が : 127
重 : 3
すぎた : 3
でも : 23
、 : 1009
彼女 : 18
も : 61
覚悟 : 3</pre>
</div>
</blockquote>

</div>
<div class="section">
<h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a></h4>

<blockquote>
    
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/HDFS">HDFS</a>への登録</h5>
<p>折角mapper/reducerを書いたので<a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>上で実行します。NLTKで解析した単語、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B7%C1%C2%D6%C1%C7">形態素</a>の二つのテキストデータを<a class="keyword" href="http://d.hatena.ne.jp/keyword/HDFS">HDFS</a>に登録します。<a class="keyword" href="http://d.hatena.ne.jp/keyword/HDFS">HDFS</a>のディレクトリを<span class="deco" style="color:#FF0000;">madmagi</span>として新たに作成します。また<a class="keyword" href="http://d.hatena.ne.jp/keyword/HDFS">HDFS</a>コマンドは長いのでaliasを張ります。ここでは<span class="deco" style="color:#FF0000;">alias <a class="keyword" href="http://d.hatena.ne.jp/keyword/hdfs">hdfs</a>='<a class="keyword" href="http://d.hatena.ne.jp/keyword/hadoop">hadoop</a> dfs'</span>としました。</p>
<pre class="code" data-lang="" data-unlink>$ alias hdfs='hadoop dfs'
$ hdfs -mkdir madmagi
$ hdfs -put data/ma.txt madmagi/
$ hdfs -put data/word.txt madmagi/
$ hdfs -ls madmagi/
Found 2 items
-rw-r--r--   1 yuta supergroup          0 2012-03-21 08:04 /user/yuta/madmagi/ma.txt
-rw-r--r--   1 yuta supergroup          0 2012-03-21 08:04 /user/yuta/madmagi/word.txt</pre>
</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>実行</h5>
<p>HadoopStreamingを使って<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>します。基本的には上で実行したmapper.js/reducer.jsを<a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>で実行しているだけです。まずは単語の結果に対して(word.txt)に対して実行します。</p>
<pre class="code" data-lang="" data-unlink>$ hadoop jar /usr/lib/hadoop-0.20/contrib/streaming/hadoop-streaming-0.20.2-cdh3u3.jar -input madmagi_in/word.txt -output madmagi_out_word -mapper /home/yuta/work/dev/hadoop/map_reduce/mapper.js  -reducer /home/yuta/work/dev/hadoop/map_reduce/reducer.js -file /home/yuta/work/dev/hadoop/map_reduce/mapper.js -file /home/yuta/work/dev/hadoop/map_reduce/reducer.js

/yuta/work/dev/hadoop/map_reduce/map.py, /home/yuta/work/dev/hadoop/map_reduce/reduce.py, /var/lib/hadoop-0.20/cache/yuta/hadoop-unjar2165458985493486154/] [] /tmp/streamjob8394427362728426211.jar tmpDir=null
12/03/26 02:09:13 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
12/03/26 02:09:13 WARN snappy.LoadSnappy: Snappy native library not loaded
12/03/26 02:09:13 INFO mapred.FileInputFormat: Total input paths to process : 1
12/03/26 02:09:14 INFO streaming.StreamJob: getLocalDirs(): [/var/lib/hadoop-0.20/cache/yuta/mapred/local]
12/03/26 02:09:14 INFO streaming.StreamJob: Running job: job_201203260111_0017
12/03/26 02:09:14 INFO streaming.StreamJob: To kill this job, run:
12/03/26 02:09:14 INFO streaming.StreamJob: /usr/lib/hadoop-0.20/bin/hadoop job  -Dmapred.job.tracker=localhost:8021 -kill job_201203260111_0017
12/03/26 02:09:14 INFO streaming.StreamJob: Tracking URL: http://localhost.localdomain:50030/jobdetails.jsp?jobid=job_201203260111_0017
12/03/26 02:09:15 INFO streaming.StreamJob:  map 0%  reduce 0%
12/03/26 02:09:41 INFO streaming.StreamJob:  map 50%  reduce 0%
12/03/26 02:09:42 INFO streaming.StreamJob:  map 100%  reduce 0%
12/03/26 02:10:08 INFO streaming.StreamJob:  map 100%  reduce 100%
12/03/26 02:10:16 INFO streaming.StreamJob: Job complete: job_201203260111_0017
12/03/26 02:10:16 INFO streaming.StreamJob: Output: madmagi_out_word</pre><p>同様に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B7%C1%C2%D6%C1%C7%B2%F2%C0%CF">形態素解析</a>の結果(ma.txt)も<a class="keyword" href="http://d.hatena.ne.jp/keyword/Hadoop">Hadoop</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>します。</p>
<pre class="code" data-lang="" data-unlink>$ hadoop jar /usr/lib/hadoop-0.20/contrib/streaming/hadoop-streaming-0.20.2-cdh3u3.jar -input madmagi_in/ma.txt -output madmagi_out_ma -mapper /home/yuta/work/dev/hadoop/map_reduce/mapper.js  -reducer /home/yuta/work/dev/hadoop/map_reduce/reducer.js -file /home/yuta/work/dev/hadoop/map_reduce/mapper.js -file /home/yuta/work/dev/hadoop/map_reduce/reducer.js

59202/] [] /tmp/streamjob2162462095464428994.jar tmpDir=null
12/03/26 02:10:52 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
12/03/26 02:10:52 WARN snappy.LoadSnappy: Snappy native library not loaded
12/03/26 02:10:52 INFO mapred.FileInputFormat: Total input paths to process : 1
12/03/26 02:10:53 INFO streaming.StreamJob: getLocalDirs(): [/var/lib/hadoop-0.20/cache/yuta/mapred/local]
12/03/26 02:10:53 INFO streaming.StreamJob: Running job: job_201203260111_0018
12/03/26 02:10:53 INFO streaming.StreamJob: To kill this job, run:
12/03/26 02:10:53 INFO streaming.StreamJob: /usr/lib/hadoop-0.20/bin/hadoop job  -Dmapred.job.tracker=localhost:8021 -kill job_201203260111_0018
12/03/26 02:10:53 INFO streaming.StreamJob: Tracking URL: http://localhost.localdomain:50030/jobdetails.jsp?jobid=job_201203260111_0018
12/03/26 02:10:54 INFO streaming.StreamJob:  map 0%  reduce 0%
12/03/26 02:11:17 INFO streaming.StreamJob:  map 50%  reduce 0%
12/03/26 02:11:21 INFO streaming.StreamJob:  map 100%  reduce 0%
12/03/26 02:11:39 INFO streaming.StreamJob:  map 100%  reduce 100%
12/03/26 02:11:46 INFO streaming.StreamJob: Job complete: job_201203260111_0018
12/03/26 02:11:46 INFO streaming.StreamJob: Output: madmagi_out_ma</pre>
</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/HDFS">HDFS</a>からローカルへコピー</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/HDFS">HDFS</a>上の結果をローカルにコピーします。成功結果のpart-00000ファイルが出来ている事を確認します。</p>
<pre class="code" data-lang="" data-unlink>$ hdfs -get madmagi_out_word madmagi_out_word
$ hdfs -get madmagi_out_ma madmagi_out_ma
$ ls madmagi_out_word
drwxr-xr-x 3 yuta yuta  4096  3月 26 02:48 .
drwxr-xr-x 6 yuta yuta  4096  3月 26 02:46 ..
-rw-r--r-- 1 yuta yuta     0  3月 26 02:46 _SUCCESS
drwxr-xr-x 3 yuta yuta  4096  3月 26 02:46 _logs
-rw-r--r-- 1 yuta yuta 59377  3月 26 02:46 part-00000
$ ls madmagi_out_ma
drwxr-xr-x 3 yuta yuta  4096  3月 26 02:46 .
drwxr-xr-x 6 yuta yuta  4096  3月 26 02:46 ..
-rw-r--r-- 1 yuta yuta     0  3月 26 02:46 _SUCCESS
drwxr-xr-x 3 yuta yuta  4096  3月 26 02:46 _logs
-rw-r--r-- 1 yuta yuta 24294  3月 26 02:46 part-00000</pre><p>part-0000の中身は以下のようになっています。ここではword.txtに対して実行した結果のpart-00000を載せます。</p>
<pre class="code" data-lang="" data-unlink>あ  ,15   
あぁ ,1
あぁっ  ,2
ああ  ,5
ああそうだったの  ,1
ああでもしなきゃ  ,1
あいつは  ,3
あけみさんは  ,1
あげるよ  ,1
あたし  ,3
あたしが  ,1
あたしがこんな  ,1
(略)</pre><p>抽出で目立った単語としては以下のようになりました。</p>

<ul>
<li><span class="deco" style="color:#FF0000;">ほむら 7回</span></li>
<li><span class="deco" style="color:#FF0000;">グリーフシード 10回</span></li>
<li><span class="deco" style="color:#FF0000;">ワルプルギス 10回</span></li>
<li><span class="deco" style="color:#FF0000;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A5%A6%A5%EB%A5%B8%A5%A7%A5%E0">ソウルジェム</a> 17回</span></li>
<li><span class="deco" style="color:#FF0000;">さやかちゃん 36回</span></li>
<li><span class="deco" style="color:#FF0000;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/%CB%E2%CB%A1%BE%AF%BD%F7">魔法少女</a> 56回</span></li>
</ul>
</div>
</blockquote>

</div>
<div class="section">
<h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/Google">Google</a> Chart <a class="keyword" href="http://d.hatena.ne.jp/keyword/API">API</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/MapReduce">MapReduce</a>結果をグラフ化</h4>

<blockquote>
    
<div class="section">
<h5>データを<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>形式に変換</h5>
<p>part-00000といった結果を<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>形式に変換します。<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>に変換する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>コードは以下の通りです。結果をtext.jsとして保存します。</p>
<pre class="hljs python" data-lang="python" data-unlink><span class="synComment">#!/usr/bin/env python</span>
<span class="synPreProc">import</span> json,codecs
<span class="synIdentifier">map</span> = {}
<span class="synStatement">for</span> line <span class="synStatement">in</span> codecs.<span class="synIdentifier">open</span>( <span class="synConstant">'word.txt'</span>, <span class="synConstant">'r'</span>, <span class="synConstant">'utf-8'</span> ):
data = line.split( <span class="synConstant">':'</span> )
key = data[<span class="synConstant">0</span>]
value = data[<span class="synConstant">1</span>]
<span class="synIdentifier">map</span>[ key ] = value
<span class="synIdentifier">str</span> = json.dumps( <span class="synIdentifier">map</span> )
f = <span class="synIdentifier">open</span>( <span class="synConstant">'text.js'</span>, <span class="synConstant">'w'</span> )
f.write( <span class="synIdentifier">str</span> )
f.close()
</pre>
</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>形式をGoogleChartAPIで出力</h5>
<p>GoogleChartAPIに対してimgタグで読み込む<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>を次のように定義します。上で保存したtext.jsにて下で定義するdrawImage関数に<a class="keyword" href="http://d.hatena.ne.jp/keyword/json">json</a>データを渡すように修正が必要です。データ量が多いとURL長の制限を超えるので15個データを表示するようにしました。</p>
<pre class="hljs html" data-lang="html" data-unlink><span class="synIdentifier"><</span><span class="synStatement">html</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">head</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">meta</span><span class="synIdentifier"> </span><span class="synType">http-equiv</span><span class="synIdentifier">=</span><span class="synConstant">"content-type"</span><span class="synIdentifier"> </span><span class="synType">content</span><span class="synIdentifier">=</span><span class="synConstant">"text/html; charset=UTF-8"</span><span class="synIdentifier"> /></span>
<span class="synIdentifier"></</span><span class="synStatement">head</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">body</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">img</span><span class="synIdentifier"> </span><span class="synType">src</span><span class="synIdentifier">=</span><span class="synConstant">''</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">'chart'</span><span class="synIdentifier"> /></span>
<span class="synIdentifier"></</span><span class="synStatement">body</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">script</span><span class="synIdentifier">></span>
<span class="synIdentifier">var</span><span class="synSpecial"> drawImage = </span><span class="synIdentifier">function</span>(<span class="synSpecial"> json </span>)<span class="synSpecial"> </span><span class="synIdentifier">{</span>
<span class="synSpecial">    </span><span class="synIdentifier">var</span><span class="synSpecial"> base = </span><span class="synConstant">'http://chart.apis.google.com/chart?cht=bhg&chs=500x500'</span><span class="synSpecial">;</span>
<span class="synSpecial">    </span><span class="synIdentifier">var</span><span class="synSpecial"> count = </span><span class="synIdentifier">[]</span><span class="synSpecial">;</span>
<span class="synSpecial">    </span><span class="synIdentifier">var</span><span class="synSpecial"> title = </span><span class="synIdentifier">[]</span><span class="synSpecial">;</span>
<span class="synSpecial">    </span><span class="synIdentifier">var</span><span class="synSpecial"> j = </span>0<span class="synSpecial">;</span>
<span class="synSpecial">    </span><span class="synStatement">for</span>(<span class="synSpecial"> </span><span class="synIdentifier">var</span><span class="synSpecial"> i </span><span class="synStatement">in</span><span class="synSpecial"> json </span>)<span class="synSpecial"> </span><span class="synIdentifier">{</span>
<span class="synSpecial">        title</span><span class="synIdentifier">[</span><span class="synSpecial">j</span><span class="synIdentifier">]</span><span class="synSpecial"> = </span><span class="synConstant">'t'</span><span class="synSpecial"> + encodeURI </span>(<span class="synSpecial"> i </span>)<span class="synSpecial"> + </span><span class="synConstant">',333333,0,'</span><span class="synSpecial"> + j + </span><span class="synConstant">',13,1'</span><span class="synSpecial">;</span>
<span class="synSpecial">        count</span><span class="synIdentifier">[</span><span class="synSpecial">j</span><span class="synIdentifier">]</span><span class="synSpecial"> = json</span><span class="synIdentifier">[</span><span class="synSpecial">i</span><span class="synIdentifier">]</span><span class="synSpecial">;</span>
<span class="synSpecial">        j++;</span>
<span class="synSpecial">        </span><span class="synStatement">if</span>(<span class="synSpecial"> j == </span>15<span class="synSpecial"> </span>)<span class="synSpecial"> </span><span class="synIdentifier">{</span>
<span class="synSpecial">            </span><span class="synStatement">break</span><span class="synSpecial">;</span>
<span class="synSpecial">        </span><span class="synIdentifier">}</span>
<span class="synSpecial">    </span><span class="synIdentifier">}</span>
<span class="synSpecial">    </span><span class="synIdentifier">var</span><span class="synSpecial"> titles = title.join</span>(<span class="synSpecial"> </span><span class="synConstant">'|'</span><span class="synSpecial"> </span>)<span class="synSpecial">;</span>
<span class="synSpecial">    </span><span class="synIdentifier">var</span><span class="synSpecial"> counts = count.join</span>(<span class="synSpecial"> </span><span class="synConstant">','</span><span class="synSpecial"> </span>)<span class="synSpecial">;</span>
<span class="synSpecial">    url = base + </span><span class="synConstant">'&chd=t:'</span><span class="synSpecial"> + counts + </span><span class="synConstant">'&chdlp=tv|r&chxt=y,x&chm='</span><span class="synSpecial"> + titles;</span>
<span class="synSpecial">    </span><span class="synIdentifier">var</span><span class="synSpecial"> img = </span><span class="synStatement">document</span><span class="synSpecial">.getElementById</span>(<span class="synSpecial"> </span><span class="synConstant">'chart'</span><span class="synSpecial"> </span>)<span class="synSpecial">;</span>
<span class="synSpecial">    img.setAttribute</span>(<span class="synSpecial"> </span><span class="synConstant">'src'</span><span class="synSpecial">, url </span>)<span class="synSpecial">;</span>
<span class="synIdentifier">}</span>
<span class="synIdentifier"></</span><span class="synStatement">script</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">script</span><span class="synIdentifier"> </span><span class="synType">src</span><span class="synIdentifier">=</span><span class="synConstant">'./text.js'</span><span class="synIdentifier">></</span><span class="synStatement">script</span><span class="synIdentifier">></span>
<span class="synIdentifier"></</span><span class="synStatement">html</span><span class="synIdentifier">></span>
</pre>
</div>
<div class="section">
<h5>GoogleChartAPIの出力結果</h5>
<p><span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20120403013431" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20120403/20120403013431.png" alt="f:id:yutakikuchi:20120403013431p:image" title="f:id:yutakikuchi:20120403013431p:image" class="hatena-fotolife" itemprop="image"></a></span><br />
<span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20120403013430" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20120403/20120403013430.png" alt="f:id:yutakikuchi:20120403013430p:image" title="f:id:yutakikuchi:20120403013430p:image" class="hatena-fotolife" itemprop="image"></a></span><br />
文字が化けてしまって巧く表示されないケースもありますが、以前のNLTKで表示したグラフよりは奇麗に書けていると思います。単純にエクセルなどに落とし込んだ方がさらに奇麗に書けそうですが、今回はWebで試す事が目的だったのでこれにて終了です。</p>

</div>
</blockquote>

</div>

