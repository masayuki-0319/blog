<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="canonical" href="http://yut.hatenablog.com/entry/20101101/1288624960" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.4" />

  <title>Mysqlのメモ &middot; Y&#39;s note</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://yutakikuchi.github.io/blog/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/my.css">
    
  
  
    
        <script src="https://yutakikuchi.github.io/blog/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://yutakikuchi.github.io/blog/">Y's note</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/yutakikuchi_" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/yuta.kikuchi.007" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/https://www.slideshare.net/yutakikuchi58/" target="_blank"><i class="fa fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/https://www.linkedin.com/in/%E4%BD%91%E5%A4%AA-%E8%8F%8A%E6%B1%A0-36291a44/" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yutakikuchi" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Mysqlのメモ</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2010 Nov 01, 00:22</time>
  </div>

  

  

  

</div>

  

<h2 id="mysql-mysqlのメモ">[Mysql] : Mysqlのメモ</h2>

<div class="section">
<h4>概要</h4>
<p>学生の課題みたいだけど、学校の成績管理表を作成してみる。<br />
外部KEYの使い方についてのメモです。<br />
<br />
</p>

</div>
<div class="section">
<h4>tableの定義</h4>
<p># 生徒管理テーブル(student)<br />
# 科目管理テーブル(subject)<br />
# 成績管理テーブル(score)<br />
<br />
</p>

</div>
<div class="section">
<h4>ER図</h4>
<p><span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20101101234525" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20101101/20101101234525.png" alt="f:id:yutakikuchi:20101101234525p:image" title="f:id:yutakikuchi:20101101234525p:image" class="hatena-fotolife" itemprop="image"></a></span></p><p></p>

</div>
<div class="section">
<h4>やりたい事</h4>
<p># １つのテーブルでデータの重複をさせない制約をつける。<br />
# 生徒管理テーブルからデータがUPDATE/DELETEされたら、成績管理テーブルからもデータをUPDATE/DELETE。<br />
# 科目管理テーブルからデータがUPDATE/DELETEされたら、成績管理テーブルからもデータをUPDATE/DELETE。<br />
<br />
</p>

</div>
<div class="section">
<h4>データの重複をさせない(UNIQUEな値を入れる)</h4>
<p>カラム定義の最後にUNIQUEを指定します。そうすると一意な値のみ登録が可能になります。例えば科目名とか。</p>
<pre class="hljs sql" data-lang="sql" data-unlink><span class="synStatement">CREATE</span>  <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">NOT</span> <span class="synStatement">EXISTS</span> `Subject` (
  `id` INT <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span> ,
  `subject` <span class="synType">VARCHAR</span>(<span class="synConstant">45</span>) <span class="synSpecial">NULL</span> <span class="synSpecial">UNIQUE</span> ,
</pre>
</div>
<div class="section">
<h4>外部KEY制約を利用する。</h4>
<p>Engine Typeを<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>に設定する。<span style="color:#FF0000;">必ず外部KEY制約を設けるtableの両方を<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>に設定する。<br />
両方<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>に設定しないとtableをcreateする際にエラーが出る。Can't create table './<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>/table.frm' (errno: 150)</span><br />
<span style="font-weight:bold;font-style:italic;">FOREIGN KEY(a) REFERENCE parent(b)</span>を利用する。<br />
※<a class="keyword" href="http://d.hatena.ne.jp/keyword/error">error</a>:150の原因は他にもあるようです。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mysql">Mysql</a>のリファレンスに書いてあります。<br />
<a href="http://dev.mysql.com/doc/refman/4.1/ja/innodb-foreign-key-constraints.html">http://dev.mysql.com/doc/refman/4.1/ja/innodb-foreign-key-constraints.html</a><br />
</p>
<pre class="hljs sql" data-lang="sql" data-unlink>SHOW WARNINGS;
<span class="synStatement">CREATE</span>  <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">NOT</span> <span class="synStatement">EXISTS</span> `score` (
  `id` INT <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span> AUTO_INCREMENT ,
  `studentid` INT <span class="synSpecial">NULL</span> ,
  `subjectid` INT <span class="synSpecial">NULL</span> ,
  `score` INT <span class="synSpecial">NULL</span> ,
  PRIMARY KEY (`id`),
  FOREIGN KEY( `studentid` ) REFERENCE student( `id` ) <span class="synSpecial">ON</span> <span class="synStatement">UPDATE</span> CASCADE <span class="synSpecial">ON</span> <span class="synStatement">DELETE</span> CASCADE
  FOREIGN KEY( `subjectid` ) REFERENCE subject( `id` ) <span class="synSpecial">ON</span> <span class="synStatement">UPDATE</span> CASCADE <span class="synSpecial">ON</span> <span class="synStatement">DELETE</span> CASCADE
</pre>
</div>
<div class="section">
<h4>外部KEY制約のオプション</h4>
<p><span style="font-weight:bold;font-style:italic;">ON UPDATE <a class="keyword" href="http://d.hatena.ne.jp/keyword/CASCADE">CASCADE</a> ON DELETE <a class="keyword" href="http://d.hatena.ne.jp/keyword/CASCADE">CASCADE</a></span><br />
のようにカラムを定義すると親テーブルのUPDATEやDELETEを受けて子テーブルにそのActionを反映できる。</p>

<table>
<tr>
<th>*</th>
<th> ON DELETE </th>
<th> ON UPDATE </th>
</tr>
<tr>
<td> <a class="keyword" href="http://d.hatena.ne.jp/keyword/CASCADE">CASCADE</a> </td>
<td> 親テーブルと同じ値を子テーブルからも削除 </td>
<td> 親テーブルと同じ値を持つ子テーブルの値を更新 </td>
</tr>
<tr>
<td> RESTRICT </td>
<td> 制約エラー </td>
<td> 制約エラー </td>
</tr>
<tr>
<td> SET NULL </td>
<td> 子テーブルにNULLを設定 </td>
<td> 子テーブルにNULLを設定 </td>
</tr>
<tr>
<td> NO ACTION </td>
<td> デフォルトのエラー </td>
<td> デフォルトのエラー </td>
</tr>
</table><p>※ NOACTION とRESTRICT の違い<br />
<span style="font-weight:bold;font-style:italic;">NOACTION</span><br />
削除もしくは更新が外部キー制約違反となることを示すエラーを発生します。制約が遅延可能な場合、何らかの参照行が存在する限り、このエラーは制約の検査時点で発生します。これはデフォルトの動作です。<br />
<span style="font-weight:bold;font-style:italic;">RESTRICT</span><br />
削除もしくは更新が外部キー制約違反となることを示すエラーを発生します。検査が遅延できない点を除き、NO ACTIONと同じです。<br />
<br />
</p>

</div>
<div class="section">
<h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/SQL">SQL</a>全文</h4>
<pre class="hljs sql" data-lang="sql" data-unlink><span class="synStatement">SET</span> @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=<span class="synConstant">0</span>;
<span class="synStatement">SET</span> @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=<span class="synConstant">0</span>;
<span class="synStatement">SET</span> @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=<span class="synConstant">'TRADITIONAL'</span>;

<span class="synStatement">DROP</span> SCHEMA <span class="synSpecial">IF</span> <span class="synStatement">EXISTS</span> `mydb` ;
<span class="synStatement">CREATE</span> SCHEMA <span class="synSpecial">IF</span> <span class="synStatement">NOT</span> <span class="synStatement">EXISTS</span> `mydb` <span class="synSpecial">DEFAULT</span> <span class="synType">CHARACTER</span> <span class="synStatement">SET</span> latin1 COLLATE latin1_swedish_ci ;
SHOW WARNINGS;
USE `mydb` ;

<span class="synComment">-- -----------------------------------------------------</span>
<span class="synComment">-- Table `Student`</span>
<span class="synComment">-- -----------------------------------------------------</span>
<span class="synStatement">DROP</span> <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">EXISTS</span> `Student` ;

SHOW WARNINGS;
<span class="synStatement">CREATE</span>  <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">NOT</span> <span class="synStatement">EXISTS</span> `Student` (
  `id` INT <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span> AUTO_INCREMENT ,
  `name` <span class="synType">VARCHAR</span>(<span class="synConstant">45</span>) <span class="synSpecial">NULL</span> ,
  `mailaddress` <span class="synType">VARCHAR</span>(<span class="synConstant">45</span>) <span class="synSpecial">NULL</span> ,
  PRIMARY KEY (`id`) )
ENGINE = InnoDB;

SHOW WARNINGS;

<span class="synComment">-- -----------------------------------------------------</span>
<span class="synComment">-- Table `Subject`</span>
<span class="synComment">-- -----------------------------------------------------</span>
<span class="synStatement">DROP</span> <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">EXISTS</span> `Subject` ;

SHOW WARNINGS;
<span class="synStatement">CREATE</span>  <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">NOT</span> <span class="synStatement">EXISTS</span> `Subject` (
  `id` INT <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span> ,
  `subject` <span class="synType">VARCHAR</span>(<span class="synConstant">45</span>) <span class="synSpecial">NULL</span> <span class="synSpecial">UNIQUE</span> ,
  PRIMARY KEY (`id`) )
ENGINE = InnoDB;

SHOW WARNINGS;
<span class="synStatement">CREATE</span> <span class="synSpecial">UNIQUE</span> <span class="synSpecial">INDEX</span> `subject_UNIQUE` <span class="synSpecial">ON</span> `Subject` (`subject` <span class="synSpecial">ASC</span>) ;

SHOW WARNINGS;

<span class="synComment">-- -----------------------------------------------------</span>
<span class="synComment">-- Table `score`</span>
<span class="synComment">-- -----------------------------------------------------</span>
<span class="synStatement">DROP</span> <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">EXISTS</span> `score` ;

SHOW WARNINGS;
<span class="synStatement">CREATE</span>  <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">NOT</span> <span class="synStatement">EXISTS</span> `score` (
  `id` INT <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span> AUTO_INCREMENT ,
  `studentid` INT <span class="synSpecial">NULL</span> ,
  `subjectid` INT <span class="synSpecial">NULL</span> ,
  `score` INT <span class="synSpecial">NULL</span> ,
  PRIMARY KEY (`id`),
  FOREIGN KEY( `studentid` ) REFERENCE student( `id` ) <span class="synSpecial">ON</span> <span class="synStatement">UPDATE</span> CASCADE <span class="synSpecial">ON</span> <span class="synStatement">DELETE</span> CASCADE
  FOREIGN KEY( `subjectid` ) REFERENCE subject( `id` ) <span class="synSpecial">ON</span> <span class="synStatement">UPDATE</span> CASCADE <span class="synSpecial">ON</span> <span class="synStatement">DELETE</span> CASCADE
 )
ENGINE = InnoDB;

SHOW WARNINGS;

<span class="synComment">-- -----------------------------------------------------</span>
<span class="synComment">-- Placeholder table for view `view1`</span>
<span class="synComment">-- -----------------------------------------------------</span>
<span class="synStatement">CREATE</span> <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">NOT</span> <span class="synStatement">EXISTS</span> `view1` (`id` INT);
SHOW WARNINGS;

<span class="synComment">-- -----------------------------------------------------</span>
<span class="synComment">-- View `view1`</span>
<span class="synComment">-- -----------------------------------------------------</span>
<span class="synStatement">DROP</span> <span class="synSpecial">VIEW</span> <span class="synSpecial">IF</span> <span class="synStatement">EXISTS</span> `view1` ;
SHOW WARNINGS;
<span class="synStatement">DROP</span> <span class="synSpecial">TABLE</span> <span class="synSpecial">IF</span> <span class="synStatement">EXISTS</span> `view1`;
SHOW WARNINGS;
USE `mydb`;
;
SHOW WARNINGS;


<span class="synStatement">SET</span> SQL_MODE=@OLD_SQL_MODE;
<span class="synStatement">SET</span> FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
<span class="synStatement">SET</span> UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

</pre>
</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201010180037/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yutakikuchi.github.io/blog/post/201010180037/">serializeとjson関数の比較</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yutakikuchi.github.io/blog/post/201011030135/">Google app engineでBeautifulsoupを使う</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201011030135/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yutakikuchi.github.io/blog/js/ui.js"></script>
<script src="https://yutakikuchi.github.io/blog/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-20616165-3', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

