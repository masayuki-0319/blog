<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="canonical" href="http://yut.hatenablog.com/entry/20140401/1396308993" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.4" />

  <title>速いよ Java Play Framework &middot; Y&#39;s note</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yutakikuchi.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://yutakikuchi.github.io/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/my.css">
    
  
  
    
        <script src="https://yutakikuchi.github.io/blog/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://yutakikuchi.github.io/">Y's note</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/yutakikuchi_" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/yuta.kikuchi.007" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/https://www.slideshare.net/yutakikuchi58/" target="_blank"><i class="fa fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/https://www.linkedin.com/in/%E4%BD%91%E5%A4%AA-%E8%8F%8A%E6%B1%A0-36291a44/" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yutakikuchi" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>速いよ Java Play Framework</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2014 Apr 01, 08:36</time>
  </div>

  

  

  

</div>

  

<h2 id="java-速いよ-java-play-framework">[Java] : 速いよ Java Play Framework</h2>

<p><div class="amazlet-box"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4798133922/yutakikuchi-22/"><img src="http://ecx.images-amazon.com/images/I/51ogEBo-8yL._SL160_.jpg" class="hatena-asin-detail-image" alt="Play Framework 2徹底入門 JavaではじめるアジャイルWeb開発" title="Play Framework 2徹底入門 JavaではじめるアジャイルWeb開発"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4798133922/yutakikuchi-22/">Play Framework 2徹底入門 JavaではじめるアジャイルWeb開発</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> <a class="keyword" href="http://d.hatena.ne.jp/keyword/%BE%B8%C5%C4%C4%C5%CC%ED%C7%B5">掌田津耶乃</a>,原一浩</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> <a class="keyword" href="http://d.hatena.ne.jp/keyword/%E6%C6%B1%CB%BC%D2">翔泳社</a></li><li><span class="hatena-asin-detail-label">発売日:</span> 2013/12/17</li><li><span class="hatena-asin-detail-label">メディア:</span> 大型本</li><li><a href="http://d.hatena.ne.jp/asin/4798133922/yutakikuchi-22" target="_blank">この商品を含むブログ (7件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<div class="section">
<h4>言語とFrameworkの選定</h4>

<blockquote>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a>にはあまり魅力を感じていない<a href='http://twitter.com/yutakikuc'>@yutakikuc</a>です。本題とは関係ありませんが4.25(金)@ヒカリエのイベントに登壇します。ネタは同窓会GrowthHackとログ集計/解析の2本立てです。興味のある方はどうぞ。<a href="http://at-agent.jp/service/event/82/">【ヒカ☆ラボ】同窓会GrowthHack！×データログ集計、解析！をテーマに事例をまじえお話します！ 16年ぶりの再会でも参加率6割の同窓会を開くには？Yahoo出身のエンジニアが語る、アクセスログ可視化、 ユーザ属性解析を行うためのシステム設計のコツとは？</a> <a href="http://b.hatena.ne.jp/entry/at-agent.jp/service/event/82/"><img src="http://b.hatena.ne.jp/entry/image/http://at-agent.jp/service/event/82/" alt="はてなブックマーク - 【ヒカ☆ラボ】同窓会GrowthHack！×データログ集計、解析！をテーマに事例をまじえお話します！ 16年ぶりの再会でも参加率6割の同窓会を開くには？Yahoo出身のエンジニアが語る、アクセスログ可視化、 ユーザ属性解析を行うためのシステム設計のコツとは？" border="0" /></a></p><br />
<p><a href="http://www.techempower.com/benchmarks/">Round 8 results - TechEmpower Framework Benchmarks</a> <a href="http://b.hatena.ne.jp/entry/www.techempower.com/benchmarks/"><img src="http://b.hatena.ne.jp/entry/image/http://www.techempower.com/benchmarks/" alt="はてなブックマーク - Round 8 results - TechEmpower Framework Benchmarks" border="0" /></a><br />
さて、本題に入ります。僕が<a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a>を書き始めたのも前職のmain言語として指定されていたことがあり、あまり書いていて楽しく無いとは思っていながらも泣く泣く仕事としてやってい感じです。過去に何回か<a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a>のエントリー書いてますけどそれも仕事で利用する為です。前職は本当にphperの集まりでWebだけじゃなくて<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D0%A5%C3%A5%C1%BD%E8%CD%FD">バッチ処理</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>処理も全て<a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a>で書こうとする姿勢を初めて見たときは驚愕しました。まぁ速くコードを書くならそれでもいいんでしょうけど。</p><br />
<p>言語とFrameworkの選定にはドキュメント量、言語のCommitterや精通者がいる、必要なライブラリや機能がある、書き易い、チームの多数決等が基準となり決定されるケースが多いと感じます。僕なら「<span class="deco" style="color:#FF0000;font-weight:bold;">処理速度が速い</span>」を正義とし、それに掛け合わせる形で「<span class="deco" style="font-weight:bold;color:#FF0000;">書き易さ</span>」で選ぶと思います。時間コストを考える場合、もし新しい言語とFrameworkの導入で2人月掛かったとしても(2人月掛かることが許される場合)、Daily100万PVのサイトで0.2secリクエストが速くなったとしたら1日の処理削減コストは100万*0.2/(3600*24)の2.3人日。ということは一か月で導入コストの2人月は巻き返せる事になります。更にはユーザーがアプリを使った時の満足感も上がるはずですし。</p><br />
<p>僕は今Frameworkを使わずにCを書いていて<a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a>の3倍以上の速さが出ているので満足しているんですが、書き易さの点からは本当に最悪な状態。メモリの動的確保/解放や配列処理を本当に間違える...まぁそんな事で処理が速いとされ、<a class="keyword" href="http://d.hatena.ne.jp/keyword/C%B8%C0%B8%EC">C言語</a>より書き易い<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>,<a class="keyword" href="http://d.hatena.ne.jp/keyword/Scala">Scala</a>やGoのFrameworkを少しずつ勉強かつ紹介していけたらなと思い、今日はPlay Frameworkについて書きます。Play Frameworkはソース更新後の最初のアクセスで自動的に<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>をrebuildしてくれるようなので<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>の手間が省けてとても便利です。</p>

</blockquote>

</div>
<div class="section">
<h4>Play Framework</h4>

<blockquote>
    
<div class="section">
<h5>環境の確認と設定</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a>は6.4、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/java">java</a>-1.7.0-openjdk、playは2.2.2を使っています。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ cat /etc/system-release
CentOS release 6.4 <span class="synPreProc">(</span><span class="synSpecial">Final</span><span class="synPreProc">)</span>

$ yum list installed | <span class="synStatement">grep</span> java
java-1.5.0-gcj.x86_64   1.5.0.0-29.1.el6
java-1.7.0-openjdk.x86_64
java-1.7.0-openjdk-devel.x86_64
java_cup.x86_64         <span class="synConstant">1</span>:0.10k-5.el6   @base                                   
tzdata-java.noarch      2014a-1.el6     @updates

$ java <span class="synSpecial">-version</span>
java version <span class="synStatement">"</span><span class="synConstant">1.7.0_51</span><span class="synStatement">"</span>
OpenJDK Runtime Environment <span class="synPreProc">(</span><span class="synSpecial">rhel-2.4.4.1.el6_5-x86_64 u51-b02</span><span class="synPreProc">)</span>
OpenJDK <span class="synConstant">64</span>-Bit Server VM <span class="synPreProc">(</span><span class="synSpecial">build 24.45-b08, mixed mode</span><span class="synPreProc">)</span>

$ alternatives <span class="synSpecial">--display</span> java
/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/java - 優先項目 <span class="synConstant">170051</span>
 スレーブ keytool: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/keytool
 スレーブ orbd: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/orbd
 スレーブ pack200: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/pack200
 スレーブ rmid: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/rmid
 スレーブ rmiregistry: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/rmiregistry
 スレーブ servertool: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/servertool
 スレーブ tnameserv: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/tnameserv
 スレーブ unpack200: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/unpack200
 スレーブ jre_exports: /usr/lib/jvm-exports/jre-1.7.0-openjdk.x86_64
 スレーブ jre: /usr/lib/jvm/jre-1.7.0-openjdk.x86_64
 スレーブ java.1.gz: /usr/share/man/man1/java-java-1.7.0-openjdk.1.gz
 スレーブ keytool.1.gz: /usr/share/man/man1/keytool-java-1.7.0-openjdk.1.gz
 スレーブ orbd.1.gz: /usr/share/man/man1/orbd-java-1.7.0-openjdk.1.gz
 スレーブ pack200.1.gz: /usr/share/man/man1/pack200-java-1.7.0-openjdk.1.gz
 スレーブ rmid.1.gz: /usr/share/man/man1/rmid-java-1.7.0-openjdk.1.gz
 スレーブ rmiregistry.1.gz: /usr/share/man/man1/rmiregistry-java-1.7.0-openjdk.1.gz
 スレーブ servertool.1.gz: /usr/share/man/man1/servertool-java-1.7.0-openjdk.1.gz
 スレーブ tnameserv.1.gz: /usr/share/man/man1/tnameserv-java-1.7.0-openjdk.1.gz
 スレーブ unpack200.1.gz: /usr/share/man/man1/unpack200-java-1.7.0-openjdk.1.gz
現在の「最適」バージョンは /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/java です。

$ vi ~/.zshrc
<span class="synComment">#2行追記</span>
<span class="synIdentifier">JAVA_HOME</span>=/usr/lib/jvm/java-1.7.0/
<span class="synStatement">export</span><span class="synIdentifier"> JAVA_HOME</span>
<span class="synIdentifier">PATH</span>=<span class="synPreProc">${JAVA_HOME}</span>/bin:<span class="synPreProc">$PATH</span>:/home/yuta/work/src/play/play-2.2.2/:/home/yuta/work/src/sbt/sbt/bin/
<span class="synStatement">export</span><span class="synIdentifier"> CLASSPATH=</span><span class="synPreProc">$JAVA_HOME</span>/jre/lib/ext:<span class="synPreProc">$JAVA_HOME</span>/lib/tools.jar

$ <span class="synStatement">type</span> javac
javac is /usr/bin/javac
</pre>
</div>
<div class="section">
<h5>installと実行</h5>
<pre class="hljs sh" data-lang="sh" data-unlink>$ wget <span class="synStatement">"</span><span class="synConstant">http://downloads.typesafe.com/play/2.2.2/play-2.2.2.zip</span><span class="synStatement">"</span>
$ unzip play-2.2.2.zip
$ <span class="synStatement">cd</span> play-2.2.2

<span class="synComment"># helloworldプロジェクトを作成</span>
$./play new helloworld 
   _
 _ __ | | __ _ _  _
| <span class="synStatement">'</span><span class="synConstant">_ \| |/ _</span><span class="synStatement">'</span> | || |
|  __/|_|\____|\__ /
|_|            |__/

play 2.2.2 built with Scala 2.10.3 <span class="synPreProc">(</span><span class="synSpecial">running Java 1.7.0_51</span><span class="synPreProc">)</span>, http://www.playframework.com

The new application will be created <span class="synError">in</span> /home/yuta/work/src/play/play-2.2.2/helloworld

What is the application name? <span class="synStatement">[</span>helloworld<span class="synStatement">]</span>
<span class="synStatement">></span> helloworld

Which template <span class="synStatement">do</span> you want to use <span class="synStatement">for </span>this new application? 

  <span class="synConstant">1</span>             - Create a simple Scala application
  <span class="synConstant">2</span>             - Create a simple Java application

<span class="synComment"># ここではJavaを選択</span>
<span class="synStatement">></span> <span class="synConstant">2</span>
OK, application helloworld is created.

Have fun<span class="synStatement">!</span>

$ <span class="synStatement">cd</span> helloworld
$ ../play run

../play run
Getting org.scala-sbt sbt 0.13.0 ...
<span class="synComment">:</span>: retrieving :: org.scala-sbt#boot-app
confs: <span class="synStatement">[</span>default<span class="synStatement">]</span>
<span class="synConstant">43</span> artifacts copied, <span class="synConstant">0</span> already retrieved <span class="synStatement">(</span>12440kB/579ms<span class="synStatement">)</span>
<span class="synStatement">[</span>info<span class="synStatement">]</span> Loading project definition from /home/yuta/work/src/play/play-2.2.2/helloworld/project

<span class="synStatement">[</span>info<span class="synStatement">]</span> Set current project to helloworld <span class="synStatement">(</span>in build file:/home/yuta/work/src/play/play-2.2.2/helloworld/<span class="synStatement">)</span>
<span class="synStatement">[</span>info<span class="synStatement">]</span> Updating <span class="synSpecial">{</span>file:/home/yuta/work/src/play/play-2.2.2/helloworld/<span class="synSpecial">}</span>helloworld...
<span class="synStatement">[</span>info<span class="synStatement">]</span> Resolving org.fusesource.jansi#jansi<span class="synStatement">;</span>1.4 ...
<span class="synStatement">[</span>info<span class="synStatement">]</span> Done updating.

--- <span class="synStatement">(</span>Running the application from SBT, auto-reloading is enabled<span class="synStatement">)</span> <span class="synSpecial">---</span>

<span class="synStatement">[</span>info<span class="synStatement">]</span> play - Listening <span class="synStatement">for </span>HTTP on /<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">9000</span>

(Server started, use Ctrl+D to <span class="synStatement">stop</span> and go back to the console...<span class="synError">)</span>

<span class="synStatement">[</span>info<span class="synStatement">]</span> Compiling <span class="synConstant">4</span> Scala sources and <span class="synConstant">2</span> Java sources to /home/yuta/work/src/play/play-2.2.2/helloworld/target/scala-2.10/classes...
<span class="synStatement">[</span>info<span class="synStatement">]</span> Error occurred during initialization of VM
<span class="synStatement">[</span>info<span class="synStatement">]</span> Could not reserve enough space <span class="synStatement">for </span>object heap
<span class="synStatement">[</span>error<span class="synStatement">]</span> Error: Could not create the Java Virtual Machine.
<span class="synStatement">[</span>error<span class="synStatement">]</span> Error: A fatal exception has occurred. Program will exit.
</pre><p>初回実行時は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>のheapエラーで怒られてしまいました。<span class="deco" style="color:#FF0000;font-weight:bold;">play-2.2.2/framework/build</span>ファイルのheap領域指定のオプションを修正します。僕は自分の環境に合せて-Xmx1536Mから-Xmxを768Mに修正しました。<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A4%B0%A4%B0%A4%EB">ぐぐる</a>と同じディレクトリにあるbuild.batを修正する内容も見かけるので、そちらの-Xmxも合せて修正しておくと良いと思います。修正後にplay runで問題なく起動します。9000ポートで見れるように解放も忘れないようにしましょう。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ <span class="synStatement">cd</span> framework
$ vi build
<span class="synComment"># Xmxを768Mに修正</span>
<span class="synStatement">"</span><span class="synPreProc">$JAVA</span><span class="synStatement">"</span> <span class="synPreProc">${DEBUG_PARAM}</span> <span class="synSpecial">-Xms512M</span> <span class="synSpecial">-Xmx768M</span> <span class="synSpecial">-Xss1M</span> <span class="synSpecial">-XX</span>:<span class="synIdentifier">ReservedCodeCacheSize</span>=192m <span class="synSpecial">-XX</span>:+CMSClassUnloadingEnabled <span class="synSpecial">-XX</span>:<span class="synIdentifier">MaxPermSize</span>=512M <span class="synPreProc">${JAVA_OPTS}</span> -<span class="synIdentifier">Dfile.encoding</span>=UTF<span class="synConstant">-8</span> -<span class="synIdentifier">Dplay.version</span>=<span class="synStatement">"</span><span class="synPreProc">${PLAY_VERSION}</span><span class="synStatement">"</span> -<span class="synIdentifier">Dplay.home</span>=<span class="synSpecial">`dirname </span><span class="synPreProc">$0</span><span class="synSpecial">`</span> -<span class="synIdentifier">Dsbt.boot.properties</span>=<span class="synSpecial">`dirname </span><span class="synPreProc">$0</span><span class="synSpecial">`</span>/sbt/sbt.boot.properties -<span class="synIdentifier">Dsbt.scala.version</span>=<span class="synPreProc">${SBT_SCALA_VERSION}</span> <span class="synPreProc">${PLAY_OPTS}</span> <span class="synSpecial">-jar</span> <span class="synSpecial">`dirname </span><span class="synPreProc">$0</span><span class="synSpecial">`</span>/sbt/sbt-launch.jar <span class="synStatement">"</span><span class="synPreProc">$@</span><span class="synStatement">"</span>

<span class="synComment"># playの再起動</span>
$ <span class="synStatement">cd</span> helloworld
$ play run

--- <span class="synPreProc">(</span><span class="synSpecial">Running the application from SBT, auto-reloading is enabled</span><span class="synPreProc">)</span> <span class="synSpecial">---</span>

<span class="synStatement">[</span>info<span class="synStatement">]</span> play - Listening <span class="synStatement">for </span>HTTP on /<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">9000</span>

(Server started, use Ctrl+D to <span class="synStatement">stop</span> and go back to the console...<span class="synError">)</span>

<span class="synStatement">[</span>info<span class="synStatement">]</span> play - Application started <span class="synStatement">(</span>Dev<span class="synStatement">)</span>

$ sudo vim /etc/sysconfig/iptables
<span class="synComment"># 追加</span>
<span class="synStatement">-A</span> INPUT <span class="synStatement">-m</span> state <span class="synSpecial">--state</span> NEW <span class="synStatement">-m</span> tcp <span class="synStatement">-p</span> tcp <span class="synSpecial">--dport</span> <span class="synConstant">9000</span> <span class="synStatement">-j</span> ACCEPT
$ sudo service iptables <span class="synStatement">restart</span> 
</pre>
</div>
</blockquote>

</div>
<div class="section">
<h4>Practice</h4>

<blockquote>
    <p><a href="http://www.playframework-ja.org/documentation/2.1.5/JavaHome">JavaHome(日本語)</a> <a href="http://b.hatena.ne.jp/entry/www.playframework-ja.org/documentation/2.1.5/JavaHome"><img src="http://b.hatena.ne.jp/entry/image/http://www.playframework-ja.org/documentation/2.1.5/JavaHome" alt="はてなブックマーク - JavaHome" border="0" /></a><br />
<a href="http://www.playframework.com/documentation/2.2.2/JavaHome">JavaHome(English)</a> <a href="http://b.hatena.ne.jp/entry/www.playframework.com/documentation/2.2.2/JavaHome"><img src="http://b.hatena.ne.jp/entry/image/http://www.playframework.com/documentation/2.2.2/JavaHome" alt="はてなブックマーク - JavaHome" border="0" /></a></p>

<div class="section">
<h5>目的</h5>
<p>以下ではDBからデータを引っ張ってViewに表示するまでの一連の処理を<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a> Play Frameworkで記載します。</p>

</div>
<div class="section">
<h5>File layout</h5>
<p>appの下に<a class="keyword" href="http://d.hatena.ne.jp/keyword/MVC">MVC</a>のロジックを書くようですが、本家のドキュメントにあるようなmodelsディレクトリが生成されません。ちなみにですが、日本語のplay framewokのドキュメントは2.1.5までのversionしかないので、新しいドキュメントを参照したい場合は本家を見た方が良いです。modelsディレクトリは自分でapp以下に付け足して以下のlayoutにします。また後で追加するjar系のlibraryを配置するlibも無いので追加します。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ <span class="synStatement">pwd</span>
/home/yuta/work/src/play/play-2.2.2/helloworld
$ tree <span class="synSpecial">-L</span> <span class="synConstant">2</span>
├── README
├── app
│        ├── controllers
│        ├── models
│        └── views
├── build.sbt
├── conf
│         ├── application.conf
│         └── routes
├── lib
├── logs
│         └── application.log
├── project
│         ├── Build.scala
│         ├── build.properties
│         ├── plugins.sbt
│         ├── project
│         └── target
├── public
│         ├── images
│         ├── javascripts
│         └── stylesheets
├── target
│         ├── native_libraries
│         ├── resolution-cache
│         ├── scala-2.10
│         └── streams
└── <span class="synStatement">test</span>
├── ApplicationTest.java
└── IntegrationTest.java
</pre>
</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>の設定</h5>
<p>お試しなので簡単にid,titile,created_at,updated_atのカラムを持つテーブルを定義し、2つデータをINSERTします。</p>
<pre class="hljs mysql" data-lang="mysql" data-unlink><span class="synStatement">DROP</span> <span class="synStatement">TABLE</span> helloworld.hello;
<span class="synStatement">CREATE</span> <span class="synStatement">TABLE</span> helloworld.hello(
id <span class="synType">INT</span>(<span class="synConstant">11</span>) <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span> <span class="synStatement">AUTO_INCREMENT</span>,
title <span class="synType">VARCHAR(</span><span class="synConstant">64</span><span class="synType">)</span> <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span>,
created_at <span class="synType">DATETIME</span> <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span>, 
updated_at <span class="synType">DATETIME</span> <span class="synStatement">NOT</span> <span class="synSpecial">NULL</span>,
<span class="synStatement">PRIMARY</span> <span class="synStatement">KEY</span> (id)
);
<span class="synStatement">INSERT</span> <span class="synStatement">INTO</span> helloworld.hello(title,created_at,updated_at) <span class="synStatement">VALUES</span>(<span class="synConstant">'This is Hello World!'</span>, <span class="synIdentifier">NOW()</span>, <span class="synIdentifier">NOW()</span>);
<span class="synStatement">INSERT</span> <span class="synStatement">INTO</span> helloworld.hello(title,created_at,updated_at) <span class="synStatement">VALUES</span>(<span class="synConstant">'World is not Enough!'</span>, <span class="synIdentifier">NOW()</span>, <span class="synIdentifier">NOW()</span>);
</pre>
</div>
<div class="section">
<h5>Modelの用意</h5>
<p>上のTableと接続するDBModelをmodels/Hello.<a class="keyword" href="http://d.hatena.ne.jp/keyword/java">java</a>という名前で保存します。一般的なDBModelでpropertyに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A5%E9%A5%E0%CC%BE">カラム名</a>、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>にデータやり取りの関数を記載します。またここでは紹介しませんが<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>のコードで良く見かけるConnection connection = DB.getConnection();connection.createStatement().execute();のように手続き型でもDBからデータを取得する事は可能なようです。</p>
<pre class="hljs java" data-lang="java" data-unlink><span class="synPreProc">package</span> models;
<span class="synPreProc">import</span> java.util.*;
<span class="synPreProc">import</span> play.db.ebean.*;
<span class="synPreProc">import</span> play.data.validation.Constraints.*;
<span class="synPreProc">import</span> javax.persistence.*;

<span class="synPreProc">@Entity</span>
<span class="synType">public</span> <span class="synType">class</span> Hello <span class="synType">extends</span> Model {
  <span class="synPreProc">@Id</span> 
  <span class="synType">public</span> Integer id;
  <span class="synPreProc">@Column</span>
  <span class="synType">public</span> String title;
  <span class="synPreProc">@Column</span>
  <span class="synType">public</span> Date created_at;
  <span class="synPreProc">@Column</span>
  <span class="synType">public</span> Date updated_at;
  <span class="synType">public</span> <span class="synType">static</span> Finder<Long,Hello> find = <span class="synStatement">new</span> Finder(Long.<span class="synType">class</span>, Hello.<span class="synType">class</span>);
  <span class="synType">public</span> <span class="synType">static</span> List<Hello> all() {
<span class="synStatement">return</span> find.all();
  }
}
</pre>
</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a> driver</h5>
<p>Play FrameworkのdefaultでのDBEngineはh2になっているので<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>に変更します。conf/application.confの設定を以下のように変更します。またproject/Build.<a class="keyword" href="http://d.hatena.ne.jp/keyword/scala">scala</a>というファイルを作成し<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>-connector-<a class="keyword" href="http://d.hatena.ne.jp/keyword/java">java</a>を依存として記述するとplayの再起動時にdownloadしてくれます。ただしdownload先がProjectの一つ上のディレクトリのrepositoryに配置されるので、lib以下にコピーします。準備が整ったらplay runにて再起動をしてアクセスをしてみます。Database 'default' needs evolution!という<a class="keyword" href="http://d.hatena.ne.jp/keyword/error">error</a>画面が出てもApply This Script Now!というボタンを押下し、更に先の画面でMart it resolvedというボタンを押下すれば処理が先に進みます。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ vi conf/application.conf

<span class="synIdentifier">db.default.driver</span>=com.mysql.jdbc.Driver
<span class="synIdentifier">db.default.url</span>=<span class="synStatement">"</span><span class="synConstant">jdbc:mysql://localhost/helloworld?characterEncoding=UTF8</span><span class="synStatement">"</span>
<span class="synIdentifier">db.default.user</span>=root
<span class="synIdentifier">db.default.password</span>=<span class="synStatement">""</span>
<span class="synIdentifier">ebean.default</span>=<span class="synStatement">"</span><span class="synConstant">models.*</span><span class="synStatement">"</span>

$ vi project/Build.scala 

import sbt._
import Keys._
import play.Project._

object ApplicationBuild extends Build <span class="synSpecial">{</span>

  val appName         <span class="synStatement">=</span> <span class="synStatement">"</span><span class="synConstant">helloworld</span><span class="synStatement">"</span>
  val appVersion      <span class="synStatement">=</span> <span class="synStatement">"</span><span class="synConstant">1.0-SNAPSHOT</span><span class="synStatement">"</span>
  
  val appDependencies <span class="synStatement">=</span> Seq<span class="synStatement">(</span>
// Add your project dependencies here,
javaCore,
javaJdbc,
javaEbean,
<span class="synStatement">"</span><span class="synConstant">mysql</span><span class="synStatement">"</span> % <span class="synStatement">"</span><span class="synConstant">mysql-connector-java</span><span class="synStatement">"</span> % <span class="synStatement">"</span><span class="synConstant">5.1.20</span><span class="synStatement">"</span>
  <span class="synStatement">)</span>
 
  val subProject <span class="synStatement">=</span> <span class="synConstant">Project(</span><span class="synStatement">"</span><span class="synConstant">subProject</span><span class="synStatement">"</span><span class="synConstant">,file(</span><span class="synStatement">"</span><span class="synConstant">subProject-dir</span><span class="synStatement">"</span>))
  val main <span class="synStatement">=</span> play.Project<span class="synStatement">(</span>appName, appVersion, appDependencies, path <span class="synStatement">=</span> <span class="synConstant">file(</span><span class="synStatement">"</span><span class="synConstant">playProject</span><span class="synStatement">")</span>)
.dependsOn<span class="synStatement">(</span>subProject<span class="synStatement">)</span>
<span class="synSpecial">}</span>

$ cp ../repository/cache/mysql/mysql-connector-java/jars/mysql-connector-java-5.1.20.jar lib/

$ play run
--- <span class="synPreProc">(</span><span class="synSpecial">Running the application from SBT, auto-reloading is enabled</span><span class="synPreProc">)</span> <span class="synSpecial">---</span>

<span class="synStatement">[</span>info<span class="synStatement">]</span> play - Listening <span class="synStatement">for </span>HTTP on /<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">0</span>:<span class="synConstant">9000</span>

(Server started, use Ctrl+D to <span class="synStatement">stop</span> and go back to the console...<span class="synError">)</span>

<span class="synStatement">[</span>info<span class="synStatement">]</span> Updating <span class="synSpecial">{</span>file:/home/yuta/work/src/play/play-2.2.2/helloworld/<span class="synSpecial">}</span>subProject...
<span class="synStatement">[</span>info<span class="synStatement">]</span> Resolving org.fusesource.jansi#jansi<span class="synStatement">;</span>1.4 ...
<span class="synStatement">[</span>info<span class="synStatement">]</span> Done updating.
<span class="synStatement">[</span>info<span class="synStatement">]</span> Updating <span class="synSpecial">{</span>file:/home/yuta/work/src/play/play-2.2.2/helloworld/<span class="synSpecial">}</span>helloworld...
<span class="synStatement">[</span>info<span class="synStatement">]</span> Resolving org.fusesource.jansi#jansi<span class="synStatement">;</span>1.4 ...
<span class="synStatement">[</span>info<span class="synStatement">]</span> downloading http://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.20/mysql-connector-java-5.1.20.jar ...
<span class="synStatement">[</span>info<span class="synStatement">]</span>  <span class="synStatement">[</span>SUCCESSFUL <span class="synStatement">]</span> mysql#mysql-connector-java<span class="synStatement">;</span>5.1.20<span class="synStatement">!</span>mysql-connector-java.jar <span class="synStatement">(</span>3416ms<span class="synStatement">)</span>
<span class="synStatement">[</span>info<span class="synStatement">]</span> Done updating.
<span class="synStatement">[</span>error<span class="synStatement">]</span> application - 
<span class="synStatement">!</span> @6hlo1ai71 - Internal server error, <span class="synStatement">for </span>(GET<span class="synError">)</span> <span class="synStatement">[</span>/<span class="synStatement">]</span> -<span class="synStatement">></span>
play.api.db.evolutions.InvalidDatabaseRevision: Database <span class="synStatement">'</span><span class="synConstant">default</span><span class="synStatement">'</span> needs evolution<span class="synStatement">![</span>An SQL script need to be run on your database.<span class="synStatement">]</span>

(略<span class="synError">)</span>

<span class="synStatement">!</span> @6hlo29f7h - Internal server error, <span class="synStatement">for </span>(GET<span class="synError">)</span> <span class="synStatement">[</span>/@evolutions/apply/default?redirect<span class="synStatement">=</span><span class="synConstant">http</span>%3A%2F%2Flocalhost%3A9000%2F<span class="synStatement">]</span> -<span class="synStatement">></span>

play.api.db.evolutions.InconsistentDatabase: Database <span class="synStatement">'</span><span class="synConstant">default</span><span class="synStatement">'</span> is <span class="synStatement">in</span> an inconsistent state<span class="synStatement">![</span>An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved.<span class="synStatement">]</span>
</pre>
</div>
<div class="section">
<h5>Controller</h5>
<p>Controllerの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>呼び出しはconf/routesで決定されます。<span class="deco" style="font-weight:bold;">GET / controllers.Application.index()</span>という記述が/にアクセスした時にcontrollersのApplicationクラスのindex<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を呼び出すという定義です。Frameworkによくあるお決まりのやつですね。上で定義したHelloModelのall<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を呼び出してDBに格納されているデータの一覧を取得してViewに渡します。return ok();の記述でStatus:200OKを返すようです。okの中のhelloworld.render(hello)でhelloworldのviewに渡すデータを書きます。ここではList型を渡します。</p>
<pre class="hljs java" data-lang="java" data-unlink><span class="synPreProc">package</span> controllers;
<span class="synPreProc">import</span> java.util.*;
<span class="synPreProc">import</span> play.*;
<span class="synPreProc">import</span> views.html.*;
<span class="synPreProc">import</span> models.*;

<span class="synType">public</span> <span class="synType">class</span> Application <span class="synType">extends</span> Controller {
  <span class="synType">public</span> <span class="synType">static</span> Result index() {
List<Hello> hello = Hello.all();
  <span class="synStatement">return</span> ok(helloworld.render(hello));
  }   
}
</pre>
</div>
<div class="section">
<h5>View</h5>
<p>Play Frameworkは<a class="keyword" href="http://d.hatena.ne.jp/keyword/MVC">MVC</a>のMCは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>で書けてもViewだけは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Scala">Scala</a>文法なのでそこだけは新しく勉強が必要ですが、記述がとても簡単なので難なくこなせると思います。htmlタグの中への記述もとてもSimpleに書けて楽しいです。下のファイルをviews/helloworld.<a class="keyword" href="http://d.hatena.ne.jp/keyword/scala">scala</a>.htmlという名前で保存します。これでDBに入れたデータが表示できるので一通りModel=>Controller=>Viewへのデータのやり取りを記載する事ができました。</p>
<pre class="hljs html" data-lang="html" data-unlink>@(data: List[Hello])
<span class="synComment"><!DOCTYPE html></span>
<span class="synIdentifier"><</span><span class="synStatement">html</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">head</span><span class="synIdentifier">></</span><span class="synStatement">head</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">body</span><span class="synIdentifier">></span>
@for(node <span class="synIdentifier"><</span>-<span class="synIdentifier"> </span><span class="synType">data</span><span class="synIdentifier">) {</span>
<span class="synIdentifier">   </span><span class="synError"><</span><span class="synIdentifier">p></span>id:   @node.id<span class="synIdentifier"></</span><span class="synStatement">p</span><span class="synIdentifier">></span> 
   <span class="synIdentifier"><</span><span class="synStatement">p</span><span class="synIdentifier">></span>title:@node.title<span class="synIdentifier"></</span><span class="synStatement">p</span><span class="synIdentifier">></span> 
   <span class="synIdentifier"><</span><span class="synStatement">p</span><span class="synIdentifier">></span>created_at:@node.created_at<span class="synIdentifier"></</span><span class="synStatement">p</span><span class="synIdentifier">></span> 
   <span class="synIdentifier"><</span><span class="synStatement">p</span><span class="synIdentifier">></span>updated_at:@node.updated_at<span class="synIdentifier"></</span><span class="synStatement">p</span><span class="synIdentifier">></span> 
}
<span class="synIdentifier"></</span><span class="synStatement">body</span><span class="synIdentifier">></span>
<span class="synIdentifier"></</span><span class="synStatement">html</span><span class="synIdentifier">></span>
</pre>
</div>
</blockquote>

</div>
<div class="section">
<h4>Performance</h4>

<blockquote>
    
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a></h5>
<p>Frameworkを使わずに<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>に接続してデータを取得する処理をScriptとして記載したものをab<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>で実行した結果です。<span class="deco" style="color:#FF0000;font-weight:bold;">rpsは176.39</span>となりました。</p>
<pre class="hljs php" data-lang="php" data-unlink><span class="synComment"><!DOCTYPE html></span>
<span class="synIdentifier"><</span><span class="synStatement">html</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">head</span><span class="synIdentifier">></</span><span class="synStatement">head</span><span class="synIdentifier">></span>
<span class="synIdentifier"><</span><span class="synStatement">body</span><span class="synIdentifier">></span>
<span class="synSpecial"><?php</span>

<span class="synStatement">$</span><span class="synIdentifier">link</span> <span class="synStatement">=</span> <span class="synIdentifier">mysqli_connect</span><span class="synSpecial">(</span>'<span class="synConstant">localhost</span>', '<span class="synConstant">root</span>', '', '<span class="synConstant">helloworld</span>'<span class="synSpecial">)</span>;
<span class="synStatement">$</span><span class="synIdentifier">query</span> <span class="synStatement">=</span> '<span class="synConstant">SELECT id,title,created_at,updated_at FROM hello</span>';
<span class="synStatement">$</span><span class="synIdentifier">result</span> <span class="synStatement">=</span> <span class="synStatement">$</span><span class="synIdentifier">link</span><span class="synType">-></span>query<span class="synSpecial">(</span><span class="synStatement">$</span><span class="synIdentifier">query</span><span class="synSpecial">)</span>;
<span class="synStatement">while</span><span class="synSpecial">(</span><span class="synStatement">$</span><span class="synIdentifier">row</span> <span class="synStatement">=</span> <span class="synIdentifier">mysqli_fetch_array</span><span class="synSpecial">(</span><span class="synStatement">$</span><span class="synIdentifier">result</span><span class="synSpecial">))</span> <span class="synSpecial">{</span>
  <span class="synPreProc">echo</span> '<span class="synConstant"><p></span>' <span class="synStatement">.</span> <span class="synStatement">$</span><span class="synIdentifier">row</span><span class="synSpecial">[</span>'<span class="synConstant">id</span>'<span class="synSpecial">]</span> <span class="synStatement">.</span> '<span class="synConstant"></p><br/></span>';
  <span class="synPreProc">echo</span> '<span class="synConstant"><p></span>' <span class="synStatement">.</span> <span class="synStatement">$</span><span class="synIdentifier">row</span><span class="synSpecial">[</span>'<span class="synConstant">title</span>'<span class="synSpecial">]</span> <span class="synStatement">.</span> '<span class="synConstant"></p><br/></span>';
  <span class="synPreProc">echo</span> '<span class="synConstant"><p></span>' <span class="synStatement">.</span> <span class="synStatement">$</span><span class="synIdentifier">row</span><span class="synSpecial">[</span>'<span class="synConstant">created_at</span>'<span class="synSpecial">]</span> <span class="synStatement">.</span> '<span class="synConstant"></p><br/></span>';
  <span class="synPreProc">echo</span> '<span class="synConstant"><p></span>' <span class="synStatement">.</span> <span class="synStatement">$</span><span class="synIdentifier">row</span><span class="synSpecial">[</span>'<span class="synConstant">updated_at</span>'<span class="synSpecial">]</span> <span class="synStatement">.</span> '<span class="synConstant"></p><br/></span>';
<span class="synSpecial">}</span>
<span class="synIdentifier">mysqli_close</span><span class="synSpecial">(</span><span class="synStatement">$</span><span class="synIdentifier">link</span><span class="synSpecial">)</span>;
<span class="synSpecial">?></span>
<span class="synIdentifier"></</span><span class="synStatement">body</span><span class="synIdentifier">></span>
<span class="synIdentifier"></</span><span class="synStatement">html</span><span class="synIdentifier">></span>
</pre><pre class="hljs sh" data-lang="sh" data-unlink>$ ab <span class="synSpecial">-n</span> <span class="synConstant">50000</span> <span class="synSpecial">-c</span> <span class="synConstant">100</span> <span class="synStatement">"</span><span class="synConstant">http://localhost/helloworld.php</span><span class="synStatement">"</span>
Server Software:        Apache/2.2.15
Server Hostname:        localhost
Server Port:            <span class="synConstant">80</span>

Document Path:          /helloworld.php
Document Length:        <span class="synConstant">274</span> bytes

Concurrency Level:      <span class="synConstant">100</span>
Time taken <span class="synStatement">for </span>tests:   283.461 seconds
Complete requests:      <span class="synConstant">50000</span>
Failed requests:        <span class="synConstant">0</span>
Write errors:           <span class="synConstant">0</span>
Total transferred:      <span class="synConstant">23414976</span> bytes
HTML transferred:       <span class="synConstant">13708768</span> bytes
Requests per second:    176.39 <span class="synStatement">[</span>#/sec<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       566.922 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       5.669 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean, across all concurrent requests<span class="synStatement">)</span>
Transfer rate:          80.67 <span class="synStatement">[</span>Kbytes/sec<span class="synStatement">]</span> received
</pre>
</div>
<div class="section">
<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a> Play Framework</h5>
<p>上で設定した<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a> Play FrameworkのDB接続をそのまま利用してPerfomanceを測定。<span class="deco" style="font-weight:bold;color:#FF0000;">rpsは432</span>となり、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a> Play Frameworkの勝利です。2.5倍ほどの実力差がでましたね。(※Play Frameworkの設定を良く理解していないのでもしかしたら有利な条件になっているかもしれないです。)</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ ab <span class="synSpecial">-n</span> <span class="synConstant">50000</span> <span class="synSpecial">-c</span> <span class="synConstant">100</span> <span class="synStatement">"</span><span class="synConstant">http://localhost:9000/</span><span class="synStatement">"</span>
Server Software:        
Server Hostname:        localhost
Server Port:            <span class="synConstant">9000</span>

Document Path:          /
Document Length:        <span class="synConstant">382</span> bytes

Concurrency Level:      <span class="synConstant">100</span>
Time taken <span class="synStatement">for </span>tests:   115.527 seconds
Complete requests:      <span class="synConstant">50000</span>
Failed requests:        <span class="synConstant">0</span>
Write errors:           <span class="synConstant">0</span>
Total transferred:      <span class="synConstant">23100000</span> bytes
HTML transferred:       <span class="synConstant">19100000</span> bytes
Requests per second:    432.80 <span class="synStatement">[</span>#/sec<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       231.055 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       2.311 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean, across all concurrent requests<span class="synStatement">)</span>
Transfer rate:          195.27 <span class="synStatement">[</span>Kbytes/sec<span class="synStatement">]</span> received
</pre>
</div>
</blockquote>

</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yutakikuchi.github.io/post/201403170820/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yutakikuchi.github.io/post/201403170820/">SolrのSpatial Searchを試してみた</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yutakikuchi.github.io/post/201404040828/">男なら潔くC言語書けよと言われた話。〜mod_db,mod_dbdの実装〜</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yutakikuchi.github.io/post/201404040828/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yutakikuchi.github.io/js/ui.js"></script>
<script src="https://yutakikuchi.github.io/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-20616165-3', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

