<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="canonical" href="http://yut.hatenablog.com/entry/20140404/1396567712" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.4" />

  <title>男なら潔くC言語書けよと言われた話。〜mod_db,mod_dbdの実装〜 &middot; Y&#39;s note</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yutakikuchi.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yutakikuchi.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yutakikuchi.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://yutakikuchi.github.io/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://yutakikuchi.github.io/css/my.css">
    
  
  
    
        <script src="https://yutakikuchi.github.io/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://yutakikuchi.github.io/">Y's note</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/yutakikuchi_" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/yuta.kikuchi.007" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/https://www.slideshare.net/yutakikuchi58/" target="_blank"><i class="fa fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/https://www.linkedin.com/in/%E4%BD%91%E5%A4%AA-%E8%8F%8A%E6%B1%A0-36291a44/" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yutakikuchi" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>男なら潔くC言語書けよと言われた話。〜mod_db,mod_dbdの実装〜</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2014 Apr 04, 08:28</time>
  </div>

  

  

  

</div>

  

<h2 id="c-男なら潔くc言語書けよと言われた話-mod-db-mod-dbdの実装">[C] : 男なら潔くC言語書けよと言われた話。〜mod_db,mod_dbdの実装〜</h2>

<p><div class="amazlet-box"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4900900648/yutakikuchi-22/"><img src="http://ecx.images-amazon.com/images/I/51PWS7A72YL._SL160_.jpg" class="hatena-asin-detail-image" alt="C実践プログラミング 第3版" title="C実践プログラミング 第3版"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4900900648/yutakikuchi-22/">C実践プログラミング 第3版</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> Steve Oualline,望月康司(監訳),谷口功</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%E9%A5%A4%A5%EA%A1%BC%A1%A6%A5%B8%A5%E3%A5%D1%A5%F3">オライリー・ジャパン</a></li><li><span class="hatena-asin-detail-label">発売日:</span> 1998/06/15</li><li><span class="hatena-asin-detail-label">メディア:</span> 大型本</li><li><span class="hatena-asin-detail-label">購入</span>: 7人 <span class="hatena-asin-detail-label">クリック</span>: 158回</li><li><a href="http://d.hatena.ne.jp/asin/4900900648/yutakikuchi-22" target="_blank">この商品を含むブログ (45件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<div class="section">
<h4>恩師に言われた言葉</h4>

<blockquote>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Geek">Geek</a>女優の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C3%D3%DF%B7%A4%A2%A4%E4%A4%AB">池澤あやか</a>さんに会いたいと思っている<a href='http://twitter.com/yutakikuc'>@yutakikuc</a>です。<br />
池澤さんは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>が出来て<a class="keyword" href="http://d.hatena.ne.jp/keyword/SFC">SFC</a>で女優さんなんて羨ましいですね〜。僕なんて<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>は得意じゃないし東京とは言えないような都心から離れた場所の地味な国立大だし、何よりお金も無い<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A5%F3%A5%D4%A1%BC">パンピー</a>だしね〜。</p><br />
<p>僕の学生時代にも<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>はあったんですけど<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はまだ出始めでそんなに流行っている雰囲気は無かったし、Webを書くには面倒くさい<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSP">JSP</a>/<a class="keyword" href="http://d.hatena.ne.jp/keyword/Servlet">Servlet</a>か<a class="keyword" href="http://d.hatena.ne.jp/keyword/Perl">Perl</a>かって感じでした。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apache">Apache</a>のModuleでWebを書ける事も学生ながら知っていたんですが、ポインタ、メモリの動的確保/解放の間違いが頻発して開発効率が落ちるから極力<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>で、どうしてもCを書かなければ行けない時は<a class="keyword" href="http://d.hatena.ne.jp/keyword/C%2B%2B">C++</a>で逃げてました。</p><br />
<p>でも学生時代に恩師に言われたんですよね、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/Perl">Perl</a>を書く奴はチャラいやつと。<span class="deco" style="font-weight:bold;color:#FF0000;">男なら潔く<a class="keyword" href="http://d.hatena.ne.jp/keyword/C%B8%C0%B8%EC">C言語</a>書けよ</span>と。 (因に恩師は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>と<a class="keyword" href="http://d.hatena.ne.jp/keyword/Javascript">Javascript</a>の違いも良く理解していなかったと思いますけどww) おそらく恩師が言いたいのは学生の時から<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B9%E2%B5%E9%B8%C0%B8%EC">高級言語</a>に頼る事無く、まずはプログラミングの仕組みを理解するために<a class="keyword" href="http://d.hatena.ne.jp/keyword/C%B8%C0%B8%EC">C言語</a>で苦労してエキスパートを目指せっていう意図だったと解釈しています。</p><br />
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/C%B8%C0%B8%EC">C言語</a>をやると他の言語と違って<span class="deco" style="color:#FF0000;font-weight:bold;">問題の発生率が高い。</span> 要は言語側であまり頑張ってくれないから自分で工夫する必要があります。特に他の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%DD%A1%BC%A5%CD%A5%F3%A5%C8">コンポーネント</a>に接続する時には接続数の制御/ポートの使い切り、ConnectionPoolの実装、使用メモリのオーバー、良く分からないSegmentation Fault等必ず経験します。こういった問題解決の経験値をつける事でエンジニアの実力が養われるのだと思います。</p><br />
<p>恩師の言葉を信じてCの勉強を重ねた結果、会社の開発チームに配属された時は凄く重宝されましたし、極力<a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>以外を書く案件を回して貰えました。だからCを勉強して来て良かったと思ってます。しかし今後<a class="keyword" href="http://d.hatena.ne.jp/keyword/C%B8%C0%B8%EC">C言語</a>はどうなるんでしょうか... 身の回りではゲーム系、広告配信エンジニア以外は触って無さそうです。その他の言語が強力で簡単WebアプリぐらいだとCで頑張って書くとか全く無いんですよね。学生の勉強の仕組み理解と違って会社は効率化や作業時間短縮を掲げてくるのでC推しも難しいですね。</p><br />
<p>前置きが長くなりましたが、それでも僕はCを触る事が多いのでこのエントリーでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/C%B8%C0%B8%EC">C言語</a>からのDB接続について書きたいと思います。</p>

</blockquote>

</div>
<div class="section">
<h4>DB接続</h4>

<blockquote>
    
<div class="section">
<h5>mysqlclientを使った自作ApacheModule mod_db.c</h5>
<p>mysqlclient,prepared stmtを使った<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apache">Apache</a> Moduleのmod_dbは以下になります。完全なる自作なのであまり自信が無いですが、並列テストをしてもSegmentation Faultは発生しませんでした。下のソースではbindしたいparameterとresultをmemsetで設定するところが分かりづらいのと、Pointerの設定を間違えてmemory <a class="keyword" href="http://d.hatena.ne.jp/keyword/error">error</a>を起こし易いので注意が必要です。このプログラムの駄目な点は<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>_real_connectで都度Connectionしているので、接続のOverHeadが大きいところです。実際にabでbenchmarkを取ってみるとCommand Connectが多く発生していますし、<a class="keyword" href="http://d.hatena.ne.jp/keyword/netstat">netstat</a>でも大量のTIME_WAITが出てます。都度接続の方式で頑張る場合は、TIME_WAITが残り続けると実行Port不足に陥って処理が進まなくなる可能性があるので、<span class="deco" style="font-weight:bold;color:#FF0000;">/etc/sysctlのnet.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ipv4">ipv4</a>.<a class="keyword" href="http://d.hatena.ne.jp/keyword/tcp">tcp</a>_tw_recycle=1に設定してリサイクルを速く回す設定を入れるか、net.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ipv4">ipv4</a>.ip_local_port_range = 1024 65535のように使用可能なPortを増やすか</span>のどちらかが有効になりそうです。ただしsysctlの設定をチューニングする場合は十分にテストすると良いと思います。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ sudo yum <span class="synStatement">install</span> mysql-devel <span class="synSpecial">-y</span>

$ sudo vim /etc/httpd/conf/httpd.conf
<span class="synStatement"><</span>IfModule mod_db.c<span class="synStatement">></span>
DBHost localhost
DBPort <span class="synConstant">3306</span>
DBUser root
DBPass root
DBName helloworld
DBTableName hello
<span class="synStatement"><</span>/IfModule<span class="synStatement">></span>

$ sudo apxs <span class="synSpecial">-i</span> <span class="synSpecial">-a</span> <span class="synSpecial">-c</span> <span class="synSpecial">-I</span> /usr/include/mysql <span class="synSpecial">-L</span> /usr/lib64/mysql <span class="synSpecial">-lmysqlclient</span> mod_db.c
$ sudo /etc/init.d/httpd <span class="synStatement">restart</span> 

$ ab <span class="synSpecial">-n</span> <span class="synConstant">10000</span> <span class="synSpecial">-c</span> <span class="synConstant">30</span> <span class="synStatement">"</span><span class="synConstant">http://localhost/</span><span class="synStatement">"</span> 
Server Software:        Apache/2.2.15
Server Hostname:        localhost
Server Port:            <span class="synConstant">80</span>

Document Path:          /
Document Length:        <span class="synConstant">68</span> bytes

Concurrency Level:      <span class="synConstant">30</span>
Time taken <span class="synStatement">for </span>tests:   25.316 seconds
Complete requests:      <span class="synConstant">10000</span>
Failed requests:        <span class="synConstant">0</span>
Write errors:           <span class="synConstant">0</span>
Total transferred:      <span class="synConstant">2352350</span> bytes
HTML transferred:       <span class="synConstant">680680</span> bytes
Requests per second:    395.01 <span class="synStatement">[</span>#/sec<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       75.948 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       2.532 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean, across all concurrent requests<span class="synStatement">)</span>
Transfer rate:          90.74 <span class="synStatement">[</span>Kbytes/sec<span class="synStatement">]</span> received

$ mysql<span class="synStatement">></span> SHOW PROCESSLIST<span class="synStatement">;</span>
+------+----------------------+-----------------+------+---------+------+-------+------------------+
<span class="synStatement">|</span> Id   <span class="synStatement">|</span> User                 <span class="synStatement">|</span> Host            <span class="synStatement">|</span> db   <span class="synStatement">|</span> Command <span class="synStatement">|</span> Time <span class="synStatement">|</span> State <span class="synStatement">|</span> Info             <span class="synStatement">|</span>
+------+----------------------+-----------------+------+---------+------+-------+------------------+
<span class="synStatement">|</span>  <span class="synConstant">443</span> <span class="synStatement">|</span> root                 <span class="synStatement">|</span> localhost       <span class="synStatement">|</span> NULL <span class="synStatement">|</span> Query   <span class="synStatement">|</span>    <span class="synConstant">0</span> <span class="synStatement">|</span> NULL  <span class="synStatement">|</span> SHOW PROCESSLIST <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">9824</span> <span class="synStatement">|</span> unauthenticated user <span class="synStatement">|</span> connecting host <span class="synStatement">|</span> NULL <span class="synStatement">|</span> Connect <span class="synStatement">|</span> NULL <span class="synStatement">|</span> login <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">9825</span> <span class="synStatement">|</span> unauthenticated user <span class="synStatement">|</span> connecting host <span class="synStatement">|</span> NULL <span class="synStatement">|</span> Connect <span class="synStatement">|</span> NULL <span class="synStatement">|</span> login <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">9826</span> <span class="synStatement">|</span> unauthenticated user <span class="synStatement">|</span> connecting host <span class="synStatement">|</span> NULL <span class="synStatement">|</span> Connect <span class="synStatement">|</span> NULL <span class="synStatement">|</span> login <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">9827</span> <span class="synStatement">|</span> unauthenticated user <span class="synStatement">|</span> connecting host <span class="synStatement">|</span> NULL <span class="synStatement">|</span> Connect <span class="synStatement">|</span> NULL <span class="synStatement">|</span> login <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
+------+----------------------+-----------------+------+---------+------+-------+------------------+

$ sudo netstat <span class="synSpecial">-antp</span>
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">50593</span>                   TIME_WAIT   -                   
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">52086</span>                   TIME_WAIT   -                   
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">52864</span>                   TIME_WAIT   -                   
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">51305</span>                   TIME_WAIT   -                   
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">52557</span>                   TIME_WAIT   -                   
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">53047</span>                   TIME_WAIT   -                   
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">49646</span>                   TIME_WAIT   -                   
tcp        <span class="synConstant">0</span>      <span class="synConstant">1</span> ::<span class="synConstant">1</span>:<span class="synConstant">80</span>                      ::<span class="synConstant">1</span>:<span class="synConstant">53489</span>                   FIN_WAIT1   -          

<span class="synComment">#設定を変える場合は十分にテストが必要</span>
$ sudo vim /etc/sysctl.conf
net.ipv4.tcp_tw_recycle <span class="synStatement">=</span> <span class="synConstant">1</span>
net.ipv4.ip_local_port_range <span class="synStatement">=</span> <span class="synConstant">1024</span> <span class="synConstant">65535</span>
$ sudo sysctl <span class="synStatement">-p</span> 
</pre><pre class="hljs c" data-lang="c" data-unlink><span class="synPreProc">#include </span><span class="synConstant">"httpd.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"http_config.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"http_protocol.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"apr_hash.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"apr_tables.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"apr_strings.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"ap_config.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"util_script.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"http_log.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"mysql/mysql.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"stdio.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"stdlib.h"</span>

module AP_MODULE_DECLARE_DATA db_module;

<span class="synType">typedef</span> <span class="synType">struct</span> {
<span class="synType">int</span> port;
MYSQL *conn;
MYSQL_STMT *stmt;
<span class="synType">char</span> *host;
<span class="synType">char</span> *user;
<span class="synType">char</span> *pass;
<span class="synType">char</span> *name;
<span class="synType">char</span> *table_name;
} db_env;

<span class="synComment">/* The db handler */</span>
<span class="synType">static</span> <span class="synType">int</span> db_handler(request_rec *r) {
<span class="synComment">// connect</span>
db_env *db = ap_get_module_config(r->per_dir_config, &db_module);
db->conn = mysql_init(<span class="synConstant">NULL</span>);
<span class="synStatement">if</span> (!mysql_real_connect(db->conn, db->host, db->user, db->pass, db->name, db->port, <span class="synConstant">NULL</span>, <span class="synConstant">0</span>)) {
    mysql_close(db->conn);
    <span class="synStatement">return</span> HTTP_INTERNAL_SERVER_ERROR;
}

<span class="synType">char</span> *query = (<span class="synType">char</span> *)apr_psprintf(r->pool,<span class="synConstant">"SELECT id,title,created_at FROM </span><span class="synSpecial">%s</span><span class="synConstant">.</span><span class="synSpecial">%s</span><span class="synConstant"> WHERE id = ?"</span>, db->name, db->table_name);
db->stmt = mysql_stmt_init(db->conn);
<span class="synStatement">if</span> (mysql_stmt_prepare(db->stmt, query, strlen(query)) != <span class="synConstant">0</span>) {
    <span class="synStatement">goto</span> STMTError;
}

<span class="synComment">// bind</span>
MYSQL_BIND bind[<span class="synConstant">1</span>];
<span class="synType">int</span> id = <span class="synConstant">1</span>;
memset(bind, <span class="synConstant">0</span>, <span class="synStatement">sizeof</span>(id));
bind[<span class="synConstant">0</span>].buffer = &id;
bind[<span class="synConstant">0</span>].buffer_type = MYSQL_TYPE_LONG;
bind[<span class="synConstant">0</span>].buffer_length = <span class="synStatement">sizeof</span>(id);
bind[<span class="synConstant">0</span>].is_null = <span class="synConstant">0</span>;

<span class="synStatement">if</span> (mysql_stmt_bind_param(db->stmt,bind) != <span class="synConstant">0</span> || mysql_stmt_execute(db->stmt) != <span class="synConstant">0</span>) {
    <span class="synStatement">goto</span> STMTError;
}

<span class="synComment">// bind_result</span>
MYSQL_BIND result[<span class="synConstant">3</span>];
memset(result, <span class="synConstant">0</span>, <span class="synStatement">sizeof</span>(result));
<span class="synType">int</span> rid;
result[<span class="synConstant">0</span>].buffer = &rid;
result[<span class="synConstant">0</span>].buffer_type = MYSQL_TYPE_LONG;
result[<span class="synConstant">0</span>].buffer_length = <span class="synStatement">sizeof</span>(rid);
result[<span class="synConstant">0</span>].is_null = <span class="synConstant">0</span>;
<span class="synType">char</span> title[<span class="synConstant">100</span>];
result[<span class="synConstant">1</span>].buffer = &title;
result[<span class="synConstant">1</span>].buffer_type = MYSQL_TYPE_STRING;
result[<span class="synConstant">1</span>].buffer_length = <span class="synStatement">sizeof</span>(title);
result[<span class="synConstant">1</span>].is_null = <span class="synConstant">0</span>; 
MYSQL_TIME ts;
result[<span class="synConstant">2</span>].buffer = &ts;
result[<span class="synConstant">2</span>].buffer_type = MYSQL_TYPE_DATETIME;
result[<span class="synConstant">2</span>].buffer_length = <span class="synStatement">sizeof</span>(ts);
result[<span class="synConstant">2</span>].is_null = <span class="synConstant">0</span>;

<span class="synComment">// bind_result</span>
<span class="synStatement">if</span> (mysql_stmt_bind_result(db->stmt,result) != <span class="synConstant">0</span> || mysql_stmt_store_result(db->stmt) != <span class="synConstant">0</span>) {
    <span class="synStatement">goto</span> STMTError;
}
<span class="synComment">// stmt_fetch</span>
<span class="synStatement">while</span> (!mysql_stmt_fetch(db->stmt)) {
    <span class="synType">char</span> *time_str = (<span class="synType">char</span> *)apr_psprintf(r->pool, <span class="synConstant">"</span><span class="synSpecial">%04d</span><span class="synConstant">-</span><span class="synSpecial">%02d</span><span class="synConstant">-</span><span class="synSpecial">%02d</span><span class="synConstant"> </span><span class="synSpecial">%02d</span><span class="synConstant">:</span><span class="synSpecial">%02d</span><span class="synConstant">:</span><span class="synSpecial">%02d</span><span class="synConstant">"</span>, ts.year, ts.month, ts.day, ts.hour, ts.minute, ts.second);
    ap_rprintf(r, <span class="synConstant">"id: </span><span class="synSpecial">%d</span><span class="synConstant">, title: </span><span class="synSpecial">%s</span><span class="synConstant">, created_at: </span><span class="synSpecial">%s\n</span><span class="synConstant">"</span>, rid, title, time_str);
}
<span class="synComment">// close</span>
mysql_stmt_close(db->stmt);
mysql_close(db->conn);
<span class="synStatement">return</span> OK;

<span class="synStatement">STMTError</span>:
mysql_stmt_close(db->stmt);
mysql_close(db->conn);
<span class="synStatement">return</span> HTTP_INTERNAL_SERVER_ERROR;
}

<span class="synComment">/* make db dir */</span>
<span class="synType">static</span> <span class="synType">void</span> *make_db_dir(apr_pool_t *p, <span class="synType">char</span> *d){
db_env *db;
db = (db_env *) apr_pcalloc(p, <span class="synStatement">sizeof</span>(db_env));
<span class="synStatement">return</span> db;
}

<span class="synComment">/*</span>
<span class="synComment"> * Set the value for the 'DBHost' attribute.</span>
<span class="synComment"> */</span>
<span class="synType">static</span> <span class="synType">const</span> <span class="synType">char</span> *set_db_host(cmd_parms *cmd, <span class="synType">void</span> *mconfig, <span class="synType">const</span> <span class="synType">char</span> *name){
db_env *db;
db = (db_env *) mconfig;
db->host = ap_getword_conf(cmd->pool, &name);
<span class="synStatement">return</span> <span class="synConstant">NULL</span>;
}

<span class="synComment">/*</span>
<span class="synComment"> * Set the value for the 'DBUser' attribute.</span>
<span class="synComment"> */</span>
<span class="synType">static</span> <span class="synType">const</span> <span class="synType">char</span> *set_db_user(cmd_parms *cmd, <span class="synType">void</span> *mconfig, <span class="synType">const</span> <span class="synType">char</span> *user){
db_env *db;
db = (db_env *) mconfig;
db->user = ap_getword_conf(cmd->pool, &user);
<span class="synStatement">return</span> <span class="synConstant">NULL</span>;
}

<span class="synComment">/*</span>
<span class="synComment"> * Set the value for the 'DBPass' attribute.</span>
<span class="synComment"> */</span>
<span class="synType">static</span> <span class="synType">const</span> <span class="synType">char</span> *set_db_pass(cmd_parms *cmd, <span class="synType">void</span> *mconfig, <span class="synType">const</span> <span class="synType">char</span> *pass){
db_env *db;
db = (db_env *) mconfig;
db->pass = ap_getword_conf(cmd->pool, &pass);
<span class="synStatement">return</span> <span class="synConstant">NULL</span>;
}

<span class="synComment">/*</span>
<span class="synComment"> * Set the value for the 'DBPort' attribute.</span>
<span class="synComment"> */</span>
<span class="synType">static</span> <span class="synType">const</span> <span class="synType">char</span> *set_db_port(cmd_parms *cmd, <span class="synType">void</span> *mconfig, <span class="synType">const</span> <span class="synType">char</span> *port){
db_env *db;
db = (db_env *) mconfig;
db->port = *(<span class="synType">int</span> *)ap_getword_conf(cmd->pool, &port);
<span class="synStatement">return</span> <span class="synConstant">NULL</span>;
}

<span class="synComment">/*</span>
<span class="synComment"> * Set the value for the 'DBName' attribute.</span>
<span class="synComment"> */</span>
<span class="synType">static</span> <span class="synType">const</span> <span class="synType">char</span> *set_db_name(cmd_parms *cmd, <span class="synType">void</span> *mconfig, <span class="synType">const</span> <span class="synType">char</span> *name){
db_env *db;
db = (db_env *) mconfig;
db->name = ap_getword_conf(cmd->pool, &name);
<span class="synStatement">return</span> <span class="synConstant">NULL</span>;
}

<span class="synComment">/*</span>
<span class="synComment"> * Set the value for the 'DBTable' attribute.</span>
<span class="synComment"> */</span>
<span class="synType">static</span> <span class="synType">const</span> <span class="synType">char</span> *set_db_table(cmd_parms *cmd, <span class="synType">void</span> *mconfig, <span class="synType">const</span> <span class="synType">char</span> *table){
db_env *db;
db = (db_env *) mconfig;
db->table_name = ap_getword_conf(cmd->pool, &table);
<span class="synStatement">return</span> <span class="synConstant">NULL</span>;
}

<span class="synType">static</span> <span class="synType">const</span> command_rec db_conf_cmds[] = {
AP_INIT_TAKE1(<span class="synConstant">"DBHost"</span>, set_db_host, <span class="synConstant">NULL</span>, OR_FILEINFO, <span class="synConstant">"db hostname"</span>),
AP_INIT_TAKE1(<span class="synConstant">"DBPort"</span>, set_db_port, <span class="synConstant">NULL</span>, OR_FILEINFO, <span class="synConstant">"db port"</span>),
AP_INIT_TAKE1(<span class="synConstant">"DBUser"</span>, set_db_user, <span class="synConstant">NULL</span>, OR_FILEINFO, <span class="synConstant">"db username"</span>),
AP_INIT_TAKE1(<span class="synConstant">"DBPass"</span>, set_db_pass, <span class="synConstant">NULL</span>, OR_FILEINFO, <span class="synConstant">"db password"</span>),
AP_INIT_TAKE1(<span class="synConstant">"DBName"</span>, set_db_name, <span class="synConstant">NULL</span>, OR_FILEINFO, <span class="synConstant">"db name"</span>),
AP_INIT_TAKE1(<span class="synConstant">"DBTableName"</span>, set_db_table, <span class="synConstant">NULL</span>, OR_FILEINFO, <span class="synConstant">"db tablename"</span>),
{<span class="synConstant">NULL</span>}
};

<span class="synType">static</span> <span class="synType">void</span> db_register_hooks(apr_pool_t *p){
ap_hook_handler(db_handler, <span class="synConstant">NULL</span>, <span class="synConstant">NULL</span>, APR_HOOK_MIDDLE);
}

<span class="synComment">/* Dispatch list for API hooks */</span>
module AP_MODULE_DECLARE_DATA db_module = {
STANDARD20_MODULE_STUFF, 
make_db_dir,                  <span class="synComment">/* create per-dir    config structures */</span>
<span class="synConstant">NULL</span>,                  <span class="synComment">/* merge  per-dir    config structures */</span>
<span class="synConstant">NULL</span>,                  <span class="synComment">/* create per-server config structures */</span>
<span class="synConstant">NULL</span>,                  <span class="synComment">/* merge  per-server config structures */</span>
db_conf_cmds,          <span class="synComment">/* table of config file commands       */</span>
db_register_hooks      <span class="synComment">/* register hooks                  */</span>
};
</pre>
</div>
<div class="section">
<h5>mod_dbdを使った自作ApacheModule mod_dbdsample.c</h5>
<p>mod_dbの問題を回避する為にmod_dbdを利用します。利用する際はapr-util-<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>というパッケージが必要なので<a class="keyword" href="http://d.hatena.ne.jp/keyword/yum">yum</a>で取得します。mod_dbdはConnectionPoolを作成し接続を永続化しますし、PreparedStatementの機能も持ち合わせています。mod_dbdはぐぐってもさほど有益な情報が得られないので、注意してください。凄く分かりづらい箇所としてはPrepareする際の<span class="deco" style="color:#FF0000;font-weight:bold;">Bind Parameterの指定が"?"ではなく"%s"となる事です。</span>更にはStatementの結果となるresと取得行のrowを初期化としてNULLしておかないと子プロセスでSegmentation Faultを引き起こします。上のmod_dbに比べてPerformanceが若干改善していますが、期待していた以上の働きをしていないため何とも言えない状況でした。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mysql">Mysql</a>のCommandはSleepになって待機状態なのが分かります。また<a class="keyword" href="http://d.hatena.ne.jp/keyword/netstat">netstat</a>でも少ないPortがESTABLISHEDとなっています。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ sudo yum <span class="synStatement">install</span> apr-util-mysql <span class="synSpecial">-y</span>

$ sudo vim /etc/httpd/conf/httpd.conf
<span class="synComment">#有効化</span>
LoadModule dbd_module modules/mod_dbd.so
<span class="synComment">#追記</span>
<span class="synStatement"><</span>IfModule mod_dbdsample.c<span class="synStatement">></span>
DBDriver    mysql
DBDParams   <span class="synStatement">"</span><span class="synConstant">host=localhost,user=root,pass=root,dbname=helloworld</span><span class="synStatement">"</span>
DBDPersist  ON
DBDKeep     <span class="synConstant">5</span>
DBDMax      <span class="synConstant">10</span>
DBDMin      <span class="synConstant">3</span>
DBDExptime  <span class="synConstant">300</span>
<span class="synStatement"><</span>/IfModule<span class="synStatement">></span>

$ sudo apxs <span class="synSpecial">-i</span> <span class="synSpecial">-a</span> <span class="synSpecial">-c</span> mod_dbdsample.c
$ sudo /etc/init.d/httpd <span class="synStatement">restart</span> 

$ ab <span class="synSpecial">-n</span> <span class="synConstant">10000</span> <span class="synSpecial">-c</span> <span class="synConstant">30</span> <span class="synStatement">"</span><span class="synConstant">http://localhost/</span><span class="synStatement">"</span>
Server Software:        Apache/2.2.15
Server Hostname:        localhost
Server Port:            <span class="synConstant">80</span>

Document Path:          /
Document Length:        <span class="synConstant">68</span> bytes

Concurrency Level:      <span class="synConstant">30</span>
Time taken <span class="synStatement">for </span>tests:   19.113 seconds
Complete requests:      <span class="synConstant">10000</span>
Failed requests:        <span class="synConstant">0</span>
Write errors:           <span class="synConstant">0</span>
Total transferred:      <span class="synConstant">2352820</span> bytes
HTML transferred:       <span class="synConstant">680816</span> bytes
Requests per second:    523.20 <span class="synStatement">[</span>#/sec<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       57.340 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean<span class="synStatement">)</span>
Time per request:       1.911 <span class="synStatement">[</span>ms<span class="synStatement">]</span> <span class="synStatement">(</span>mean, across all concurrent requests<span class="synStatement">)</span>
Transfer rate:          120.21 <span class="synStatement">[</span>Kbytes/sec<span class="synStatement">]</span> received

mysql<span class="synStatement">></span> SHOW PROCESSLIST<span class="synStatement">;</span>
+-------+------+-----------+------------+---------+------+-------+------------------+
<span class="synStatement">|</span> Id    <span class="synStatement">|</span> User <span class="synStatement">|</span> Host      <span class="synStatement">|</span> db         <span class="synStatement">|</span> Command <span class="synStatement">|</span> Time <span class="synStatement">|</span> State <span class="synStatement">|</span> Info             <span class="synStatement">|</span>
+-------+------+-----------+------------+---------+------+-------+------------------+
<span class="synStatement">|</span>   <span class="synConstant">443</span> <span class="synStatement">|</span> root <span class="synStatement">|</span> localhost <span class="synStatement">|</span> NULL       <span class="synStatement">|</span> Query   <span class="synStatement">|</span>    <span class="synConstant">0</span> <span class="synStatement">|</span> NULL  <span class="synStatement">|</span> SHOW PROCESSLIST <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">24215</span> <span class="synStatement">|</span> root <span class="synStatement">|</span> localhost <span class="synStatement">|</span> helloworld <span class="synStatement">|</span> Sleep   <span class="synStatement">|</span>  <span class="synConstant">294</span> <span class="synStatement">|</span>       <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">24216</span> <span class="synStatement">|</span> root <span class="synStatement">|</span> localhost <span class="synStatement">|</span> helloworld <span class="synStatement">|</span> Sleep   <span class="synStatement">|</span>  <span class="synConstant">294</span> <span class="synStatement">|</span>       <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">24217</span> <span class="synStatement">|</span> root <span class="synStatement">|</span> localhost <span class="synStatement">|</span> helloworld <span class="synStatement">|</span> Sleep   <span class="synStatement">|</span>  <span class="synConstant">271</span> <span class="synStatement">|</span>       <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">24218</span> <span class="synStatement">|</span> root <span class="synStatement">|</span> localhost <span class="synStatement">|</span> helloworld <span class="synStatement">|</span> Sleep   <span class="synStatement">|</span>  <span class="synConstant">294</span> <span class="synStatement">|</span>       <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">24220</span> <span class="synStatement">|</span> root <span class="synStatement">|</span> localhost <span class="synStatement">|</span> helloworld <span class="synStatement">|</span> Sleep   <span class="synStatement">|</span>  <span class="synConstant">294</span> <span class="synStatement">|</span>       <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>
<span class="synStatement">|</span> <span class="synConstant">24221</span> <span class="synStatement">|</span> root <span class="synStatement">|</span> localhost <span class="synStatement">|</span> helloworld <span class="synStatement">|</span> Sleep   <span class="synStatement">|</span>  <span class="synConstant">271</span> <span class="synStatement">|</span>       <span class="synStatement">|</span> NULL             <span class="synStatement">|</span>

$ sudo netstat <span class="synSpecial">-antp</span>
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> 192.168.56.10:<span class="synConstant">22</span>            192.168.56.1:<span class="synConstant">52664</span>          ESTABLISHED <span class="synConstant">2161</span>/sshd
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> 192.168.56.10:<span class="synConstant">22</span>            192.168.56.1:<span class="synConstant">52626</span>          ESTABLISHED <span class="synConstant">2100</span>/sshd
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> 192.168.56.10:<span class="synConstant">22</span>            192.168.56.1:<span class="synConstant">52333</span>          ESTABLISHED <span class="synConstant">1511</span>/sshd
tcp        <span class="synConstant">0</span>      <span class="synConstant">0</span> 192.168.56.10:<span class="synConstant">22</span>            192.168.56.1:<span class="synConstant">52332</span>          ESTABLISHED <span class="synConstant">1494</span>/sshd
</pre><pre class="hljs c" data-lang="c" data-unlink><span class="synPreProc">#include </span><span class="synConstant">"httpd.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"http_config.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"http_protocol.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"http_log.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"ap_config.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"apr_dbd.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"mod_dbd.h"</span>
<span class="synPreProc">#include </span><span class="synConstant">"apr_strings.h"</span>

<span class="synType">typedef</span> <span class="synType">struct</span>{
  apr_dbd_results_t *res;
  apr_dbd_row_t *row;
  apr_dbd_prepared_t *stmt;
  ap_dbd_t *dbd;
} struct_dbd;

<span class="synType">static</span> <span class="synType">int</span> dbdsample_handler(request_rec *r) {
  struct_dbd *db = (struct_dbd *)apr_palloc(r->pool, <span class="synStatement">sizeof</span>(struct_dbd));
  db->res  = <span class="synConstant">NULL</span>;
  db->row  = <span class="synConstant">NULL</span>;
  db->stmt = <span class="synConstant">NULL</span>;
  <span class="synStatement">if</span>((db->dbd = ap_dbd_acquire(r)) == <span class="synConstant">NULL</span>) {
<span class="synStatement">return</span> HTTP_INTERNAL_SERVER_ERROR;
  }
  <span class="synType">const</span> <span class="synType">char</span>* query = <span class="synConstant">"SELECT id,title,created_at FROM helloworld.hello WHERE id = </span><span class="synSpecial">%s</span><span class="synConstant">"</span>;
  <span class="synStatement">if</span>(apr_dbd_prepare(db->dbd->driver, r->pool, db->dbd->handle, query, <span class="synConstant">NULL</span>, &db->stmt) != <span class="synConstant">0</span>) {
ap_log_rerror(APLOG_MARK, APLOG_ERR, <span class="synConstant">0</span>, r, <span class="synConstant">"Error </span><span class="synSpecial">%s</span><span class="synConstant">."</span>, apr_dbd_error(db->dbd->driver, db->dbd->handle, errno));
<span class="synStatement">return</span> HTTP_INTERNAL_SERVER_ERROR;
  }
  <span class="synType">const</span> <span class="synType">char</span> **params = (<span class="synType">const</span> <span class="synType">char</span>**)apr_palloc(r->pool,(<span class="synConstant">1</span>*<span class="synStatement">sizeof</span>(<span class="synType">char</span> *)));
  *params = <span class="synConstant">"1"</span>;
  <span class="synStatement">if</span>(apr_dbd_pselect(db->dbd->driver, r->pool, db->dbd->handle, &db->res, db->stmt, <span class="synConstant">0</span>, <span class="synConstant">1</span>, params) != <span class="synConstant">0</span>) {
ap_log_rerror(APLOG_MARK, APLOG_ERR, <span class="synConstant">0</span>, r, <span class="synConstant">"Error </span><span class="synSpecial">%s</span><span class="synConstant">."</span>, apr_dbd_error(db->dbd->driver, db->dbd->handle, errno));
<span class="synStatement">return</span> HTTP_INTERNAL_SERVER_ERROR;
  }
  <span class="synStatement">while</span>(!apr_dbd_get_row(db->dbd->driver, r->pool, db->res, &db->row, -<span class="synConstant">1</span>)) {
<span class="synType">const</span> <span class="synType">char</span>* id = apr_dbd_get_entry(db->dbd->driver, db->row, <span class="synConstant">0</span>);
<span class="synType">const</span> <span class="synType">char</span>* title = apr_dbd_get_entry(db->dbd->driver, db->row, <span class="synConstant">1</span>);
<span class="synType">const</span> <span class="synType">char</span>* created_at = apr_dbd_get_entry(db->dbd->driver, db->row, <span class="synConstant">2</span>);
ap_rprintf(r, <span class="synConstant">"id: </span><span class="synSpecial">%s</span><span class="synConstant">, title: </span><span class="synSpecial">%s</span><span class="synConstant">, created_at: </span><span class="synSpecial">%s\n</span><span class="synConstant">"</span>, id, title, created_at);
  }
  <span class="synStatement">return</span> OK;
}

<span class="synType">static</span> <span class="synType">void</span> dbdsample_register_hooks(apr_pool_t *p) {
  ap_hook_handler(dbdsample_handler, <span class="synConstant">NULL</span>, <span class="synConstant">NULL</span>, APR_HOOK_MIDDLE);
}

<span class="synComment">/* Dispatch list for API hooks */</span>
module AP_MODULE_DECLARE_DATA dbdsample_module = {
  STANDARD20_MODULE_STUFF,
  <span class="synConstant">NULL</span>,                  <span class="synComment">/* create per-dir    config structures */</span>
  <span class="synConstant">NULL</span>,                  <span class="synComment">/* merge  per-dir    config structures */</span>
  <span class="synConstant">NULL</span>,                  <span class="synComment">/* create per-server config structures */</span>
  <span class="synConstant">NULL</span>,                  <span class="synComment">/* merge  per-server config structures */</span>
  <span class="synConstant">NULL</span>,                  <span class="synComment">/* table of config file commands       */</span>
  dbdsample_register_hooks  <span class="synComment">/* register hooks                      */</span>
};
</pre>
</div>
</blockquote>

</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yutakikuchi.github.io/post/201404010836/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yutakikuchi.github.io/post/201404010836/">速いよ Java Play Framework</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yutakikuchi.github.io/post/201408011325/">常駐型受託開発の経験から</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yutakikuchi.github.io/post/201408011325/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yutakikuchi.github.io/js/ui.js"></script>
<script src="https://yutakikuchi.github.io/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-20616165-3', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

