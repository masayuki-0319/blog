<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="canonical" href="http://yut.hatenablog.com/entry/20120910/1347233734" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.4" />

  <title>そろそろ本気で機械学習の評価方法について学習するよ &middot; Y&#39;s note</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://yutakikuchi.github.io/blog/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/my.css">
    
  
  
    
        <script src="https://yutakikuchi.github.io/blog/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://yutakikuchi.github.io/blog/">Y's note</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/yutakikuchi_" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/yuta.kikuchi.007" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/https://www.slideshare.net/yutakikuchi58/" target="_blank"><i class="fa fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/https://www.linkedin.com/in/%E4%BD%91%E5%A4%AA-%E8%8F%8A%E6%B1%A0-36291a44/" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yutakikuchi" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>そろそろ本気で機械学習の評価方法について学習するよ</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2012 Sep 10, 08:35</time>
  </div>

  

  

  

</div>

  

<h2 id="機械学習-そろそろ本気で機械学習の評価方法について学習するよ">[機械学習] : そろそろ本気で機械学習の評価方法について学習するよ</h2>

<p><div class="amazlet-box"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/1449303714/yutakikuchi-22/"><img src="http://ecx.images-amazon.com/images/I/51cwV1i8S6L._SL160_.jpg" class="hatena-asin-detail-image" alt="Machine Learning for Hackers" title="Machine Learning for Hackers"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/1449303714/yutakikuchi-22/">Machine Learning for Hackers</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> Drew Conway,John Myles White</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> Oreilly & Associates Inc</li><li><span class="hatena-asin-detail-label">発売日:</span> 2012/02/28</li><li><span class="hatena-asin-detail-label">メディア:</span> ペーパーバック</li><li> <span class="hatena-asin-detail-label">クリック</span>: 63回</li><li><a href="http://d.hatena.ne.jp/asin/1449303714/yutakikuchi-22" target="_blank">この商品を含むブログを見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<div class="section">
<h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/%B5%A1%B3%A3%B3%D8%BD%AC">機械学習</a>の評価方法について学習</h4>

<blockquote>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%B5%A1%B3%A3%B3%D8%BD%AC">機械学習</a>初心者ですが最近業務で本格的に触り始めています。少し前までSmartPhoneのWebAppliを作ることを専門職としていたので<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B5%A1%B3%A3%B3%D8%BD%AC">機械学習</a>の領域は未知な事が非常に多く、用語の意味ですら十分に理解できていません。今日は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B5%A1%B3%A3%B3%D8%BD%AC">機械学習</a>の評価方法を中心に学習(勉強)した内容を記録して行きます。例えばPrecision/Accuracy/Recallの言葉の違いやROC曲線,AUC評価などの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B5%BB%CB%A1">技法</a>といったものが話の中心になります。初心者視点で書いていますので専門性がありません。間違い等ありましたらご指摘ください。また以前にもはじめての<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B5%A1%B3%A3%B3%D8%BD%AC">機械学習</a>という本のサマリーを書いたのでそちらも参照していただけると嬉しいです。<br />
<a href="http://d.hatena.ne.jp/yutakikuchi/20120723/1343000686">初めての機械学習理論 - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20120723/1343000686"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20120723/1343000686" alt="はてなブックマーク - 初めての機械学習理論 - Yuta.Kikuchiの日記" border="0" /></a></p>

</blockquote>

</div>
<div class="section">
<h4>用語定義</h4>

<blockquote>
    <p>初めに慣れない用語が多いので、その意味を定義します。</p>

<table>
<tr>
<th> 用語 </th>
<th> 意味 </th>
</tr>
<tr>
<td> K-Fold Cross-Validation </td>
<td> 標本をK子に分割して<a class="keyword" href="http://d.hatena.ne.jp/keyword/K-1">K-1</a>個を学習データ、1個を評価データとして扱い、K回検定を行い推定の平均を得る </td>
</tr>
<tr>
<td> Leave-One-Out Cross-Validation </td>
<td> 標本から1つの事例を取り出して評価データとし、残りを学習データとする。全事例が1回は評価となるように検定を繰り返す。</td>
</tr>
<tr>
<td> Accuracy </td>
<td> <span class="deco" style="color:#FF0000;">正解率</span>のこと。予測結果全体と、答えがどれぐらい一致しているかを判断する指標。計算式は下記を参照。 </td>
</tr>
<tr>
<td> Precision </td>
<td> <span class="deco" style="color:#FF0000;">適合率</span>のこと。予測を正と判断した中で、答えも正のもの。計算式は下記を参照。 </td>
</tr>
<tr>
<td> Recall </td>
<td><span class="deco" style="color:#FF0000;"> 再現率</span>のこと。答えが正の中で、予測が正とされたもの。計算式は下記を参照。 </td>
<td> </td>
</tr>
<tr>
<td> F-measure </td>
<td> <a class="keyword" href="http://d.hatena.ne.jp/keyword/F%C3%CD">F値</a>のこと。予測精度の評価指標。PresicionとRecallの調和平均。計算式は下記を参照。 </td>
</tr>
<tr>
<td> ROC曲線 </td>
<td> Receiver Operating Characteristicのこと。縦軸にTrue Positive、横軸にFalse Positiveの割合を2次元プロットして点を線で連結した曲線 </td>
</tr>
<tr>
<td> AUC </td>
<td> Area Under the Curveのこと。ROC曲線の曲線よりしたの面積。分類器の精度評価に使う。</td>
</tr>
<tr>
<td> マイクロ平均 </td>
<td> Nセットのテストをする場合、テストを合計してから評価値を計算。計算式は下記を参照。 </td>
</tr>
<tr>
<td> マクロ平均 </td>
<td> Nセットのテストをする場合、各セットを計算してからそれらを平均する計算。計算式は下記を参照。 </td>
</tr>
<tr>
<td> True Positive </td>
<td> 正しくPositiveと判断。予測が正解しているので<span class="deco" style="color:#FF0000;">OK</span>。 </td>
</tr>
<tr>
<td> False Positive </td>
<td> 誤ってPositiveと判断。予測が不正解なので<span class="deco" style="color:#FF0000;">NG</span>。 </td>
</tr>
<tr>
<td> False Negative </td>
<td>誤ってNegativeと判断。予測が不正解なので<span class="deco" style="color:#FF0000;">NG</span>。 </td>
</tr>
<tr>
<td> True Negative </td>
<td> 正しくNegativeと判断。予測が正解しているので<span class="deco" style="color:#FF0000;">OK</span>。 </td>
</tr>
</table>
<table>
<tr>
<th> - </th>
<th> 事実が1 </th>
<th> 事実が-1 </th>
</tr>
<tr>
<th> 予測が1 </th>
<td> True Positive(TP) </td>
<td> False Positive(FP) </td>
</tr>
<tr>
<th> 予測が-1 </th>
<td> False Negative(FN) </td>
<td> True Negative(TN) </td>
</tr>
</table><p><img src="http://chart.apis.google.com/chart?cht=tx&chl=Accuracy%20%3D%20%5Cfrac%7BTP%2BTN%7D%7BTP%2BFP%2BFN%2BTN%7D" alt="Accuracy = \frac{TP+TN}{TP+FP+FN+TN}"/><br />
<img src="http://chart.apis.google.com/chart?cht=tx&chl=Precision%20%3D%20%5Cfrac%7BTP%7D%7BTP%2BFP%7D" alt="Precision = \frac{TP}{TP+FP}"/><br />
<img src="http://chart.apis.google.com/chart?cht=tx&chl=Recall%20%3D%20%5Cfrac%7BTP%7D%7BTP%2BFN%7D" alt="Recall = \frac{TP}{TP+FN}"/><br />
<img src="http://chart.apis.google.com/chart?cht=tx&chl=F-measure%20%3D%20%5Cfrac%7B2Recall%20%2A%20Precision%20%7D%7BRecall%2BPrecision%7D" alt="F-measure = \frac{2Recall * Precision }{Recall+Precision}"/><br />
<img src="http://chart.apis.google.com/chart?cht=tx&chl=Micro-average%20%3D%20%5Cfrac%7B%20%5Csum_%7Bi%3D0%7D%5ENx_%7Bi%7D%20%7D%7B%20%5Csum_%7Bi%3D0%7D%5ENn_%7Bi%7D%20%7D" alt="Micro-average = \frac{ \sum_{i=0}^Nx_{i} }{ \sum_{i=0}^Nn_{i} }"/> <br />
<img src="http://chart.apis.google.com/chart?cht=tx&chl=Macro-average%20%3D%20%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi%3D0%7D%5EN%5Cfrac%7Bx_%7Bi%7D%7D%7Bn_%7Bi%7D%7D" alt="Macro-average = \frac{1}{N} \sum_{i=0}^N\frac{x_{i}}{n_{i}}"/> <br />
AccuracyとPrecisionは相関関係になり、PresicionとRecallは逆相関の関係になるのが一般的です。PresicionとRecallともに予測が正しい事の指標ですが、数式で表すと分母が予測ベースか事実ベースかが異なります。どっちだっけという判断が非常に難しいです。<br />
True Positive,False Positive,False Negative,True Negativeの覚え方ですが、<span class="deco" style="color:#FF0000;">True/Falseは正しく予測できたか</span>、<span class="deco" style="color:#FF0000;">Positive/Negativeは予測が正負のどちらに判断されたかを示す内容</span>です。False Positive,False Negativeが結果と予測が一致していないので駄目な予測ということになります。正/負という言葉が入ると少しややこしい感じがしますね。上の表では正を1、負を-1と置き換えました。</p>

</blockquote>

</div>
<div class="section">
<h4>Cross-Validation</h4>

<blockquote>
    <p><a href="http://d.hatena.ne.jp/yutakikuchi/20120829/1346197290">10秒で設定可能なlibsvmで機械学習を行う - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20120829/1346197290"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20120829/1346197290" alt="はてなブックマーク - 10秒で設定可能なlibsvmで機械学習を行う - Yuta.Kikuchiの日記" border="0" /></a><br />
以前に<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>にてK-Fold-Cross-Validationを行いました。記事を書いた時は自分で学習データ,評価データを分割してK回学習/評価を行っていましたが、実は<a class="keyword" href="http://d.hatena.ne.jp/keyword/svm">svm</a>-trainコマンドにはvオプションでK-Foldを指定でき、平均Accuracyを表示してくれるようです。<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>と同じような<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C4%A1%BC%A5%EB">ツール</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/svm">svm</a>-lightというものがありますが、xオプションを指定するとLeave-One-Out-Cross-Validationが実現できるようです。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>を用いて再度news20-binaryを<a class="keyword" href="http://d.hatena.ne.jp/keyword/svm">svm</a>の線形予測を行ってみます。news20-binaryはデータ量が多く学習に時間がかかりそうだったので半分のデータを利用しました。今回はCross-Validationをvオプションで行う事とPrecision,Recall,<a class="keyword" href="http://d.hatena.ne.jp/keyword/F%C3%CD">F値</a>を求めます。通常の<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>ではこれらを計算できないのでsleepy_yoshiさんが作られているpatchを当てます。<a href="http://d.hatena.ne.jp/sleepy_yoshi/20110915/p1">LibSVMのcross validationオプションでprecision/recallを出力する - 睡眠不足？！</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/sleepy_yoshi/20110915/p1"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/sleepy_yoshi/20110915/p1" alt="はてなブックマーク - LibSVMのcross validationオプションでprecision/recallを出力する - 睡眠不足？！" border="0" /></a> 注しなければいけないことはCross-Validationを実行するとmodelは作成されません。K-Foldを5と指定し、<span class="deco" style="color:#FF0000;">Cross Validation Accuracy = 84.21%</span>を得る事ができました。</p>
<pre class="code" data-lang="" data-unlink>$ wget wget http://sleepyheads.jp/software/svm-train.patch

$ patch < svm-train.patch

$ gmake clean

$ gmake

$ wget http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/binary/news20.binary.bz2

$ bzip2 -d news20.binary.bz2

$ cat news20.binary
+1 103:0.250000 279:0.250000 291:0.250000 5757:0.250000 16311:0.250000 16314:0.250000 30408:0.250000 85418:0.250000
-1 40:0.041065 75:0.041065 89:0.041065 97:0.041065 103:0.041065 108:0.041065 114:0.041065 149:0.041065 170:0.041065 171:0.041065 174:0.041065

$ grep '^\-1' news20.binary | head -n 5000 > train.txt
$ grep '^\+1' news20.binary | head -n 5000 >> train.txt

$ svm-train -v 5 train.txt
Cross Validation Accuracy = 84.21%
Positive (+1) class:
  precision = 0.7466
 recall = 0.922868
   F1 value = 0.825428

Negative (-1) class:
  precision = 0.9376
 recall = 0.787238
   F1 value = 0.855865</pre><p>svmlightでも同じようなことをやってみます。<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>とsvmlightの入力<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A1%BC%A5%BF%B7%C1%BC%B0">データ形式</a>は互換性があるようです。まずはinstallするところから進めます。<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>と同様にsvmlightも圧縮ファイルを解凍してgmakeするだけで<a class="keyword" href="http://d.hatena.ne.jp/keyword/svm">svm</a>_learn,<a class="keyword" href="http://d.hatena.ne.jp/keyword/svm">svm</a>_classifyコマンドが生成されます。上で利用したtrain.txtとpredict.txtをそれぞれ用意してAccuracy/Preciseion/Recallの値を見てみます。<a class="keyword" href="http://d.hatena.ne.jp/keyword/svm">svm</a>_learnに少し時間がかかりましたが、<span class="deco" style="color:#FF0000;">Accuracy: 69.25% Precision:91.67% Recall:42.35%</span>となりました。</p>
<pre class="code" data-lang="" data-unlink>$ wget http://download.joachims.org/svm_light/current/svm_light.tar.gz

$ tar -xzf svm_light.tar.gz

$ gmake

$ grep '^\-1' news20.binary | tail -n 4000 > predict.txt
$ grep '^\+1' news20.binary | tail -n 4000 >> predict.txt

$ svm_learn -x 1 train.txt model

$ svm_classify predict.txt model output
(略)
Leave-one-out estimate of the error: error=1.89%
Leave-one-out estimate of the recall: recall=98.28%
Leave-one-out estimate of the precision: precision=97.95%
Actual leave-one-outs computed:  561 (rho=1.00)
Runtime for leave-one-out in cpu-seconds: 2652.56

$ svm_classify predict.txt model output
Reading model...OK. (4120 support vectors read)
Classifying test examples..100..200..300..400..500..600..700..800..900..1000..1100..1200..1300..1400..1500..1600..1700..1800..1900..2000..2100..2200..2300..2400..2500..2600..2700..2800..2900..3000..3100..3200..3300..3400..3500..3600..3700..3800..3900..4000..4100..4200..4300..4400..4500..4600..4700..4800..4900..5000..5100..5200..5300..5400..5500..5600..5700..5800..5900..6000..6100..6200..6300..6400..6500..6600..6700..6800..6900..7000..7100..7200..7300..7400..7500..7600..7700..7800..7900..8000..done
Runtime (without IO) in cpu-seconds: 0.15
Accuracy on test set: 69.25% (5540 correct, 2460 incorrect, 8000 total)
Precision/recall on test set: 91.67%/42.35%</pre>
</blockquote>

</div>
<div class="section">
<h4>ROC曲線、AUC</h4>

<blockquote>
    <p>ROC曲線は2値分類問題を解く場合に利用するもので、TruePositiveとFalsePositiveの割合をplotし、分類器の精度評価を行う目的で利用します。通常は縦軸にTruePositive、横軸にFalsePositiveを定義します。精度が高いことを証明するために理想の曲線としては横軸の値が小さい段階で縦軸の値が高く示し、そこから水平に伸びて行く状態です。縦軸には<img src="http://chart.apis.google.com/chart?cht=tx&chl=%5Cfrac%7BTP%7D%7BTP%2BFN%7D" alt="\frac{TP}{TP+FN}"/> 横軸には<img src="http://chart.apis.google.com/chart?cht=tx&chl=%5Cfrac%7BFP%7D%7BFP%2BTN%7D" alt="\frac{FP}{FP+TN}"/>をplotします。AUCとはROC曲線より下に示される面積であるのでROCが縦軸に高く引っ張られているほど面積も大きくなります。ランダムの場合ROC曲線が[0,0],[1,1]への直線となり、AUCは1*1/2 = 0.5となります。<br />
<a href="http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/">LIBSVM Tools</a> <a href="http://b.hatena.ne.jp/entry/www.csie.ntu.edu.tw/~cjlin/libsvmtools/"><img src="http://b.hatena.ne.jp/entry/image/http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/" alt="はてなブックマーク - LIBSVM Tools" border="0" /></a> ROC Curve for Binary <a class="keyword" href="http://d.hatena.ne.jp/keyword/SVM">SVM</a>という項目に<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>向けの<a class="keyword" href="http://d.hatena.ne.jp/keyword/Matlab">Matlab</a>と<a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>用のコマンド<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>が用意されています。これを利用してROC曲線を描きAUCを算出してみます。残念ながら手元には<a class="keyword" href="http://d.hatena.ne.jp/keyword/Matlab">Matlab</a>が無いので<a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>で試してみます。 <a href="http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/roc/plotroc.py">http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/roc/plotroc.py</a> このplotroc.pyを取得します。この実行には<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>を解凍した時に生成される<a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a>ディレクトリ以下の<a class="keyword" href="http://d.hatena.ne.jp/keyword/svm">svm</a>.py、svmutil.pyというファイルを必要とします。<a class="keyword" href="http://d.hatena.ne.jp/keyword/python">python</a> scriptを通しても<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>のオプションは基本的にそのまま利用できます。</p>
<pre class="code" data-lang="" data-unlink>$ wget http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/roc/plotroc.py

$ python plotroc.py

$ python plotroc.py -v 5 train.txt</pre><p>上を一度実行したのですが、実行環境のmemory不足で以下のようなエラーがでました。解決方法は現在調査中ですがスマートな対応はできないかもしれないです。ここではtrain.txtのデータ量を半分にする事で再度plotをしました。今度は正常に画像が出力され、AUC=0.7222という値を得る事ができました。ランダムが0.5なのでそれよりは良い結果を得る事ができました。</p>
<pre class="code" data-lang="" data-unlink>optimization finished, #iter = 3973
nu = 0.993250
obj = -7945.807458, rho = 0.999930
nSV = 7946, nBSV = 7946
Total nSV = 7946
Accuracy = 48.65% (973/2000) (classification)
Traceback (most recent call last):
  File "plotroc.py", line 219, in <module>
main()
  File "plotroc.py", line 216, in main
plot_roc(deci, train_y, output_file, output_title)
  File "plotroc.py", line 167, in plot_roc
g = gnuplot(output)
  File "plotroc.py", line 63, in __init__
self.__dict__['iface'] = popen(cmdline,'w')
OSError: [Errno 12] Cannot allocate memory
Exception AttributeError: "gnuplot instance has no attribute 'iface'" in  ignored

-----データ量を半分にしてplot
$ head -n 2500 train.txt > train2.txt
$ tail -n 2500 train.txt >> train2.txt
$ mv train2.txt train.txt 

$ python plotroc.py -v 5 train.txt</pre><p><span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20120909100652" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20120909/20120909100652.png" alt="f:id:yutakikuchi:20120909100652p:image" title="f:id:yutakikuchi:20120909100652p:image" class="hatena-fotolife" itemprop="image"></a></span></p><p>plotされた座標のデータを取得したい場合はplotroc.pyに対して以下の行を追加する事でできます。またAUCも画像で出力するのではなく標準でも出力するように修正しました。</p>
<pre class="hljs python" data-lang="python" data-unlink>$ diff -u plotroc.py plotroc2.py
--- plotroc.py  <span class="synConstant">2010</span>-<span class="synConstant">11</span>-<span class="synConstant">11</span> <span class="synConstant">18</span>:<span class="synConstant">45</span>:<span class="synConstant">28.000000000</span> +0900
+++ plotroc2.py <span class="synConstant">2012</span>-09-09 <span class="synConstant">17</span>:<span class="synConstant">58</span>:<span class="synConstant">31.000000000</span> +0900
<span class="synPreProc">@@</span> -<span class="synConstant">150</span>,<span class="synConstant">6</span> +<span class="synConstant">150</span>,<span class="synConstant">7</span> <span class="synPreProc">@@</span>
            tp+=<span class="synConstant">1</span>
        <span class="synStatement">else</span>:
            fp+=<span class="synConstant">1</span>
+       <span class="synIdentifier">print</span> fp/neg,tp/pos
        xy_arr.append([fp/neg,tp/pos])
 
    <span class="synComment">#area under curve</span>
<span class="synPreProc">@@</span> -<span class="synConstant">159</span>,<span class="synConstant">6</span> +<span class="synConstant">160</span>,<span class="synConstant">7</span> <span class="synPreProc">@@</span>
        <span class="synStatement">if</span> x != prev_x:
            aoc += (x - prev_x) * y
            prev_x = x
+   <span class="synIdentifier">print</span> <span class="synConstant">"AUC = %0.4f"</span> % aoc 
 
    <span class="synComment">#begin gnuplot</span>
    <span class="synStatement">if</span> title == <span class="synIdentifier">None</span>:

<span class="synConstant">0.996</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9964</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9968</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9972</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9976</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.998</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9984</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9988</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9992</span> <span class="synConstant">1.0</span>
<span class="synConstant">0.9996</span> <span class="synConstant">1.0</span>
<span class="synConstant">1.0</span> <span class="synConstant">1.0</span>

AUC = <span class="synConstant">0.7222</span>
</pre><p>ここで気づいたのですが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/libsvm">libsvm</a>はデフォルトでRBFを選択しているのでtオプションで線形を選択して再度実行してみます。結果的にはAUCが0.9973という恐ろしい値を得る事ができました。やり方が間違っていないか逆に心配です。</p>
<pre class="code" data-lang="" data-unlink>$ python plotroc.py -t 0 -v 5 -h 0 train.txt</pre><p><span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20120909103926" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20120909/20120909103926.png" alt="f:id:yutakikuchi:20120909103926p:image" title="f:id:yutakikuchi:20120909103926p:image" class="hatena-fotolife" itemprop="image"></a></span><br />
</p>

</blockquote>

</div>
<div class="section">
<h4>Links</h4>

<blockquote>
    
<ul>
<li><a href="http://www.bi.a.u-tokyo.ac.jp/~tak/svm-light.html">TAKASHI ISHIDA HomePage - SVM light</a> <a href="http://b.hatena.ne.jp/entry/www.bi.a.u-tokyo.ac.jp/~tak/svm-light.html"><img src="http://b.hatena.ne.jp/entry/image/http://www.bi.a.u-tokyo.ac.jp/~tak/svm-light.html" alt="はてなブックマーク - TAKASHI ISHIDA HomePage - SVM light" border="0" /></a></li>
<li><a href="http://d.hatena.ne.jp/sleepy_yoshi/20110915/p1">LibSVMのcross validationオプションでprecision/recallを出力する - 睡眠不足？！</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/sleepy_yoshi/20110915/p1"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/sleepy_yoshi/20110915/p1" alt="はてなブックマーク - LibSVMのcross validationオプションでprecision/recallを出力する - 睡眠不足？！" border="0" /></a></li>
<li><a href="http://ibisforest.org/index.php?FrontPage">FrontPage - 機械学習の「朱鷺の杜Wiki」</a> <a href="http://b.hatena.ne.jp/entry/ibisforest.org/index.php?FrontPage"><img src="http://b.hatena.ne.jp/entry/image/http://ibisforest.org/index.php?FrontPage" alt="はてなブックマーク - FrontPage - 機械学習の「朱鷺の杜Wiki」" border="0" /></a></li>
<li><a href="http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/">LIBSVM Tools</a> <a href="http://b.hatena.ne.jp/entry/www.csie.ntu.edu.tw/~cjlin/libsvmtools/"><img src="http://b.hatena.ne.jp/entry/image/http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/" alt="はてなブックマーク - LIBSVM Tools" border="0" /></a></li>
</ul>
</blockquote>

</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201209070848/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yutakikuchi.github.io/blog/post/201209070848/">joinコマンドが便利過ぎて生きるのが辛い</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yutakikuchi.github.io/blog/post/201210090830/">線形予測の機械学習ツールliblinearで効果最大化のための最適な定数Cを探る</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201210090830/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yutakikuchi.github.io/blog/js/ui.js"></script>
<script src="https://yutakikuchi.github.io/blog/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-20616165-3', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

