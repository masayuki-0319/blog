<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="canonical" href="http://yut.hatenablog.com/entry/20140217/1392593317" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="google-site-verification" content="haibt4AEKoLJlBFYmXsLiGTEe4PSc23sIiAIeez8nJM">
  <meta name="generator" content="Hugo 0.55.4" />

  <title>【男の浪漫】身長、体重およびスリーサイズを素性とした「アレ」のサイズを推定する実験 &middot; Y&#39;s note</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://yutakikuchi.github.io/blog/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/my.css">
    
  
  
    
        <script src="https://yutakikuchi.github.io/blog/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://yutakikuchi.github.io/blog/">Y's note</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/yutakikuchi_" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/yuta.kikuchi.007" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/https://www.slideshare.net/yutakikuchi58/" target="_blank"><i class="fa fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/https://www.linkedin.com/in/%E4%BD%91%E5%A4%AA-%E8%8F%8A%E6%B1%A0-36291a44/" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yutakikuchi" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>【男の浪漫】身長、体重およびスリーサイズを素性とした「アレ」のサイズを推定する実験</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2014 Feb 17, 08:28</time>
  </div>

  

  

  

</div>

  

<h2 id="機械学習-男の浪漫-身長-体重およびスリーサイズを素性とした-アレ-のサイズを推定する実験">[機械学習] : 【男の浪漫】身長、体重およびスリーサイズを素性とした「アレ」のサイズを推定する実験</h2>

<div class="section">
<h4>目次</h4>

<blockquote>
    
<ol>
<li>実験の要点</li>
<li>デー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BF%A5%BB%A5%C3%A5%C8">タセット</a>の作成</li>
<li>実験
<ul>
<li>5-Fold Cross Validationによる精度評価</li>
<li>予測</li>
</ul></li>
<li>結論</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Github">Github</a></li>
</ol>
</blockquote>

</div>
<div class="section">
<h4>実験の要点</h4>

<blockquote>
    <p><a href="http://d.hatena.ne.jp/yutakikuchi/20130719/1374191188">アダルトフィルタ実装に向けたA○女優リストの自動抽出 + α - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20130719/1374191188"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20130719/1374191188" alt="はてなブックマーク - アダルトフィルタ実装に向けたA○女優リストの自動抽出 + α - Yuta.Kikuchiの日記" border="0" /></a><br />
<a href="http://d.hatena.ne.jp/yutakikuchi/20130722/1374450419">Multi-Class Classifier of Bra Size used as the feature value with vital statics - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20130722/1374450419"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20130722/1374450419" alt="はてなブックマーク - Multi-Class Classifier of Bra Size used as the feature value with vital statics - Yuta.Kikuchiの日記" border="0" /></a><br />
<span class="deco" style="color:#FF0000;font-weight:bold;">※本エントリーは2013年7月22日に公開したMulti-Class Classifier of Bra Size used as the feature value with vital staticsの続編になります。</span></p><br />
<p>好きな女性芸能人のスリーサイズは公開されているが、<span class="deco" style="font-weight:bold;color:red">「アレのサイズ」(ブラサイズ)</span>は非公開ということがよくあります。直接的なアレのサイズは公表しない風習が漂っていますよね。そんなもどかしい状態の中、世の中の男性は脳内で必ずと言って良い程アレのサイズを想像(補完)していると思います。アレのサイズを推定する先行研究？として<span class="deco" style="font-weight:bold;color:red">身長を基にした「<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B4%A1%BC%A5%EB%A5%C7%A5%F3%A5%AB%A5%CE%A5%F3">ゴールデンカノン</a>」による理想サイズ算出</span>という方法があるようです。あくまで理想サイズなんですが、<span class="deco" style="font-weight:bold;">男性陣が知りたいのは現実サイズ</span>だと思います。<a href="http://www.d9.dion.ne.jp/~ne1gi/bustcheck/cupchecker.html">美少女、バストカップ数測定スクリプト 070731</a> <a href="http://b.hatena.ne.jp/entry/www.d9.dion.ne.jp/~ne1gi/bustcheck/cupchecker.html"><img src="http://b.hatena.ne.jp/entry/image/http://www.d9.dion.ne.jp/~ne1gi/bustcheck/cupchecker.html" alt="はてなブックマーク - 美少女、バストカップ数測定スクリプト 070731" border="0" /></a></p><br />
<p><a href="http://ja.wikipedia.org/wiki/%E3%82%B9%E3%83%AA%E3%83%BC%E3%82%B5%E3%82%A4%E3%82%BA">Vital Statics - Wikipedia</a> <a href="http://b.hatena.ne.jp/entry/ja.wikipedia.org/wiki/%E3%82%B9%E3%83%AA%E3%83%BC%E3%82%B5%E3%82%A4%E3%82%BA"><img src="http://b.hatena.ne.jp/entry/image/http://ja.wikipedia.org/wiki/%E3%82%B9%E3%83%AA%E3%83%BC%E3%82%B5%E3%82%A4%E3%82%BA" alt="はてなブックマーク - スリーサイズ - Wikipedia" border="0" /></a><br />
一般的な話ですがスリーサイズからアレのサイズを導きだすのは難しいとされています。( BraSize = TopBust - UnderBust。UnderBust ≠ Waist ) 個人のスリーサイズからの算出は難しいのかもしれませんが、集団データから傾向の推定はできるのでは無いかというのが今回の実験のテーマです。<span class="deco" style="font-weight:bold;color:#FF0000;">現実のサイズを知るために身長、体重、スリーサイズを素性(特徴)とした推定実験</span>を行います。データに利用したのは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Wikipedia">Wikipedia</a>に記載されているA○女優の方々のデータです。※当然アレのサイズのエリート属性の方々ですので、今回の実験で作成するModelが一般ぴーぽーに当てはめる事はできないと思います。<a href="http://d.hatena.ne.jp/yutakikuchi/20130719/1374191188">アダルトフィルタ実装に向けたA○女優リストの自動抽出 + α - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20130719/1374191188"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20130719/1374191188" alt="はてなブックマーク - アダルトフィルタ実装に向けたA○女優リストの自動抽出 + α - Yuta.Kikuchiの日記" border="0" /></a></p><br />
<p><a href="http://www.csie.ntu.edu.tw/~cjlin/liblinear/">LIBLINEAR -- A Library for Large Linear Classification</a> <a href="http://b.hatena.ne.jp/entry/www.csie.ntu.edu.tw/~cjlin/liblinear/"><img src="http://b.hatena.ne.jp/entry/image/http://www.csie.ntu.edu.tw/~cjlin/liblinear/" alt="はてなブックマーク - LIBLINEAR -- A Library for Large Linear Classification" border="0" /></a><br />
以下のようなデータ(ero.tsvというファイル名)の身長、体重、スリーサイズのVectorDataを学習させるので<a class="keyword" href="http://d.hatena.ne.jp/keyword/SVM">SVM</a>を利用します。利用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C4%A1%BC%A5%EB">ツール</a>はLIBLINEARにします。下が<a class="keyword" href="http://d.hatena.ne.jp/keyword/Wikipedia">Wikipedia</a>から抽出したサンプルデータですが、見て分かるようにBraサイズが欠損している場合があります。欠損を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B5%A1%B3%A3%B3%D8%BD%AC">機械学習</a>の力で埋めて行きます。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ head <span class="synSpecial">-n</span> <span class="synConstant">10</span> ero.tsv
head <span class="synSpecial">-n</span> <span class="synConstant">10</span> ero.tsv
Name:愛あいり   Height:<span class="synConstant">172</span> Weight:―    Bust:<span class="synConstant">110</span>   Waist:<span class="synConstant">70</span>   Hip:<span class="synConstant">90</span> Bra:J
Name:藍ゆうき   Height:<span class="synConstant">163</span> Weight:―    Bust:<span class="synConstant">83</span>    Waist:― Hip:<span class="synConstant">85</span> Bra:B
Name:相内しおり  Height:<span class="synConstant">160</span> Weight:―    Bust:<span class="synConstant">85</span>    Waist:<span class="synConstant">58</span>   Hip:<span class="synConstant">88</span> Bra:D
Name:愛内希    Height:<span class="synConstant">162</span> Weight:―    Bust:<span class="synConstant">80</span>    Waist:<span class="synConstant">57</span>   Hip:<span class="synConstant">83</span> Bra:C65
Name:愛内萌    Height:<span class="synConstant">165</span> Weight:―    Bust:<span class="synConstant">86</span>    Waist:<span class="synConstant">56</span>   Hip:<span class="synConstant">82</span> Bra:-
Name:相内リカ   Height:<span class="synConstant">156</span> Weight:―    Bust:<span class="synConstant">96</span>    Waist:<span class="synConstant">61</span>   Hip:<span class="synConstant">87</span> Bra:H
Name:愛内梨花   Height:<span class="synConstant">164</span> Weight:―    Bust:<span class="synConstant">85</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">85</span> Bra:E<span class="synConstant">-65</span>
Name:AIKA   Height:<span class="synConstant">163</span> Weight:―    Bust:<span class="synConstant">87</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">84</span> Bra:D
Name:藍花 Height:<span class="synConstant">158</span> Weight:―    Bust:<span class="synConstant">88</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">87</span> Bra:E
Name:秋元まゆ花  Height:<span class="synConstant">155</span> Weight:―    Bust:<span class="synConstant">80</span>    Waist:<span class="synConstant">59</span>   Hip:<span class="synConstant">85</span> Bra:D

$ <span class="synStatement">grep</span> <span class="synStatement">"</span><span class="synConstant">Bra:-</span><span class="synStatement">"</span> ero.tsv | <span class="synStatement">tail</span> <span class="synSpecial">-n</span> <span class="synConstant">10</span>
Name:吉野真理   Height:<span class="synConstant">154</span> Weight:―    Bust:<span class="synConstant">84</span>    Waist:<span class="synConstant">58</span>   Hip:<span class="synConstant">84</span> Bra:-
Name:吉原　ミィナ Height:<span class="synConstant">157</span> Weight:―    Bust:<span class="synConstant">83</span>    Waist:<span class="synConstant">57</span>   Hip:<span class="synConstant">83</span> Bra:-
Name:二宮沙羅   Height:<span class="synConstant">158</span> Weight:―    Bust:<span class="synConstant">83</span>    Waist:<span class="synConstant">56</span>   Hip:<span class="synConstant">85</span> Bra:-
Name:Rico   Height:<span class="synConstant">162</span> Weight:―    Bust:<span class="synConstant">89</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">87</span> Bra:-
Name:りつか    Height:<span class="synConstant">154</span> Weight:―    Bust:<span class="synConstant">84</span>    Waist:<span class="synConstant">58</span>   Hip:<span class="synConstant">85</span> Bra:-
Name:RYU    Height:<span class="synConstant">164</span> Weight:―    Bust:<span class="synConstant">88</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">90</span> Bra:-
Name:若瀬千夏   Height:<span class="synConstant">156</span> Weight:<span class="synConstant">34</span>  Bust:<span class="synConstant">87</span>    Waist:<span class="synConstant">53</span>   Hip:<span class="synConstant">80</span> Bra:-
Name:若菜亜衣   Height:<span class="synConstant">160</span> Weight:―    Bust:<span class="synConstant">85</span>    Waist:<span class="synConstant">57</span>   Hip:<span class="synConstant">86</span> Bra:-
Name:若菜瀬奈   Height:<span class="synConstant">158</span> Weight:―    Bust:<span class="synConstant">84</span>    Waist:<span class="synConstant">58</span>   Hip:<span class="synConstant">83</span> Bra:-
Name:渡瀬ミク   Height:<span class="synConstant">155</span> Weight:―    Bust:<span class="synConstant">80</span>    Waist:<span class="synConstant">55</span>   Hip:<span class="synConstant">80</span> Bra:-
</pre>
</blockquote>

</div>
<div class="section">
<h4>デー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BF%A5%BB%A5%C3%A5%C8">タセット</a>の作成</h4>

<blockquote>
    <p>まずはA○女優のサイズデータを取得します。取得したサイズデータを基にLIBLINEARに入れるデー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BF%A5%BB%A5%C3%A5%C8">タセット</a>を作成します。データの取得、整形する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>を載せておきます。特徴データは<span class="deco" style="color:#FF0000;font-weight:bold;">バスト×ウエスト、バスト×ウエスト×ヒップ、身長×バスト×ウエスト×ヒップ、身長×体重×バスト×ウエスト×ヒップの4種類</span>用意します。LIBLINEARの入力Formatに合わせて正解ラベルのカップサイズもInt型の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vector">Vector</a>に変換しClassのLabel名にします。</p>
<pre class="hljs python" data-lang="python" data-unlink><span class="synComment">#!/usr/bin/env python</span>
<span class="synComment"># -*- coding: utf-8 -*-</span>
<span class="synComment"># データの取得</span>

<span class="synPreProc">import</span> sys,re,urllib,urllib2
f = <span class="synIdentifier">open</span>( <span class="synConstant">'ero.tsv'</span>, <span class="synConstant">'w'</span> )
opener = urllib2.build_opener()
ua = <span class="synConstant">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/534.51.22 (KHTML, like Gecko) Version/5.1.1 Safari/    534.51.22'</span>
referer = <span class="synConstant">'http://www.yahoo.co.jp/'</span>
opener.addheaders = [( <span class="synConstant">'User-Agent'</span>, ua ),( <span class="synConstant">'Referer'</span>, referer )]
urls = []
baseurls = [ <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%81%82%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%81%8B%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%81%95%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%81%9F%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%81%AA%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%81%AF%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%81%BE%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%82%84%E8%A1%8C"</span>,
        <span class="synConstant">"http://ja.wikipedia.org/wiki/AV%E5%A5%B3%E5%84%AA%E4%B8%80%E8%A6%A7_%E3%82%89%E3%83%BB%E3%82%8F%E8%A1%8C"</span> ]
<span class="synStatement">for</span> burl <span class="synStatement">in</span> baseurls:
   <span class="synStatement">try</span>:
  content = opener.<span class="synIdentifier">open</span>( burl ).read()
  <span class="synStatement">if</span> re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<li><a href="(/wiki/.*?)">.*?</li>'</span>, re.M ).search( content ) <span class="synStatement">is</span> <span class="synStatement">not</span> <span class="synIdentifier">None</span>:
     tmp_urls = re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<li><a href="(/wiki/.*?)".*?</li>'</span>, re.M ).findall( content )
     urls = urls + tmp_urls
   <span class="synStatement">except</span> <span class="synType">Exception</span>, e:
  <span class="synIdentifier">print</span> e
  <span class="synStatement">continue</span>

<span class="synComment">#dedupe</span>
urls = <span class="synIdentifier">sorted</span>(<span class="synIdentifier">set</span>(urls), key=urls.index)

<span class="synStatement">for</span> url <span class="synStatement">in</span> urls:
   url = <span class="synConstant">"http://ja.wikipedia.org"</span> + url
   nodes = []
   vs = []
   rp = re.<span class="synIdentifier">compile</span>(<span class="synConstant">r'<.*?>'</span>)
   <span class="synStatement">try</span>: 
  content = opener.<span class="synIdentifier">open</span>( url ).read()
  <span class="synStatement">if</span> re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<caption.*?>(.|\n)*?<big><b>(.*?)</b></big></caption>'</span>, re.M ).search( content ) <span class="synStatement">is</span> <span class="synStatement">not</span> <span class="synIdentifier">None</span>:
     tmp = re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<caption.*?>(.|\n)*?<big><b>(.*?)</b></big></caption>'</span>, re.M ).search( content ).group(<span class="synConstant">2</span>)
     nodes.append( <span class="synConstant">"Name:"</span> + tmp.replace( <span class="synConstant">' '</span>, <span class="synConstant">''</span> ) )
  
  <span class="synStatement">if</span> re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<th valign="top" style="font-weight:normal">.*?身長.*?体重.*?</th>'</span>, re.M ).search( content ) <span class="synStatement">is</span> <span class="synStatement">not</span> <span class="synIdentifier">None</span>:
     p  = re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<th valign="top" style="font-weight:normal">.*?身長.*?体重.*?</th>(.|\n)*?<td>(.*?)<a.*?/a>.*?/(.*?)<a.*?/a>.*?</td>'</span>, re.M ).search( content )
     height = rp.sub(<span class="synConstant">''</span>,p.group(<span class="synConstant">2</span>)).replace(<span class="synConstant">' '</span>, <span class="synConstant">''</span>).replace(<span class="synConstant">'cm'</span>, <span class="synConstant">''</span>)
     weight = rp.sub(<span class="synConstant">''</span>,p.group(<span class="synConstant">3</span>)).replace(<span class="synConstant">' '</span>, <span class="synConstant">''</span>).replace(<span class="synConstant">'kg'</span>, <span class="synConstant">''</span>)
     nodes.append( <span class="synConstant">"Height:"</span> + height )
     nodes.append( <span class="synConstant">"Weight:"</span> + weight )

  <span class="synStatement">if</span> re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<th valign="top" style="font-weight:normal" nowrap="nowrap">.*?スリーサイズ.*?</th>'</span>, re.M ).search( content ) <span class="synStatement">is</span> <span class="synStatement">not</span> <span class="synIdentifier">None</span>:
     tmp  = re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<th valign="top" style="font-weight:normal" nowrap="nowrap">.*?スリーサイズ.*?</th>(.|\n)*?<td nowrap="nowrap">(.*?)</td>'</span>, re.M ).search( content ).group(<span class="synConstant">2</span>)
     tmp = tmp.replace( <span class="synConstant">' '</span>, <span class="synConstant">''</span> )
     tmp = tmp.replace( <span class="synConstant">'cm'</span>, <span class="synConstant">''</span> )
     vs = tmp.split( <span class="synConstant">'-'</span> )
     nodes.append( <span class="synConstant">"Bust:"</span> + rp.sub( <span class="synConstant">''</span>, vs[<span class="synConstant">0</span>] ) )
     nodes.append( <span class="synConstant">"Waist:"</span> + rp.sub( <span class="synConstant">''</span>, vs[<span class="synConstant">1</span>] ) )
     nodes.append( <span class="synConstant">"Hip:"</span> + rp.sub( <span class="synConstant">''</span>, vs[<span class="synConstant">2</span>] ) )
  
  <span class="synStatement">if</span> re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<th valign="top" style="font-weight:normal">.*?ブラのサイズ.*?</th>'</span>, re.M ).search( content ) <span class="synStatement">is</span> <span class="synStatement">not</span> <span class="synIdentifier">None</span>:
     tmp  = re.<span class="synIdentifier">compile</span>( <span class="synConstant">r'<th valign="top" style="font-weight:normal">.*?ブラのサイズ.*?</th>(.|\n)*?<td>(.*?)</td>'</span>, re.M ).search( content ).group(<span class="synConstant">2</span>)
     nodes.append( <span class="synConstant">"Bra:"</span> + rp.sub( <span class="synConstant">''</span>, tmp ).replace(<span class="synConstant">'カップ'</span>, <span class="synConstant">''</span>) )
  <span class="synStatement">else</span>:
     nodes.append( <span class="synConstant">"Bra:-"</span> )
  <span class="synStatement">if</span> <span class="synIdentifier">len</span>(nodes) == <span class="synConstant">1</span>:
     <span class="synStatement">continue</span>
  res = <span class="synConstant">"</span><span class="synSpecial">\t</span><span class="synConstant">"</span>.join( nodes ) + <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">"</span>
  f.write( res )
   <span class="synStatement">except</span> <span class="synType">Exception</span>, e:
  <span class="synIdentifier">print</span> e
  <span class="synStatement">continue</span>
f.close()
</pre><pre class="hljs sh" data-lang="sh" data-unlink>$ head <span class="synSpecial">-n</span> <span class="synConstant">10</span> ero.tsv 
Name:愛あいり   Height:<span class="synConstant">172</span> Weight:―    Bust:<span class="synConstant">110</span>   Waist:<span class="synConstant">70</span>   Hip:<span class="synConstant">90</span> Bra:J
Name:藍ゆうき   Height:<span class="synConstant">163</span> Weight:―    Bust:<span class="synConstant">83</span>    Waist:― Hip:<span class="synConstant">85</span> Bra:B
Name:相内しおり  Height:<span class="synConstant">160</span> Weight:―    Bust:<span class="synConstant">85</span>    Waist:<span class="synConstant">58</span>   Hip:<span class="synConstant">88</span> Bra:D
Name:愛内希    Height:<span class="synConstant">162</span> Weight:―    Bust:<span class="synConstant">80</span>    Waist:<span class="synConstant">57</span>   Hip:<span class="synConstant">83</span> Bra:C65
Name:愛内萌    Height:<span class="synConstant">165</span> Weight:―    Bust:<span class="synConstant">86</span>    Waist:<span class="synConstant">56</span>   Hip:<span class="synConstant">82</span> Bra:-
Name:相内リカ   Height:<span class="synConstant">156</span> Weight:―    Bust:<span class="synConstant">96</span>    Waist:<span class="synConstant">61</span>   Hip:<span class="synConstant">87</span> Bra:H
Name:愛内梨花   Height:<span class="synConstant">164</span> Weight:―    Bust:<span class="synConstant">85</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">85</span> Bra:E<span class="synConstant">-65</span>
Name:AIKA   Height:<span class="synConstant">163</span> Weight:―    Bust:<span class="synConstant">87</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">84</span> Bra:D
Name:藍花 Height:<span class="synConstant">158</span> Weight:―    Bust:<span class="synConstant">88</span>    Waist:<span class="synConstant">60</span>   Hip:<span class="synConstant">87</span> Bra:E
Name:秋元まゆ花  Height:<span class="synConstant">155</span> Weight:―    Bust:<span class="synConstant">80</span>    Waist:<span class="synConstant">59</span>   Hip:<span class="synConstant">85</span> Bra:D
</pre><pre class="hljs python" data-lang="python" data-unlink><span class="synComment">#!/usr/bin/env python</span>
<span class="synComment"># -*- coding: utf-8 -*-</span>
<span class="synComment"># liblinear形式に変換 </span>

<span class="synComment"># Bra Size Map</span>
bramap = { <span class="synConstant">'A'</span>:<span class="synConstant">0</span>, <span class="synConstant">'B'</span>:<span class="synConstant">1</span>, <span class="synConstant">'C'</span>:<span class="synConstant">2</span>, <span class="synConstant">'D'</span>:<span class="synConstant">3</span>, <span class="synConstant">'E'</span>:<span class="synConstant">4</span>, <span class="synConstant">'F'</span>:<span class="synConstant">5</span>, <span class="synConstant">'G'</span>:<span class="synConstant">6</span>, <span class="synConstant">'H'</span>:<span class="synConstant">7</span>, <span class="synConstant">'I'</span>:<span class="synConstant">8</span>, <span class="synConstant">'J'</span>:<span class="synConstant">9</span>, <span class="synConstant">'K'</span>:<span class="synConstant">10</span>, <span class="synConstant">'L'</span>:<span class="synConstant">11</span>, <span class="synConstant">'M'</span>:<span class="synConstant">12</span>, <span class="synConstant">'N'</span>:<span class="synConstant">13</span>, <span class="synConstant">'O'</span>:<span class="synConstant">14</span>, <span class="synConstant">'P'</span>:<span class="synConstant">15</span>, <span class="synConstant">'Q'</span>:<span class="synConstant">16</span>, <span class="synConstant">'R'</span>:<span class="synConstant">17</span>, <span class="synConstant">'S'</span>:<span class="synConstant">18</span>, <span class="synConstant">'T'</span>:<span class="synConstant">19</span>, <span class="synConstant">'U'</span>:<span class="synConstant">20</span>, <span class="synConstant">'V'</span>:<span class="synConstant">21</span>, <span class="synConstant">'W'</span>:<span class="synConstant">22</span>, <span class="synConstant">'X'</span>:<span class="synConstant">23</span>, <span class="synConstant">'Y'</span>:<span class="synConstant">24</span>, <span class="synConstant">'Z'</span>:<span class="synConstant">25</span>, <span class="synConstant">'-'</span>:<span class="synConstant">26</span> }

<span class="synComment"># key map</span>
keymap = { <span class="synConstant">'Bra'</span>:<span class="synConstant">0</span>, <span class="synConstant">'Bust'</span>:<span class="synConstant">1</span>, <span class="synConstant">'Waist'</span>:<span class="synConstant">2</span>, <span class="synConstant">'Hip'</span>:<span class="synConstant">3</span>, <span class="synConstant">'Height'</span>:<span class="synConstant">4</span>, <span class="synConstant">'Weight'</span>:<span class="synConstant">5</span> }

<span class="synComment"># logic</span>
ef = <span class="synIdentifier">open</span>( <span class="synConstant">'ero.tsv'</span>, <span class="synConstant">'r'</span> )
data = ef.read()
ef.close()
df2 = <span class="synIdentifier">open</span>( <span class="synConstant">'2feature_data.txt'</span>, <span class="synConstant">'w'</span> )
df3 = <span class="synIdentifier">open</span>( <span class="synConstant">'3feature_data.txt'</span>, <span class="synConstant">'w'</span> )
df4 = <span class="synIdentifier">open</span>( <span class="synConstant">'4feature_data.txt'</span>, <span class="synConstant">'w'</span> )
df5 = <span class="synIdentifier">open</span>( <span class="synConstant">'5feature_data.txt'</span>, <span class="synConstant">'w'</span> )
datalines = data.split( <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">"</span> );
<span class="synStatement">for</span> line <span class="synStatement">in</span> datalines:
   <span class="synStatement">try</span>:
  nodes = line.split(<span class="synConstant">"</span><span class="synSpecial">\t</span><span class="synConstant">"</span>)
  <span class="synIdentifier">list</span> = [<span class="synConstant">0</span>]*<span class="synConstant">6</span> 
  <span class="synStatement">for</span> node <span class="synStatement">in</span> nodes:
     <span class="synStatement">try</span>:
        (key,value) = node.split(<span class="synConstant">":"</span>)
        key = key.replace(<span class="synConstant">' '</span>, <span class="synConstant">''</span>)
        value = value.replace(<span class="synConstant">' '</span>, <span class="synConstant">''</span>)
        <span class="synStatement">if</span> key == <span class="synConstant">'Name'</span>:
           <span class="synStatement">continue</span>
        <span class="synStatement">elif</span> key == <span class="synConstant">'Bra'</span>:
           alpha = value[<span class="synConstant">0</span>].upper()
           <span class="synStatement">if</span> alpha.isalpha() == <span class="synIdentifier">False</span> <span class="synStatement">and</span> alpha != <span class="synConstant">'-'</span>:
              <span class="synStatement">continue</span>
           <span class="synIdentifier">list</span>[keymap[key]] = <span class="synIdentifier">str</span>( bramap[alpha] + <span class="synConstant">1</span>)
        <span class="synStatement">else</span>:
           value = value.replace(<span class="synConstant">'―'</span>,<span class="synConstant">'0'</span>)
           <span class="synStatement">if</span> value.isdigit() == <span class="synIdentifier">False</span>:
              <span class="synStatement">continue</span>
           <span class="synIdentifier">list</span>[keymap[key]] = <span class="synIdentifier">str</span>( keymap[key] ) + <span class="synConstant">':'</span> + <span class="synIdentifier">str</span>( value )
     <span class="synStatement">except</span> <span class="synType">Exception</span>,e:
        <span class="synStatement">continue</span>
  df5.write( <span class="synConstant">' '</span>.join(<span class="synIdentifier">list</span>) + <span class="synConstant">'</span><span class="synSpecial">\n</span><span class="synConstant">'</span> )
  <span class="synStatement">del</span> <span class="synIdentifier">list</span>[<span class="synConstant">5</span>]
  df4.write( <span class="synConstant">' '</span>.join(<span class="synIdentifier">list</span>) + <span class="synConstant">'</span><span class="synSpecial">\n</span><span class="synConstant">'</span> )
  <span class="synStatement">del</span> <span class="synIdentifier">list</span>[<span class="synConstant">4</span>]
  df3.write( <span class="synConstant">' '</span>.join(<span class="synIdentifier">list</span>) + <span class="synConstant">'</span><span class="synSpecial">\n</span><span class="synConstant">'</span> )
  <span class="synStatement">del</span> <span class="synIdentifier">list</span>[<span class="synConstant">3</span>]
  df2.write( <span class="synConstant">' '</span>.join(<span class="synIdentifier">list</span>) + <span class="synConstant">'</span><span class="synSpecial">\n</span><span class="synConstant">'</span> )
   <span class="synStatement">except</span> <span class="synType">Exception</span>,e:
  <span class="synStatement">continue</span>
df2.close()
df3.close()
df4.close()
df5.close()
</pre><pre class="hljs sh" data-lang="sh" data-unlink><span class="synComment"># 先頭がラベル名  バスト×ウエスト×ヒップ×身長×体重のデータ</span>
$ head <span class="synSpecial">-n</span> <span class="synConstant">10</span> 5feature_data.txt 
<span class="synConstant">9</span> <span class="synConstant">1</span>:<span class="synConstant">110</span> <span class="synConstant">2</span>:<span class="synConstant">70</span> <span class="synConstant">3</span>:<span class="synConstant">90</span> <span class="synConstant">4</span>:<span class="synConstant">172</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">1</span> <span class="synConstant">1</span>:<span class="synConstant">83</span> <span class="synConstant">2</span>:<span class="synConstant">0</span> <span class="synConstant">3</span>:<span class="synConstant">85</span> <span class="synConstant">4</span>:<span class="synConstant">163</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">58</span> <span class="synConstant">3</span>:<span class="synConstant">88</span> <span class="synConstant">4</span>:<span class="synConstant">160</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">2</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">57</span> <span class="synConstant">3</span>:<span class="synConstant">83</span> <span class="synConstant">4</span>:<span class="synConstant">162</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">26</span> <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">56</span> <span class="synConstant">3</span>:<span class="synConstant">82</span> <span class="synConstant">4</span>:<span class="synConstant">165</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">7</span> <span class="synConstant">1</span>:<span class="synConstant">96</span> <span class="synConstant">2</span>:<span class="synConstant">61</span> <span class="synConstant">3</span>:<span class="synConstant">87</span> <span class="synConstant">4</span>:<span class="synConstant">156</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">85</span> <span class="synConstant">4</span>:<span class="synConstant">164</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">87</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">84</span> <span class="synConstant">4</span>:<span class="synConstant">163</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">88</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">87</span> <span class="synConstant">4</span>:<span class="synConstant">158</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">59</span> <span class="synConstant">3</span>:<span class="synConstant">85</span> <span class="synConstant">4</span>:<span class="synConstant">155</span> <span class="synConstant">5</span>:<span class="synConstant">0</span>

<span class="synComment"># 先頭がラベル名  バスト×ウエスト×ヒップ×身長のデータ</span>
$ head <span class="synSpecial">-n</span> <span class="synConstant">10</span> 4feature_data.txt
<span class="synConstant">9</span> <span class="synConstant">1</span>:<span class="synConstant">110</span> <span class="synConstant">2</span>:<span class="synConstant">70</span> <span class="synConstant">3</span>:<span class="synConstant">90</span> <span class="synConstant">4</span>:<span class="synConstant">172</span>
<span class="synConstant">1</span> <span class="synConstant">1</span>:<span class="synConstant">83</span> <span class="synConstant">2</span>:<span class="synConstant">0</span> <span class="synConstant">3</span>:<span class="synConstant">85</span> <span class="synConstant">4</span>:<span class="synConstant">163</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">58</span> <span class="synConstant">3</span>:<span class="synConstant">88</span> <span class="synConstant">4</span>:<span class="synConstant">160</span>
<span class="synConstant">2</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">57</span> <span class="synConstant">3</span>:<span class="synConstant">83</span> <span class="synConstant">4</span>:<span class="synConstant">162</span>
<span class="synConstant">26</span> <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">56</span> <span class="synConstant">3</span>:<span class="synConstant">82</span> <span class="synConstant">4</span>:<span class="synConstant">165</span>
<span class="synConstant">7</span> <span class="synConstant">1</span>:<span class="synConstant">96</span> <span class="synConstant">2</span>:<span class="synConstant">61</span> <span class="synConstant">3</span>:<span class="synConstant">87</span> <span class="synConstant">4</span>:<span class="synConstant">156</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">85</span> <span class="synConstant">4</span>:<span class="synConstant">164</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">87</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">84</span> <span class="synConstant">4</span>:<span class="synConstant">163</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">88</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">87</span> <span class="synConstant">4</span>:<span class="synConstant">158</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">59</span> <span class="synConstant">3</span>:<span class="synConstant">85</span> <span class="synConstant">4</span>:<span class="synConstant">155</span>

<span class="synComment"># 先頭がラベル名  バスト×ウエスト×ヒップのデータ</span>
$ head <span class="synSpecial">-n</span> <span class="synConstant">10</span> 3feature_data.txt
<span class="synConstant">9</span> <span class="synConstant">1</span>:<span class="synConstant">110</span> <span class="synConstant">2</span>:<span class="synConstant">70</span> <span class="synConstant">3</span>:<span class="synConstant">90</span>
<span class="synConstant">1</span> <span class="synConstant">1</span>:<span class="synConstant">83</span> <span class="synConstant">2</span>:<span class="synConstant">0</span> <span class="synConstant">3</span>:<span class="synConstant">85</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">58</span> <span class="synConstant">3</span>:<span class="synConstant">88</span>
<span class="synConstant">2</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">57</span> <span class="synConstant">3</span>:<span class="synConstant">83</span>
<span class="synConstant">26</span> <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">56</span> <span class="synConstant">3</span>:<span class="synConstant">82</span>
<span class="synConstant">7</span> <span class="synConstant">1</span>:<span class="synConstant">96</span> <span class="synConstant">2</span>:<span class="synConstant">61</span> <span class="synConstant">3</span>:<span class="synConstant">87</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">85</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">87</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">84</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">88</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">87</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">59</span> <span class="synConstant">3</span>:<span class="synConstant">85</span>

<span class="synComment"># 先頭がラベル名  バスト×ウエストのデータ</span>
$ head <span class="synSpecial">-n</span> <span class="synConstant">10</span> 2feature_data.txt
<span class="synConstant">9</span> <span class="synConstant">1</span>:<span class="synConstant">110</span> <span class="synConstant">2</span>:<span class="synConstant">70</span>
<span class="synConstant">1</span> <span class="synConstant">1</span>:<span class="synConstant">83</span> <span class="synConstant">2</span>:<span class="synConstant">0</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">58</span>
<span class="synConstant">2</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">57</span>
<span class="synConstant">26</span> <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">56</span>
<span class="synConstant">7</span> <span class="synConstant">1</span>:<span class="synConstant">96</span> <span class="synConstant">2</span>:<span class="synConstant">61</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">85</span> <span class="synConstant">2</span>:<span class="synConstant">60</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">87</span> <span class="synConstant">2</span>:<span class="synConstant">60</span>
<span class="synConstant">4</span> <span class="synConstant">1</span>:<span class="synConstant">88</span> <span class="synConstant">2</span>:<span class="synConstant">60</span>
<span class="synConstant">3</span> <span class="synConstant">1</span>:<span class="synConstant">80</span> <span class="synConstant">2</span>:<span class="synConstant">59</span>

<span class="synComment"># 分布調査</span>
$ cut <span class="synSpecial">-f</span> <span class="synConstant">1</span> <span class="synSpecial">-d</span> <span class="synStatement">"</span><span class="synConstant"> </span><span class="synStatement">"</span> 5feature_data.txt | <span class="synStatement">sort</span> | uniq <span class="synSpecial">-c</span> | <span class="synStatement">sort</span> <span class="synSpecial">-k</span> <span class="synConstant">1</span> <span class="synSpecial">-n</span> <span class="synSpecial">-r</span> | awk <span class="synStatement">'</span><span class="synConstant">{print $2 "\t" $1}</span><span class="synStatement">'</span>
<span class="synConstant">4</span>  <span class="synConstant">539</span>
<span class="synConstant">3</span>  <span class="synConstant">475</span>
<span class="synConstant">5</span>  <span class="synConstant">436</span>
<span class="synConstant">6</span>  <span class="synConstant">271</span>
<span class="synConstant">7</span>  <span class="synConstant">245</span>
<span class="synConstant">2</span>  <span class="synConstant">143</span>
<span class="synConstant">8</span>  <span class="synConstant">89</span>
<span class="synConstant">9</span>  <span class="synConstant">47</span>
<span class="synConstant">10</span> <span class="synConstant">25</span>
<span class="synConstant">1</span>  <span class="synConstant">17</span>
<span class="synConstant">11</span> <span class="synConstant">13</span>
<span class="synConstant">13</span> <span class="synConstant">5</span>
<span class="synConstant">12</span> <span class="synConstant">5</span>
<span class="synConstant">17</span> <span class="synConstant">2</span>
<span class="synConstant">16</span> <span class="synConstant">2</span>
<span class="synConstant">15</span> <span class="synConstant">1</span>
<span class="synConstant">14</span> <span class="synConstant">1</span>
</pre><p>ちなみにデー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BF%A5%BB%A5%C3%A5%C8">タセット</a>の分布をグラフ化すると次のようになります。全く関係ありませんが、仕事の残業等で心が辛い時には<span class="deco" style="color:#FF0000;font-weight:bold;">C〜Gまでのサイズが86%という分布</span>を思い出すと少しばかり癒しをもらえるかもしれません。当然この<span class="deco" style="font-weight:bold;">標本データはエリート集団属性になりますので世間一般の分布と勘違いされないようご注意ください</span>。分布抽出のコマンドも上のcutコマンドのようになります。<br />
<span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20140216222950" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20140216/20140216222950.png" alt="f:id:yutakikuchi:20140216222950p:image:w560" title="f:id:yutakikuchi:20140216222950p:image:w560" class="hatena-fotolife" style="width:560px" itemprop="image"></a></span></p>

</blockquote>

</div>
<div class="section">
<h4>実験</h4>

<blockquote>
    
<div class="section">
<h5>5-Fold Cross Validationによる精度評価</h5>
<p><a href="http://d.hatena.ne.jp/yutakikuchi/20121009/1349739006">線形予測の機械学習ツールliblinearで効果最大化のための最適な定数Cを探る - Yuta.Kikuchiの日記</a> <a href="http://b.hatena.ne.jp/entry/d.hatena.ne.jp/yutakikuchi/20121009/1349739006"><img src="http://b.hatena.ne.jp/entry/image/http://d.hatena.ne.jp/yutakikuchi/20121009/1349739006" alt="はてなブックマーク - 線形予測の機械学習ツールliblinearで効果最大化のための最適な定数Cを探る - Yuta.Kikuchiの日記" border="0" /></a>上で作成したデー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BF%A5%BB%A5%C3%A5%C8">タセット</a>を基に5-Fold Cross Validationを行います。LIBLINEARの設定や使い方は上の記事を参考にしてください。<br />
実行した結果は下のようになりました。だいたい3割は当てる事が可能という話です。精度数値から見ると<span class="deco" style="font-weight:bold;">バスト×ウエスト×ヒップ×身長の素性を使った場合は30.6563%</span>となっています。体重は非公開とされている場合が多いので精度向上となる素性として取り扱われなかったようです。MultiClassをドンピシャで解く問題としては中々の精度なのではないでしょうか。ここでは実験しませんが多少の誤差は許容して+-ワンカップも正解と認める、推定確立を出して<a class="keyword" href="http://d.hatena.ne.jp/keyword/%EF%E7%C3%CD">閾値</a>以下は対象としない等すると更に精度が上がると思います。人間の目だとどこまで精度出せますかね... 目視力に優れた人なら3割ぐらい楽勝で超えるかもしれないですね...</p>

<table>
<tr>
<th> 素性 </th>
<th> 精度 </th>
</tr>
<tr>
<td> バスト×ウエスト </td>
<td>  28.3679% </td>
</tr>
<tr>
<td> バスト×ウエスト×ヒップ </td>
<td>  30.1813% </td>
</tr>
<tr>
<td> バスト×ウエスト×ヒップ×身長 </td>
<td> 30.6563% </td>
</tr>
<tr>
<td> バスト×ウエスト×ヒップ×身長×体重 </td>
<td> 30.5268% </td>
</tr>
</table><pre class="code" data-lang="" data-unlink>$ train -v 5 -s 2 2feature_data.txt
Cross Validation Accuracy = 28.3679%

$ train -v 5 -s 2 3feature_data.txt
Cross Validation Accuracy = 30.1813%

$ train -v 5 -s 2 4feature_data.txt
Cross Validation Accuracy = 30.6563%

$ train -v 5 -s 2 5feature_data.txt
Cross Validation Accuracy = 30.5268%</pre>
</div>
<div class="section">
<h5>予測</h5>
<p>欠損していたアレのサイズを予測で埋めて行きます。5-Fold Cross Validationを行ったデータを学習データ、素性はあるけどアレのサイズが無いデータを評価データとします。評価データのセットは以下の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>コードと<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>コマンドで生成します。推定された結果を加えると円Graphの分布が少し変わります。棒Graphは青が学習データの人数/橙が学習データ＋推定人数の合計人数になります。推定によるBの躍進... うーん... pasteにより評価データと結果を結合する事で欠損していた人の名前とサイズを結びつける事ができます。</p>
<pre class="hljs python" data-lang="python" data-unlink><span class="synComment">#!/usr/bin/env python</span>
<span class="synComment"># -*- coding: utf-8 -*-</span>
<span class="synComment"># 評価データ作成</span>

keymap = { <span class="synConstant">'Name'</span>:<span class="synConstant">0</span>, <span class="synConstant">'Bust'</span>:<span class="synConstant">1</span>, <span class="synConstant">'Waist'</span>:<span class="synConstant">2</span>, <span class="synConstant">'Hip'</span>:<span class="synConstant">3</span>, <span class="synConstant">'Height'</span>:<span class="synConstant">4</span> }

<span class="synComment"># logic</span>
ef = <span class="synIdentifier">open</span>( <span class="synConstant">'ero.tsv'</span>, <span class="synConstant">'r'</span> )
data = ef.read()
ef.close()
dp = <span class="synIdentifier">open</span>( <span class="synConstant">'prediction_data.txt'</span>, <span class="synConstant">'w'</span> )
datalines = data.split( <span class="synConstant">"</span><span class="synSpecial">\n</span><span class="synConstant">"</span> );
<span class="synStatement">for</span> line <span class="synStatement">in</span> datalines:
   <span class="synStatement">try</span>: 
  nodes = line.split(<span class="synConstant">"</span><span class="synSpecial">\t</span><span class="synConstant">"</span>)
  <span class="synIdentifier">list</span> = [<span class="synConstant">0</span>]*<span class="synConstant">5</span>
  <span class="synStatement">for</span> node <span class="synStatement">in</span> nodes:
     <span class="synStatement">try</span>:
        (key,value) = node.split(<span class="synConstant">":"</span>)
        <span class="synComment">#print key,value</span>
        <span class="synStatement">if</span> key == <span class="synConstant">'Bra'</span> <span class="synStatement">and</span> value != <span class="synConstant">'-'</span>:
           <span class="synStatement">del</span> <span class="synIdentifier">list</span>
           <span class="synStatement">break</span> 
        <span class="synStatement">if</span> key != <span class="synConstant">'Name'</span> <span class="synStatement">and</span> value.isdigit() == <span class="synIdentifier">False</span>:
           <span class="synStatement">continue</span>
        <span class="synIdentifier">list</span>[keymap[key]] = <span class="synIdentifier">str</span>( keymap[key] ) + <span class="synConstant">':'</span> + <span class="synIdentifier">str</span>( value )
     <span class="synStatement">except</span> <span class="synType">Exception</span>,e:
        <span class="synStatement">continue</span>
  <span class="synComment">#print list</span>
  dp.write( <span class="synConstant">' '</span>.join(<span class="synIdentifier">list</span>) + <span class="synConstant">'</span><span class="synSpecial">\n</span><span class="synConstant">'</span> )
   <span class="synStatement">except</span> <span class="synType">Exception</span>,e:
  <span class="synStatement">continue</span>
dp.close()
</pre><pre class="hljs sh" data-lang="sh" data-unlink><span class="synComment"># データの整形</span>
$ cut <span class="synSpecial">-d</span> <span class="synStatement">"</span><span class="synConstant"> </span><span class="synStatement">"</span> <span class="synSpecial">-f</span> <span class="synConstant">2</span>,<span class="synConstant">3</span>,<span class="synConstant">4</span>,<span class="synConstant">5</span> prediction_data.txt <span class="synStatement">></span> test_data.txt
$ perl <span class="synSpecial">-pi</span> <span class="synSpecial">-e</span> <span class="synStatement">"</span><span class="synConstant">s/^/0 /g</span><span class="synStatement">"</span> test_data.txt

<span class="synComment"># Model作成</span>
$ train 4feature_data.txt bra_predict_model

<span class="synComment"># 推定</span>
$ predict test_data.txt bra_predict_model bra_predict_output
$ <span class="synStatement">tail</span> <span class="synSpecial">-n</span> <span class="synConstant">10</span> bra_predict_output 
<span class="synConstant">2</span>
<span class="synConstant">2</span>
<span class="synConstant">2</span>
<span class="synConstant">2</span>
<span class="synConstant">2</span>
<span class="synConstant">2</span>
<span class="synConstant">7</span>
<span class="synConstant">2</span>
<span class="synConstant">2</span>
<span class="synConstant">2</span>

<span class="synComment"># 推定結果の数</span>
$ <span class="synStatement">sort</span> bra_predict_output | uniq <span class="synSpecial">-c</span> | awk <span class="synStatement">'</span><span class="synConstant">{print $2"\t"$1}</span><span class="synStatement">'</span>
<span class="synConstant">2</span>  <span class="synConstant">357</span>
<span class="synConstant">3</span>  <span class="synConstant">202</span>
<span class="synConstant">6</span>  <span class="synConstant">1</span>
<span class="synConstant">7</span>  <span class="synConstant">19</span>
<span class="synConstant">8</span>  <span class="synConstant">2</span>

<span class="synComment"># ファイル結合</span>
$ paste bra_predict_output prediction_data.txt
<span class="synConstant">2</span>  <span class="synConstant">0</span>:愛内萌 <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">56</span> <span class="synConstant">3</span>:<span class="synConstant">82</span> <span class="synConstant">4</span>:<span class="synConstant">165</span>
<span class="synConstant">2</span>  <span class="synConstant">0</span>:相川とも子 <span class="synConstant">1</span>:<span class="synConstant">83</span> <span class="synConstant">2</span>:<span class="synConstant">56</span> <span class="synConstant">3</span>:<span class="synConstant">83</span> <span class="synConstant">4</span>:<span class="synConstant">157</span>
<span class="synConstant">2</span>  <span class="synConstant">0</span>:愛川ひな <span class="synConstant">1</span>:<span class="synConstant">83</span> <span class="synConstant">2</span>:<span class="synConstant">57</span> <span class="synConstant">3</span>:<span class="synConstant">85</span> <span class="synConstant">4</span>:<span class="synConstant">164</span>
<span class="synConstant">7</span>  <span class="synConstant">0</span>:藍川めぐみ <span class="synConstant">1</span>:<span class="synConstant">95</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">88</span> <span class="synConstant">4</span>:<span class="synConstant">160</span>
<span class="synConstant">2</span>  <span class="synConstant">0</span>:あいかわ優衣 <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">87</span> <span class="synConstant">4</span>:<span class="synConstant">158</span>
<span class="synConstant">2</span>  <span class="synConstant">0</span>:逢坂あきら <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">59</span> <span class="synConstant">3</span>:<span class="synConstant">88</span> <span class="synConstant">4</span>:<span class="synConstant">153</span>
<span class="synConstant">2</span>  <span class="synConstant">0</span>:愛咲めぐ <span class="synConstant">1</span>:<span class="synConstant">86</span> <span class="synConstant">2</span>:<span class="synConstant">60</span> <span class="synConstant">3</span>:<span class="synConstant">84</span> <span class="synConstant">4</span>:<span class="synConstant">162</span>
</pre><p><span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20140217021354" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20140217/20140217021354.png" alt="f:id:yutakikuchi:20140217021354p:image:w560" title="f:id:yutakikuchi:20140217021354p:image:w560" class="hatena-fotolife" style="width:560px" itemprop="image"></a></span><br />
<span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20140217021355" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20140217/20140217021355.png" alt="f:id:yutakikuchi:20140217021355p:image:w560" title="f:id:yutakikuchi:20140217021355p:image:w560" class="hatena-fotolife" style="width:560px" itemprop="image"></a></span></p>

</div>
</blockquote>

</div>
<div class="section">
<h4>結論</h4>

<blockquote>
    <p>今回の実験で以下のような結果を得る事ができました。</p>

<ul>
<li><span class="deco" style="font-weight:bold;">5-Fold Cross Validationの結果で素性をバスト×ウエスト×ヒップ×身長とした場合、精度は31%だった。MultiClassを解く問題としてはそこそこの精度かなと。</span></li>
<li><span class="deco" style="font-weight:bold;">体重は非公開が多く有効な素性にならなかった。</span></li>
<li><span class="deco" style="font-weight:bold;">推定値を合わせた結果でもC〜Gの持ち主が全体の75%という驚異的な数値。男性陣の諸君、人生が辛い時はこの数値を思い出そう。</span></li>
</ul>
</blockquote>

</div>
<div class="section">
<h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/Github">Github</a></h4>

<blockquote>
    <p>※お好きにどうぞ。データの利用は全て自己責任でお願いします。<br />
<a href="https://github.com/yutakikuchi/Python/tree/master/bra">Python/bra at master · yutakikuchi/Python</a> <a href="http://b.hatena.ne.jp/entry/s/github.com/yutakikuchi/Python/tree/master/bra"><img src="http://b.hatena.ne.jp/entry/image/https://github.com/yutakikuchi/Python/tree/master/bra" alt="はてなブックマーク - Python/bra at master · yutakikuchi/Python" border="0" /></a></p>

</blockquote>

</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201402120828/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yutakikuchi.github.io/blog/post/201402120828/">ログ集計システムを自前で作る</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yutakikuchi.github.io/blog/post/201402280825/">OpenSSLの暗号処理が爆速な件</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201402280825/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yutakikuchi.github.io/blog/js/ui.js"></script>
<script src="https://yutakikuchi.github.io/blog/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-20616165-3', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

