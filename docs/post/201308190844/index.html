<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="canonical" href="http://yut.hatenablog.com/entry/20130819/1376869479" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.4" />

  <title>プロセス管理の初歩テクニック &middot; Y&#39;s note</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://yutakikuchi.github.io/blog/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://yutakikuchi.github.io/blog/css/my.css">
    
  
  
    
        <script src="https://yutakikuchi.github.io/blog/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://yutakikuchi.github.io/blog/">Y's note</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yutakikuchi.github.io/blog/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/yutakikuchi_" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/yuta.kikuchi.007" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/https://www.slideshare.net/yutakikuchi58/" target="_blank"><i class="fa fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/https://www.linkedin.com/in/%E4%BD%91%E5%A4%AA-%E8%8F%8A%E6%B1%A0-36291a44/" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yutakikuchi" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>プロセス管理の初歩テクニック</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2013 Aug 19, 08:44</time>
  </div>

  

  

  

</div>

  

<h2 id="linux-プロセス管理の初歩テクニック">[Linux] : プロセス管理の初歩テクニック</h2>

<div class="section">
<h4>Index</h4>

<blockquote>
    
<ol>
<li>一言</li>
<li>Terminalログアウト後もプロセスを残す</li>
<li>プロセスの2重起動防止</li>
<li>簡単に不要なプロセスをkillする</li>
<li>tmuxの薦め</li>
</ol>
</blockquote>

</div>
<div class="section">
<h4>一言</h4>

<blockquote>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA">はてな</a>って不思議なコミュニティーで具体的な実装や調査分析よりも便利なコマンドとかを紹介するネタが何故か重宝されるようなので、良く使うプロセス管理系コマンドの初歩テクニックを書いてみます。( コマンドの学習をより必要とする人が多く一般的な話だからでしょうか？ )</p>

</blockquote>

</div>
<div class="section">
<h4>Terminalログアウト後もプロセスを残す</h4>

<blockquote>
    <p>単一の処理で長時間かかってしまうようなプログラムを実行後にログアウトするとプロセスが消えて悲惨な目に遭います。tmuxやscreenを使って再起動可能な設定をしている人は特に気にする必要はありませんが、これらを使っていない場合は<span class="deco" style="color:#FF0000;font-weight:bold;">nohup</span>でログアウト後もプロセスを残しましょう。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ vi nohuptest.sh
<span class="synComment">#!/bin/sh</span>
<span class="synStatement">sleep</span> <span class="synConstant">1000</span>

$ <span class="synStatement">chmod</span> <span class="synSpecial">+x</span> ./nohuptest.sh

$ <span class="synStatement">nohup</span> ./nohuptest.sh &
<span class="synStatement">[</span><span class="synConstant">1</span><span class="synStatement">]</span> <span class="synConstant">13564</span>
<span class="synComment">#nohup: ignoring input and appending output to `nohup.out'</span>

$ <span class="synStatement">exit</span>

<span class="synComment"># 再度ログイン</span>

$ ps auxww | <span class="synStatement">grep</span> nohuptest
yuta     <span class="synConstant">13564</span>  0.0  0.1 <span class="synConstant">106088</span>  <span class="synConstant">1172</span> ?        SN   <span class="synConstant">03</span>:<span class="synConstant">56</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /bin/sh ./nohuptest.sh
yuta     <span class="synConstant">14059</span>  0.0  0.0 <span class="synConstant">107456</span>   <span class="synConstant">948</span> pts/<span class="synConstant">6</span>    S+   <span class="synConstant">04</span>:<span class="synConstant">00</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> nohuptest
</pre><p>nohupの指定を忘れてしまった場合でも途中からプロセスを残したい場合は<span class="deco" style="color:#FF0000;font-weight:bold;">disown</span>コマンドを利用すれば問題無しです。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ ./nohuptest.sh &
<span class="synStatement">[</span><span class="synConstant">1</span><span class="synStatement">]</span> <span class="synConstant">16004</span>

$ <span class="synStatement">disown</span> %<span class="synConstant">1</span>

$ <span class="synStatement">exit</span>

<span class="synComment"># 再度ログイン</span>

$ ps auxww | <span class="synStatement">grep</span> nohuptest
yuta     <span class="synConstant">16079</span>  0.0  0.1 <span class="synConstant">106088</span>  <span class="synConstant">1168</span> ?        SN   <span class="synConstant">04</span>:<span class="synConstant">17</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /bin/sh ./nohuptest.sh
yuta     <span class="synConstant">16173</span>  0.0  0.0 <span class="synConstant">107456</span>   <span class="synConstant">948</span> pts/<span class="synConstant">8</span>    S+   <span class="synConstant">04</span>:<span class="synConstant">18</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> nohuptest
</pre>
</blockquote>

</div>
<div class="section">
<h4>プロセスの2重起動防止</h4>

<blockquote>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D0%A5%C3%A5%C1%BD%E8%CD%FD">バッチ処理</a>等でプロセスが2重で起動するとデータの不整合が発生する可能性があります。それを防止するためにプロセスの2重起動を防止することを考えます。プロセスの2重起動防止はプロセス名で判断するかLockファイルで実行中フラグを管理する2種類の方法が良く使われます。Lockファイルだとプロセスが途中で落ちた時に削除されない事がありずっと実行中と判断されてしまうので、プロセス名で判断する方がより良いように思います。一応二つともやり方を書いておきます。プロセスが存在するかどうかは<span class="deco" style="font-weight:bold;color:#FF0000;">pgrep</span>、Lockファイル削除<span class="deco" style="font-weight:bold;color:#FF0000;">trap</span>コマンドでシグナルを受け取って行います。下の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>では10秒以内に再度処理を実行しようとすると"Process is Running"と表示されると思います。</p>
<pre class="hljs sh" data-lang="sh" data-unlink><span class="synComment">#!/bin/sh</span>
<span class="synStatement">if [</span> <span class="synPreProc">$$</span> <span class="synStatement">!=</span> <span class="synSpecial">`pgrep -fo </span><span class="synPreProc">$0</span><span class="synSpecial">`</span> <span class="synStatement">];</span> <span class="synStatement">then</span>
   <span class="synStatement">echo</span><span class="synConstant"> </span><span class="synStatement">"</span><span class="synConstant">Process is Running</span><span class="synStatement">";</span>
   <span class="synStatement">exit</span> <span class="synConstant">1</span><span class="synStatement">;</span>
<span class="synStatement">fi</span>
<span class="synStatement">echo</span><span class="synConstant"> </span><span class="synStatement">"</span><span class="synConstant">Process is Started</span><span class="synStatement">"</span>
<span class="synStatement">sleep</span> <span class="synConstant">10</span>;
<span class="synStatement">echo</span><span class="synConstant"> </span><span class="synStatement">"</span><span class="synConstant">Process is Done</span><span class="synStatement">"</span>;
</pre><pre class="hljs sh" data-lang="sh" data-unlink><span class="synComment">#!/bin/sh</span>
<span class="synIdentifier">lockfile</span>=<span class="synStatement">"</span><span class="synPreProc">$0</span><span class="synConstant">.lock</span><span class="synStatement">"</span>
<span class="synStatement">trap</span> <span class="synStatement">'</span><span class="synConstant">echo "trapped."; rm -f ${lockfile}; exit 1</span><span class="synStatement">'</span> <span class="synConstant">1</span> <span class="synConstant">2</span> <span class="synConstant">3</span> <span class="synConstant">15</span>

<span class="synStatement">if [</span> <span class="synStatement">-e</span> <span class="synPreProc">$lockfile</span> <span class="synStatement">];then</span>
   <span class="synStatement">echo</span><span class="synConstant"> </span><span class="synStatement">"</span><span class="synConstant">Process is Running</span><span class="synStatement">"</span>
<span class="synStatement">fi</span>

<span class="synStatement">touch</span> <span class="synPreProc">$lockfile</span>;
<span class="synStatement">echo</span><span class="synConstant"> </span><span class="synStatement">"</span><span class="synConstant">Process is Started</span><span class="synStatement">"</span>
<span class="synStatement">sleep</span> <span class="synConstant">10</span>
<span class="synStatement">rm</span> <span class="synPreProc">$lockfile</span>
<span class="synStatement">echo</span><span class="synConstant"> </span><span class="synStatement">"</span><span class="synConstant">Process is Done</span><span class="synStatement">"</span>
</pre><p>trapはシグナルを受け取るコマンドです。一般的には1 2 3 15のkillシグナルを受けるように設定するようです。番号の意味ですが<span class="deco" style="font-weight:bold;color:#FF0000;">1は再起動</span>、<span class="deco" style="font-weight:bold;color:#FF0000;">2はCTR + Cの割り込み</span>、<span class="deco" style="font-weight:bold;color:#FF0000;">3はCTR + \の中断</span>、<span class="deco" style="font-weight:bold;color:#FF0000;">15はプロセスの終了</span>を表します。trapコマンドで気をつけたいのが<span class="deco" style="font-weight:bold;color:#FF0000;">9の強制終了を受け取る事が出来ません</span>(9を指定しても)。よってkill -9で指定されるとtrap出来ずlockファイルが残ってしまうので注意が必要です。上のshellscriptをtraptest.shとし、killの操作を実行してみます。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ ./traptest.sh

<span class="synComment">#別のterminal windowからpgrepで検知してkill</span>
$ pgrep <span class="synSpecial">-f</span> <span class="synStatement">"</span><span class="synConstant">traptest</span><span class="synStatement">"</span> | xargs <span class="synStatement">kill</span>

<span class="synComment"># trapされている事が分かる。</span>
Process is Started
trapped.
</pre><pre class="hljs sh" data-lang="sh" data-unlink>$ ./traptest.sh

<span class="synComment">#別のterminal windowからpgrepで検知してkill -9</span>
$ pgrep <span class="synSpecial">-f</span> <span class="synStatement">"</span><span class="synConstant">traptest</span><span class="synStatement">"</span> | xargs <span class="synStatement">kill</span> <span class="synConstant">-9</span>

<span class="synComment"># trapされていない事が分かる。</span>
Process is Started
zsh: killed     ./traptest.sh

<span class="synComment"># traptest.sh.lockが残ってしまう。</span>
$ <span class="synStatement">ls</span> <span class="synSpecial">-al</span>
-rwxr-xr-x.  <span class="synConstant">1</span> yuta yuta  <span class="synConstant">237</span>  <span class="synConstant">8</span>月 <span class="synConstant">19</span> <span class="synConstant">02</span>:<span class="synConstant">06</span> <span class="synConstant">2013</span> traptest.sh
-rw-<span class="synStatement">r</span>--<span class="synStatement">r</span>--.  <span class="synConstant">1</span> yuta yuta    <span class="synConstant">0</span>  <span class="synConstant">8</span>月 <span class="synConstant">19</span> <span class="synConstant">02</span>:<span class="synConstant">07</span> <span class="synConstant">2013</span> traptest.sh.lock
</pre>
</blockquote>

</div>
<div class="section">
<h4>簡単に不要なプロセスをkillする</h4>

<blockquote>
    <p>psという起動中のプロセスを表示する代表的なコマンドがありますが、killしたい場合は少々使いづらかったりします。psには自身のコマンドがどうしても含まれてしまうのでそれを<a class="keyword" href="http://d.hatena.ne.jp/keyword/grep">grep</a> -vで除外する必要があります。例えば<a class="keyword" href="http://d.hatena.ne.jp/keyword/httpd">httpd</a>プロセスを全部削除したい場合は以下のようにpsとkillをパイプします。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ ps auxww | <span class="synStatement">grep</span> httpd
ps auxww | <span class="synStatement">grep</span> httpd
root      <span class="synConstant">2149</span>  0.0  0.8 <span class="synConstant">264888</span>  <span class="synConstant">8468</span> ?        Ss   Aug18   <span class="synConstant">0</span>:<span class="synConstant">03</span> /usr/sbin/httpd
apache    <span class="synConstant">2158</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">2160</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">2161</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">2162</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">2163</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">2165</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">2166</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">2167</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5280</span> ?        S    Aug18   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
yuta      <span class="synConstant">4741</span>  0.0  0.0 <span class="synConstant">107460</span>   <span class="synConstant">948</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">14</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd

$ ps auxww | <span class="synStatement">grep</span> httpd | <span class="synStatement">grep</span> <span class="synSpecial">-v</span> <span class="synStatement">grep</span> | awk <span class="synStatement">'</span><span class="synConstant">{print $2}</span><span class="synStatement">'</span> | xargs sudo <span class="synStatement">kill</span>

$ ps auxww | <span class="synStatement">grep</span> httpd
yuta      <span class="synConstant">4810</span>  0.0  0.0 <span class="synConstant">107456</span>   <span class="synConstant">940</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">17</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd
</pre><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/grep">grep</a> -vと<a class="keyword" href="http://d.hatena.ne.jp/keyword/awk">awk</a>がかなり冗長的な命令のように思えてしまいます。そのように感じた人は上でも使った<span class="deco" style="color:#FF0000;font-weight:bold;">pgrep</span>でプロセス名から直接killしても良いと思います。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ ps auxww | <span class="synStatement">grep</span> httpd 
root      <span class="synConstant">4845</span>  0.9  0.9 <span class="synConstant">264888</span>  <span class="synConstant">9276</span> ?        Ss   <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4848</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4849</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4850</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4851</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4852</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4853</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4854</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4855</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5292</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
yuta      <span class="synConstant">4859</span>  0.0  0.0 <span class="synConstant">107460</span>   <span class="synConstant">944</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">20</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd

$ pgrep <span class="synSpecial">-f</span> <span class="synStatement">"</span><span class="synConstant">httpd</span><span class="synStatement">"</span>
<span class="synConstant">4845</span>
<span class="synConstant">4848</span>
<span class="synConstant">4849</span>
<span class="synConstant">4850</span>
<span class="synConstant">4851</span>
<span class="synConstant">4852</span>
<span class="synConstant">4853</span>
<span class="synConstant">4854</span>
<span class="synConstant">4855</span>
<span class="synComment"># 4859の自身のgrepは表示されない</span>

$ pgrep <span class="synSpecial">-f</span> <span class="synStatement">"</span><span class="synConstant">httpd</span><span class="synStatement">"</span> | xargs sudo <span class="synStatement">kill</span>

$ ps auxww | <span class="synStatement">grep</span> httpd             
yuta      <span class="synConstant">4880</span>  0.0  0.0 <span class="synConstant">107456</span>   <span class="synConstant">944</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">23</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd
</pre><p>さらにxargsさえも使う事が面倒だという男気溢れる人は次のように<span class="deco" style="color:#FF0000;font-weight:bold;">pkill</span>もしくは<span class="deco" style="color:#FF0000;font-weight:bold;">killall</span>で一発でお別れを告げても良いと思います。</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ ps auxww | <span class="synStatement">grep</span> httpd
root      <span class="synConstant">4902</span>  0.1  0.9 <span class="synConstant">264888</span>  <span class="synConstant">9272</span> ?        Ss   <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4905</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4906</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4907</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4908</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4909</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4910</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4911</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">4912</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5288</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">25</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
yuta      <span class="synConstant">4922</span>  0.0  0.0 <span class="synConstant">107460</span>   <span class="synConstant">948</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">26</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd

$ sudo pkill <span class="synSpecial">-f</span> <span class="synStatement">"</span><span class="synConstant">httpd</span><span class="synStatement">"</span>

$ ps auxww | <span class="synStatement">grep</span> httpd
yuta      <span class="synConstant">4929</span>  0.0  0.0 <span class="synConstant">107456</span>   <span class="synConstant">940</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">27</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd

$ sudo /etc/init.d/httpd <span class="synStatement">restart</span>
$ ps auxww | <span class="synStatement">grep</span> httpd
root      <span class="synConstant">5045</span>  0.1  0.9 <span class="synConstant">264888</span>  <span class="synConstant">9236</span> ?        Ss   <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5048</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5049</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5050</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5051</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5052</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5053</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5054</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
apache    <span class="synConstant">5055</span>  0.0  0.5 <span class="synConstant">264888</span>  <span class="synConstant">5296</span> ?        S    <span class="synConstant">02</span>:<span class="synConstant">37</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> /usr/sbin/httpd
yuta      <span class="synConstant">5062</span>  0.0  0.0 <span class="synConstant">107460</span>   <span class="synConstant">944</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">38</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd

$ sudo <span class="synStatement">killall</span> <span class="synStatement">"</span><span class="synConstant">httpd</span><span class="synStatement">"</span>

$ ps auxww | <span class="synStatement">grep</span> httpd
yuta      <span class="synConstant">5067</span>  0.0  0.0 <span class="synConstant">107456</span>   <span class="synConstant">944</span> pts/<span class="synConstant">0</span>    S+   <span class="synConstant">02</span>:<span class="synConstant">38</span>   <span class="synConstant">0</span>:<span class="synConstant">00</span> <span class="synStatement">grep</span> httpd
</pre>
</blockquote>

</div>
<div class="section">
<h4>tmuxの薦め</h4>

<blockquote>
    <p>あまりプロセスと関係ありませんが、screenを使っている人は更に機能豊富なtmuxを乗り換えると良いと思います。1つのプロセスでworking spaceとなるwindowを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%A3%BF%F4">複数</a>立てたりpaneと呼ばれる単位の子windowへの分割もできます。またtmuxユーザーはちゃんとデタッチすれば、上で紹介したnohupやdisownを意識する必要が無いです。tmuxは<a class="keyword" href="http://d.hatena.ne.jp/keyword/yum">yum</a>で簡単にinstallも出来ますし、keybindもscreenとさほど変わらないように設定できます。設定ファイルは以下が参考になると思います。<a href="http://n.blueblack.net/articles/2012-07-20_04_comfortable_cui_environment_tmux/">zsh, tmux, vimで構築する快適なCUI環境 2/3 「tmux」編 - ナレッジエース</a> <a href="http://b.hatena.ne.jp/entry/n.blueblack.net/articles/2012-07-20_04_comfortable_cui_environment_tmux/"><img src="http://b.hatena.ne.jp/entry/image/http://n.blueblack.net/articles/2012-07-20_04_comfortable_cui_environment_tmux/" alt="はてなブックマーク - zsh, tmux, vimで構築する快適なCUI環境 2/3 「tmux」編 - ナレッジエース" border="0" /></a>.tmux.confを設定し、tmuxコマンドで起動します。これほど便利なtmuxをまだ使わずにscreenにしがみつく開発者が同環境に存在した場合、今回覚えたpgrepやkillallでscreenプロセスを一匹残らず駆逐するのも良いかと思います。(冗談です)</p>
<pre class="hljs sh" data-lang="sh" data-unlink>$ sudo yum <span class="synStatement">install</span> tmux <span class="synSpecial">-y</span>
$ vi ~/.tmux.conf

<span class="synComment">#新しいウィンドウのベース番号</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> base-index 1</span>
<span class="synComment">#全てのベルを無視</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> bell-action none</span>
<span class="synComment">#各セッションで保持するバッファ数</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> buffer-limit 20</span>
<span class="synComment">#256色端末を使用</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> default-terminal </span><span class="synStatement">"</span><span class="synConstant">xterm</span><span class="synStatement">"</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> default-command /usr/local/bin/zsh</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> default-shell /usr/local/bin/zsh</span>

<span class="synComment">#ウィンドウ履歴で保持される最大行数</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> history-limit 5000</span>
<span class="synComment">#Escapeキー入力時の待ち時間(0.5秒)をキャンセル</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-s</span><span class="synIdentifier"> escape-time 0</span>
<span class="synComment">#ウィンドウを実行コマンド名で自動リネーム</span>
<span class="synStatement">set</span><span class="synIdentifier">-window-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> automatic-rename on</span>
<span class="synComment">#スクロールモード、コピーモード、選択モードで vi のキーバインドを使う</span>
<span class="synStatement">set</span><span class="synIdentifier">-window-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> mode-keys vi</span>
<span class="synComment">#ウィンドウで動作があるとステータスラインでハイライト</span>
<span class="synStatement">set</span><span class="synIdentifier">-window-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> monitor-activity on</span>
<span class="synComment">#UTF-8 シーケンスが現れることに備える</span>
<span class="synStatement">set</span><span class="synIdentifier">-window-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> utf8 on</span>
 
<span class="synComment">#set-option -g mouse-resize-pane on</span>
<span class="synComment">#set-option -g mouse-select-pane on</span>
 
<span class="synComment"># prefix + r で設定ファイルを再読み込み</span>
<span class="synStatement">set</span><span class="synIdentifier">-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> prefix C-g</span>
unbind <span class="synStatement">r</span>
<span class="synStatement">bind</span> <span class="synStatement">r</span> <span class="synStatement">source</span>-file ~/.tmux.conf
 
<span class="synComment"># キーバインド</span>
<span class="synComment"># 各種ペインの移動</span>
<span class="synStatement">bind</span> h select-pane <span class="synSpecial">-L</span>
<span class="synStatement">bind</span> j select-pane <span class="synSpecial">-D</span>
<span class="synStatement">bind</span> k select-pane <span class="synSpecial">-U</span>
<span class="synStatement">bind</span> l select-pane <span class="synSpecial">-R</span>
<span class="synComment"># 各種ペインのリサイズ</span>
<span class="synStatement">bind</span> H resize-pane <span class="synSpecial">-L</span> <span class="synConstant">5</span>
<span class="synStatement">bind</span> J resize-pane <span class="synSpecial">-D</span> <span class="synConstant">5</span>
<span class="synStatement">bind</span> K resize-pane <span class="synSpecial">-U</span> <span class="synConstant">5</span>
<span class="synStatement">bind</span> L resize-pane <span class="synSpecial">-R</span> <span class="synConstant">5</span>

<span class="synComment">#マウススクロールバック</span>
<span class="synStatement">set</span><span class="synIdentifier">-window-option </span><span class="synSpecial">-g</span><span class="synIdentifier"> mode-mouse on</span>

<span class="synComment">#status line</span>
<span class="synStatement">set</span><span class="synIdentifier"> </span><span class="synSpecial">-g</span><span class="synIdentifier"> status-interval 5</span>
<span class="synStatement">set</span><span class="synIdentifier"> </span><span class="synSpecial">-g</span><span class="synIdentifier"> status-fg cyan</span>
<span class="synStatement">set</span><span class="synIdentifier"> </span><span class="synSpecial">-g</span><span class="synIdentifier"> status-bg black</span>
<span class="synStatement">set</span><span class="synIdentifier"> </span><span class="synSpecial">-g</span><span class="synIdentifier"> status-left-length 40 </span>
<span class="synStatement">set</span><span class="synIdentifier"> </span><span class="synSpecial">-g</span><span class="synIdentifier"> status-left </span><span class="synStatement">'</span><span class="synConstant">#[fg=white,bg=blue]#H#[fg=white,bg=black]:#[fg=white,bg=black][#S#[fg=white,bg=black]][#[fg=white,bg=black]</span><span class="synStatement">'</span>
<span class="synStatement">set</span><span class="synIdentifier"> </span><span class="synSpecial">-g</span><span class="synIdentifier"> status-right </span><span class="synStatement">'</span><span class="synConstant">#[fg=white,bg=cyan][CPU=#(cpu.sh) MEM=#(mem.sh)]#[fg=black,bg=green][%Y/%m/%d(%a)%H:%M]#[default]</span><span class="synStatement">'</span>

setw <span class="synSpecial">-g</span> window-<span class="synStatement">status</span>-current-<span class="synStatement">fg</span> cyan
setw <span class="synSpecial">-g</span> window-<span class="synStatement">status</span>-current-<span class="synStatement">bg</span> black
setw <span class="synSpecial">-g</span> window-<span class="synStatement">status</span>-current-attr bold#,underscore
<span class="synComment"># 以上が設定ファイル</span>

$ cat mem.sh cpu.sh 
<span class="synComment">#!/bin/sh</span>
free | <span class="synStatement">grep</span> <span class="synStatement">"</span><span class="synConstant">^Mem:</span><span class="synStatement">"</span> | awk <span class="synStatement">'</span><span class="synConstant">{printf ("%3d%\n", (($3 / $2) * 100) + 0.5)}</span><span class="synStatement">'</span>
<span class="synComment">#!/bin/sh</span>
top <span class="synSpecial">-bn1</span> | <span class="synStatement">grep</span> <span class="synStatement">"</span><span class="synConstant">^Cpu(s)</span><span class="synStatement">"</span> | <span class="synStatement">sed</span> <span class="synStatement">"</span><span class="synConstant">s/.*, *</span><span class="synSpecial">\(</span><span class="synConstant">[0-9.]*</span><span class="synSpecial">\)</span><span class="synConstant">%id.*/\1/</span><span class="synStatement">"</span> | awk <span class="synStatement">'</span><span class="synConstant">{printf ("%3d%\n", 100 - $1 + 0.5)}</span><span class="synStatement">'</span>

<span class="synComment"># tmuxの起動</span>
$ tmux 

<span class="synComment"># screenを使っている奴らを駆逐する。</span>
$ sudo <span class="synStatement">killall</span> <span class="synStatement">"</span><span class="synConstant">screen</span><span class="synStatement">"</span>
</pre><p><span itemscope itemtype="http://schema.org/Photograph"><a href="http://f.hatena.ne.jp/yutakikuchi/20130819032954" class="hatena-fotolife" itemprop="url"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/yutakikuchi/20130819/20130819032954.png" alt="f:id:yutakikuchi:20130819032954p:image" title="f:id:yutakikuchi:20130819032954p:image" class="hatena-fotolife" itemprop="image"></a></span></p>

</blockquote>

</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201308130844/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yutakikuchi.github.io/blog/post/201308130844/">MongoDBのCapped CollectionとTailable Cursorを使ったRealTimeAccess集計</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yutakikuchi.github.io/blog/post/201308270841/">Object Oriented JavaScriptの入門</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yutakikuchi.github.io/blog/post/201308270841/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yutakikuchi.github.io/blog/js/ui.js"></script>
<script src="https://yutakikuchi.github.io/blog/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-20616165-3', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

